{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/drivewise/web/components/navbar.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { usePathname } from 'next/navigation';\r\nimport { Button } from '@/components/ui/button';\r\nimport { LogOut, Menu, X } from 'lucide-react';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { useAuth } from '@/contexts/auth-context';\r\nimport { toast } from 'sonner';\r\n\r\nexport function Navbar() {\r\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\r\n  const [scrolled, setScrolled] = useState(false);\r\n  const { t } = useLanguage();\r\n  const { user, signOut, isAdmin, userProfile, loading: authLoading } = useAuth();\r\n  const pathname = usePathname();\r\n\r\n  // Get display name from userProfile or fallback to email\r\n  const displayName = userProfile?.full_name || user?.user_metadata?.full_name || user?.email?.split('@')[0] || t('admin.user');\r\n\r\n  // Handle scroll behavior\r\n  useEffect(() => {\r\n    let rafId: number;\r\n    const handleScroll = () => {\r\n      rafId = requestAnimationFrame(() => {\r\n        setScrolled(window.scrollY > 10);\r\n      });\r\n    };\r\n    window.addEventListener('scroll', handleScroll);\r\n    return () => {\r\n      window.removeEventListener('scroll', handleScroll);\r\n      cancelAnimationFrame(rafId);\r\n    };\r\n  }, []);\r\n\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      setMobileMenuOpen(false);\r\n      await signOut();\r\n      toast.success(t('auth.logoutSuccess'));\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n      toast.error(t('auth.logoutError'));\r\n    }\r\n  };\r\n\r\n  const isActive = (path: string) => pathname === path;\r\n\r\n  const desktopLinkBase =\r\n    'text-sm font-semibold transition-all duration-200 relative group/nav-link';\r\n  const desktopLinkActive = 'text-primary';\r\n  const desktopLinkInactive = 'text-foreground/80 hover:text-foreground';\r\n\r\n  const renderDesktopLink = (href: string, label: string, active: boolean) => (\r\n    <Link\r\n      href={href}\r\n      className={`${desktopLinkBase} ${active ? desktopLinkActive : desktopLinkInactive}`}\r\n    >\r\n      {label}\r\n      <span\r\n        className={`absolute -bottom-1 left-0 h-0.5 bg-gradient-to-r from-primary to-primary/50 rounded-full transition-all duration-200 ${\r\n          active ? 'w-full' : 'w-0 group-hover/nav-link:w-full'\r\n        }`}\r\n      />\r\n    </Link>\r\n  );\r\n\r\n  return (\r\n    <nav className={`fixed left-1/2 -translate-x-1/2 z-50 transition-all duration-300 ${\r\n      scrolled ? 'top-0 w-full' : 'top-4 w-[90%]'\r\n    }`}>\r\n      <div className={`bg-card/95 backdrop-blur-xl border border-border/40 shadow-lg shadow-black/20 transition-all duration-300 ${\r\n        scrolled ? 'rounded-none border-t-0 border-x-0' : 'rounded-2xl'\r\n      }`}>\r\n      <div className=\"container mx-auto px-4\">\r\n        <div className=\"flex h-20 items-center justify-between\">\r\n          {/* Logo */}\r\n          <Link href=\"/\" className=\"flex items-center gap-3 group\">\r\n            <div className=\"relative\">\r\n              <div className=\"absolute inset-0 bg-primary/30 blur-2xl rounded-full group-hover:bg-primary/40 transition-all duration-300\"></div>\r\n              <div className=\"relative w-12 h-12 rounded-2xl overflow-hidden shadow-xl shadow-primary/20 group-hover:shadow-primary/30 transition-all duration-300 group-hover:scale-105 border-2 border-primary/30 group-hover:border-primary/50\">\r\n                <Image \r\n                  src=\"/logo-white.png\" \r\n                  alt=\"DriveWise Logo\" \r\n                  width={48} \r\n                  height={48}\r\n                  className=\"w-full h-full object-cover\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div className=\"flex flex-col\">\r\n              <span className=\"text-2xl font-bold text-white tracking-tight\">\r\n                DriveWise\r\n              </span>\r\n              <span className=\"text-xs text-primary font-medium -mt-1\">{t('nav.subtitle')}</span>\r\n            </div>\r\n          </Link>\r\n\r\n          {/* Desktop Navigation */}\r\n          <div className=\"hidden md:flex items-center gap-8\">\r\n            {/* Home */}\r\n            {renderDesktopLink('/', t('nav.home'), isActive('/'))}\r\n\r\n            {/* Pricing page */}\r\n            {renderDesktopLink('/pricing', t('nav.pricing'), isActive('/pricing'))}\r\n\r\n            {/* Materials */}\r\n            {renderDesktopLink('/materials', t('nav.materials'), isActive('/materials'))}\r\n\r\n            {/* Decision Trainer (logged-in users) */}\r\n            {user &&\r\n              renderDesktopLink(\r\n                '/decision-trainer',\r\n                t('nav.decisionTrainer'),\r\n                pathname.startsWith('/decision-trainer'),\r\n              )}\r\n\r\n            {/* Tests (category index page) */}\r\n            {renderDesktopLink('/category', t('nav.tests'), pathname.startsWith('/category'))}\r\n\r\n            {/* Dashboard */}\r\n            {renderDesktopLink('/dashboard', t('nav.dashboard'), isActive('/dashboard'))}\r\n\r\n            {/* Account (logged-in users) */}\r\n            {user && renderDesktopLink('/profile', t('nav.account'), isActive('/profile'))}\r\n\r\n            {/* Admin (admins only) */}\r\n            {user &&\r\n              isAdmin &&\r\n              renderDesktopLink(\r\n                '/admin',\r\n                t('nav.admin'),\r\n                isActive('/admin') || pathname.startsWith('/admin'),\r\n              )}\r\n          </div>\r\n\r\n          {/* Desktop Auth Buttons */}\r\n          <div className=\"hidden md:flex items-center gap-3\">\r\n            {authLoading ? (\r\n              <div className=\"flex items-center gap-3 px-4 py-2 rounded-full bg-primary/5 border border-primary/10\">\r\n                <div className=\"w-2 h-2 rounded-full bg-primary animate-pulse\"></div>\r\n                <span className=\"text-sm text-muted-foreground\">Loading...</span>\r\n              </div>\r\n            ) : user ? (\r\n              <>\r\n                <div className=\"flex items-center gap-3 px-4 py-2 rounded-full bg-primary/10 border border-primary/20\">\r\n                  <div className=\"w-2 h-2 rounded-full bg-primary animate-pulse\"></div>\r\n                  <span className=\"text-sm font-medium text-primary\">{displayName}</span>\r\n                </div>\r\n                <Button variant=\"outline\" size=\"sm\" onClick={handleLogout} className=\"border-border/50 hover:border-primary/50\">\r\n                  <LogOut className=\"w-4 h-4 mr-2\" />\r\n                  {t('nav.logout')}\r\n                </Button>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Button variant=\"ghost\" size=\"sm\" asChild className=\"hover:bg-primary/10 hover:text-primary\">\r\n                  <Link href=\"/login\">{t('nav.login')}</Link>\r\n                </Button>\r\n                <Button size=\"sm\" asChild className=\"shadow-lg shadow-primary/30 hover:shadow-primary/40 transition-all duration-300 font-semibold\">\r\n                  <Link href=\"/register\">{t('nav.getStarted')}</Link>\r\n                </Button>\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n          {/* Mobile Menu Button */}\r\n          <button\r\n            className=\"md:hidden p-2 hover:bg-primary/10 rounded-lg transition-all duration-200 border border-border/50 hover:border-primary/30\"\r\n            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\r\n          >\r\n            {mobileMenuOpen ? (\r\n              <X className=\"w-5 h-5 text-primary\" />\r\n            ) : (\r\n              <Menu className=\"w-5 h-5 text-foreground\" />\r\n            )}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Mobile Menu */}\r\n        {mobileMenuOpen && (\r\n          <div className=\"md:hidden py-6 border-t border-border/40 bg-card/50 backdrop-blur-xl animate-in slide-in-from-top-2\">\r\n            <div className=\"flex flex-col gap-2\">\r\n              {user && (\r\n                <div className=\"flex items-center gap-3 px-4 py-3 mb-2 rounded-xl bg-primary/10 border border-primary/20\">\r\n                  <div className=\"w-2 h-2 rounded-full bg-primary animate-pulse\"></div>\r\n                  <span className=\"text-sm font-medium text-primary\">{displayName}</span>\r\n                </div>\r\n              )}\r\n              {/* Home */}\r\n              <Link\r\n                href=\"/\"\r\n                className={`px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 ${\r\n                  isActive('/') ? 'bg-primary/10 text-primary border border-primary/20' : 'text-foreground/80 hover:bg-primary/5 hover:text-foreground'\r\n                }`}\r\n                onClick={() => setMobileMenuOpen(false)}\r\n              >\r\n                {t('nav.home')}\r\n              </Link>\r\n\r\n              {/* Pricing */}\r\n              <Link\r\n                href=\"/pricing\"\r\n                className={`px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 ${\r\n                  isActive('/pricing')\r\n                    ? 'bg-primary/10 text-primary border border-primary/20'\r\n                    : 'text-foreground/80 hover:bg-primary/5 hover:text-foreground'\r\n                }`}\r\n                onClick={() => setMobileMenuOpen(false)}\r\n              >\r\n                {t('nav.pricing')}\r\n              </Link>\r\n\r\n              {/* Materials */}\r\n              <Link\r\n                href=\"/materials\"\r\n                className={`px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 ${\r\n                  isActive('/materials') ? 'bg-primary/10 text-primary border border-primary/20' : 'text-foreground/80 hover:bg-primary/5 hover:text-foreground'\r\n                }`}\r\n                onClick={() => setMobileMenuOpen(false)}\r\n              >\r\n                {t('nav.materials')}\r\n              </Link>\r\n\r\n              {/* Decision Trainer (logged-in users) */}\r\n              {user && (\r\n                <Link\r\n                  href=\"/decision-trainer\"\r\n                  className={`px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 ${\r\n                    pathname.startsWith('/decision-trainer')\r\n                      ? 'bg-primary/10 text-primary border border-primary/20'\r\n                      : 'text-foreground/80 hover:bg-primary/5 hover:text-foreground'\r\n                  }`}\r\n                  onClick={() => setMobileMenuOpen(false)}\r\n                >\r\n                  {t('nav.decisionTrainer')}\r\n                </Link>\r\n              )}\r\n\r\n              {/* Tests (category index page) */}\r\n              <Link\r\n                href=\"/category\"\r\n                className={`px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 ${\r\n                  pathname.startsWith('/category')\r\n                    ? 'bg-primary/10 text-primary border border-primary/20'\r\n                    : 'text-foreground/80 hover:bg-primary/5 hover:text-foreground'\r\n                }`}\r\n                onClick={() => setMobileMenuOpen(false)}\r\n              >\r\n                {t('nav.tests')}\r\n              </Link>\r\n\r\n              {/* Dashboard */}\r\n              <Link\r\n                href=\"/dashboard\"\r\n                className={`px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 ${\r\n                  isActive('/dashboard') ? 'bg-primary/10 text-primary border border-primary/20' : 'text-foreground/80 hover:bg-primary/5 hover:text-foreground'\r\n                }`}\r\n                onClick={() => setMobileMenuOpen(false)}\r\n              >\r\n                {t('nav.dashboard')}\r\n              </Link>\r\n\r\n              {/* Account (logged-in users) */}\r\n              {user && (\r\n                <Link\r\n                  href=\"/profile\"\r\n                  className={`px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 ${\r\n                    isActive('/profile')\r\n                      ? 'bg-primary/10 text-primary border border-primary/20'\r\n                      : 'text-foreground/80 hover:bg-primary/5 hover:text-foreground'\r\n                  }`}\r\n                  onClick={() => setMobileMenuOpen(false)}\r\n                >\r\n                  {t('nav.account')}\r\n                </Link>\r\n              )}\r\n\r\n              {/* Admin (admins only) */}\r\n              {user &&\r\n                isAdmin && (\r\n                  <Link\r\n                    href=\"/admin\"\r\n                    className={`px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 ${\r\n                      isActive('/admin') || pathname.startsWith('/admin')\r\n                        ? 'bg-primary/10 text-primary border border-primary/20'\r\n                        : 'text-foreground/80 hover:bg-primary/5 hover:text-foreground'\r\n                    }`}\r\n                    onClick={() => setMobileMenuOpen(false)}\r\n                  >\r\n                    {t('nav.admin')}\r\n                  </Link>\r\n                )}\r\n              \r\n              <div className=\"h-px bg-border/40 my-3\"></div>\r\n              {authLoading ? (\r\n                <div className=\"flex items-center gap-3 px-4 py-3 rounded-xl bg-primary/5 border border-primary/10\">\r\n                  <div className=\"w-2 h-2 rounded-full bg-primary animate-pulse\"></div>\r\n                  <span className=\"text-sm text-muted-foreground\">Loading...</span>\r\n                </div>\r\n              ) : user ? (\r\n                <Button variant=\"outline\" size=\"sm\" onClick={handleLogout} className=\"w-full justify-start border-border/50 hover:border-primary/50\">\r\n                  <LogOut className=\"w-4 h-4 mr-2\" />\r\n                  {t('nav.logout')}\r\n                </Button>\r\n              ) : (\r\n                <>\r\n                  <Button variant=\"ghost\" size=\"sm\" asChild className=\"w-full justify-start hover:bg-primary/10 hover:text-primary\">\r\n                    <Link href=\"/login\" onClick={() => setMobileMenuOpen(false)}>\r\n                      {t('nav.login')}\r\n                    </Link>\r\n                  </Button>\r\n                  <Button size=\"sm\" asChild className=\"w-full justify-start shadow-lg shadow-primary/30\">\r\n                    <Link href=\"/register\" onClick={() => setMobileMenuOpen(false)}>\r\n                      {t('nav.getStarted')}\r\n                    </Link>\r\n                  </Button>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      </div>\r\n    </nav>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 555, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/drivewise/web/components/ui/glass-card.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\ninterface GlassCardProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  children: React.ReactNode\r\n  hover?: boolean\r\n}\r\n\r\nexport function GlassCard({ children, className, hover = false, ...props }: GlassCardProps) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"relative overflow-hidden rounded-2xl border border-border/70 bg-card/70 backdrop-blur-2xl\",\r\n        \"shadow-[0_22px_70px_rgba(0,0,0,0.9)]\",\r\n        \"before:pointer-events-none before:absolute before:inset-0 before:bg-[radial-gradient(circle_at_0%_0%,rgba(255,255,255,0.12),transparent_55%),radial-gradient(circle_at_100%_0%,rgba(255,255,255,0.06),transparent_55%)] before:opacity-70\",\r\n        hover && \"transition-all duration-300 hover:shadow-[0_28px_90px_rgba(0,0,0,1)]\",\r\n        className\r\n      )}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;;;AAOO,SAAS,UAAU,EAAE,QAAQ,EAAE,SAAS,EAAE,QAAQ,KAAK,EAAE,GAAG,OAAuB;IACxF,qBACE,sQAAC;QACC,WAAW,IAAA,iJAAE,EACX,6FACA,wCACA,6OACA,SAAS,wEACT;QAED,GAAG,KAAK;kBAER;;;;;;AAGP","debugId":null}},
    {"offset": {"line": 578, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/drivewise/web/components/ui/skeleton.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nfunction Skeleton({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"relative overflow-hidden rounded-xl bg-gradient-to-r from-muted/60 via-muted/35 to-muted/60\",\r\n        \"before:absolute before:inset-0 before:-translate-x-full before:bg-gradient-to-r before:from-transparent before:via-primary/18 before:to-transparent before:animate-[shimmer_1.4s_infinite]\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Skeleton }\r\n"],"names":[],"mappings":";;;;;AACA;;;AAEA,SAAS,SAAS,EAChB,SAAS,EACT,GAAG,OACkC;IACrC,qBACE,sQAAC;QACC,WAAW,IAAA,iJAAE,EACX,+FACA,8LACA;QAED,GAAG,KAAK;;;;;;AAGf","debugId":null}},
    {"offset": {"line": 601, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/drivewise/web/data/scenarios.ts"],"sourcesContent":["export type Category = 'traffic-lights' | 'signs' | 'pedestrians' | 'right-of-way' | 'hazards' | 'parking';\r\n\r\nexport interface ScenarioOption {\r\n  text: string;\r\n  isCorrect: boolean;\r\n  explanation?: string;\r\n}\r\n\r\nexport interface Scenario {\r\n  id: string;\r\n  category: Category;\r\n  level: 1 | 2 | 3 | 4;\r\n  question: string;\r\n  image?: string;\r\n  options: ScenarioOption[];\r\n  correctExplanation: string;\r\n  realWorldTip: string;\r\n  xp: number;\r\n}\r\n\r\n// Static scenarios are fallback/demo. Real data comes from DB.\r\nexport const SCENARIOS: Scenario[] = [\r\n  {\r\n    id: 'tl-001',\r\n    category: 'traffic-lights',\r\n    level: 1,\r\n    question: 'Ju afroheni nj√´ semafori q√´ sapo u b√´ i verdh√´. √áfar√´ duhet t√´ b√´ni?',\r\n    options: [\r\n      { text: 'P√´rshpejtoni p√´r t√´ kaluar', isCorrect: false, explanation: 'P√´rshpejtimi n√´ drit√´n e verdh√´ √´sht√´ i rreziksh√´m.' },\r\n      { text: 'Ndaloni n√´se mund ta b√´ni t√´ sigurt', isCorrect: true },\r\n      { text: 'Gjithmon√´ ndaloni menj√´her√´', isCorrect: false, explanation: 'Ndalimi i papritur mund t√´ shkaktoj√´ aksident.' },\r\n      { text: 'Bini boris√´ dhe vazhdoni', isCorrect: false, explanation: 'Boria nuk e b√´n kalimin t√´ sigurt.' },\r\n    ],\r\n    correctExplanation: 'Kur drita b√´het e verdh√´, duhet t√´ ndaloni n√´se √´sht√´ e mundur t√´ b√´het n√´ m√´nyr√´ t√´ sigurt.',\r\n    realWorldTip: 'N√´se nuk mund t√´ ndaloni pa rrezikuar, vazhdoni me kujdes.',\r\n    xp: 25,\r\n  }\r\n];\r\n\r\nexport const CATEGORY_INFO: Record<Category, { name: string; icon: string; description: string; color: string }> = {\r\n  'traffic-lights': {\r\n    name: 'Semafor√´t',\r\n    icon: 'üö¶',\r\n    description: 'M√´soni kur t√´ ndaloni dhe t√´ vazhdoni',\r\n    color: '#ef4444',\r\n  },\r\n  'signs': {\r\n    name: 'Shenjat e Rrug√´s',\r\n    icon: 'üõë',\r\n    description: 'M√´soni shenjat e ndalimit dhe paralajm√´rimit',\r\n    color: '#f59e0b',\r\n  },\r\n  'pedestrians': {\r\n    name: 'Siguria e K√´mb√´sor√´ve',\r\n    icon: 'üö∂',\r\n    description: 'Mbroni p√´rdoruesit e pambrojtur t√´ rrug√´s',\r\n    color: '#3b82f6',\r\n  },\r\n  'right-of-way': {\r\n    name: 'P√´rpar√´sia e Kalimit',\r\n    icon: 'üîÑ',\r\n    description: 'M√´soni kush ka p√´rpar√´si n√´ kryq√´zime',\r\n    color: '#8b5cf6',\r\n  },\r\n  'hazards': {\r\n    name: 'Rreziqet n√´ Rrug√´',\r\n    icon: '‚ö†Ô∏è',\r\n    description: 'P√´rballuni me motin dhe pengesat',\r\n    color: '#eab308',\r\n  },\r\n  'parking': {\r\n    name: 'Rregullat e Parkimit',\r\n    icon: 'üÖøÔ∏è',\r\n    description: 'M√´soni parkimin e sigurt dhe t√´ ligjsh√´m',\r\n    color: '#06b6d4',\r\n  },\r\n};\r\n"],"names":[],"mappings":";;;;;;AAqBO,MAAM,YAAwB;IACnC;QACE,IAAI;QACJ,UAAU;QACV,OAAO;QACP,UAAU;QACV,SAAS;YACP;gBAAE,MAAM;gBAA8B,WAAW;gBAAO,aAAa;YAAsD;YAC3H;gBAAE,MAAM;gBAAuC,WAAW;YAAK;YAC/D;gBAAE,MAAM;gBAA+B,WAAW;gBAAO,aAAa;YAAiD;YACvH;gBAAE,MAAM;gBAA4B,WAAW;gBAAO,aAAa;YAAqC;SACzG;QACD,oBAAoB;QACpB,cAAc;QACd,IAAI;IACN;CACD;AAEM,MAAM,gBAAsG;IACjH,kBAAkB;QAChB,MAAM;QACN,MAAM;QACN,aAAa;QACb,OAAO;IACT;IACA,SAAS;QACP,MAAM;QACN,MAAM;QACN,aAAa;QACb,OAAO;IACT;IACA,eAAe;QACb,MAAM;QACN,MAAM;QACN,aAAa;QACb,OAAO;IACT;IACA,gBAAgB;QACd,MAAM;QACN,MAAM;QACN,aAAa;QACb,OAAO;IACT;IACA,WAAW;QACT,MAAM;QACN,MAAM;QACN,aAAa;QACb,OAAO;IACT;IACA,WAAW;QACT,MAAM;QACN,MAAM;QACN,aAAa;QACb,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 681, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/drivewise/web/hooks/use-scenarios.ts"],"sourcesContent":["import { useQuery } from '@tanstack/react-query';\nimport { createClient } from '@/utils/supabase/client';\nimport { Category } from '@/data/scenarios';\n\nexport interface ScenarioOption {\n  text: string;\n  isCorrect: boolean;\n  explanation?: string;\n}\n\nexport interface Scenario {\n  id: string;\n  category: string;\n  topic: string;\n  level: number;\n  question: string;\n  image_url: string | null;\n  options: ScenarioOption[];\n  correct_explanation: string;\n  real_world_tip: string;\n  xp: number;\n  is_active: boolean;\n  chapter_id?: number | null;\n  is_published?: boolean;\n}\n\nexport const TOPIC_MAPPING: Record<string, string> = {\n  'traffic-lights': 'traffic_lights',\n  'signs': 'road_signs',\n  'pedestrians': 'pedestrian_safety',\n  'right-of-way': 'right_of_way',\n  'hazards': 'road_hazard',\n  'parking': 'parking_rules',\n};\n\nexport function useScenarios(category?: Category, licenseCategory: string = 'B') {\n  return useQuery({\n    queryKey: ['scenarios', category, licenseCategory],\n    queryFn: async () => {\n      const supabase = createClient();\n      \n      let baseQuery = supabase\n        .from('decision_trainer_scenarios')\n        .select('*')\n        .eq('is_active', true)\n        .eq('category', licenseCategory) // Filter by license category (A, B, C, D)\n        .order('level', { ascending: true });\n\n      if (category) {\n        const dbTopic = TOPIC_MAPPING[category] || category;\n        baseQuery = baseQuery.eq('topic', dbTopic);\n      }\n\n      // Prefer published-only scenarios when the column exists\n      const { data, error } = await baseQuery.eq('is_published', true);\n\n      // If the is_published column does not exist yet (migration not run),\n      // fall back to only filtering by is_active so scenarios still appear.\n      if (error) {\n        // Postgres undefined_column error\n        const pgError = error as { code?: string };\n        if (pgError.code === '42703') {\n          const { data: fallbackData, error: fallbackError } = await baseQuery;\n          if (fallbackError) throw fallbackError;\n          return fallbackData as Scenario[];\n        }\n        throw error;\n      }\n\n      return data as Scenario[];\n    },\n    // Always refetch when the component mounts or the window gains focus\n    // so that newly added scenarios in the admin panel are visible immediately.\n    staleTime: 0,\n    refetchOnMount: 'always',\n    refetchOnWindowFocus: true,\n  });\n}\n\nexport function useScenario(id: string) {\n  return useQuery({\n    queryKey: ['scenario', id],\n    queryFn: async () => {\n      const supabase = createClient();\n      \n      const { data, error } = await supabase\n        .from('decision_trainer_scenarios')\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n      return data as Scenario;\n    },\n    enabled: !!id,\n  });\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAyBO,MAAM,gBAAwC;IACnD,kBAAkB;IAClB,SAAS;IACT,eAAe;IACf,gBAAgB;IAChB,WAAW;IACX,WAAW;AACb;AAEO,SAAS,aAAa,QAAmB,EAAE,kBAA0B,GAAG;IAC7E,OAAO,IAAA,+MAAQ,EAAC;QACd,UAAU;YAAC;YAAa;YAAU;SAAgB;QAClD,SAAS;YACP,MAAM,WAAW,IAAA,0KAAY;YAE7B,IAAI,YAAY,SACb,IAAI,CAAC,8BACL,MAAM,CAAC,KACP,EAAE,CAAC,aAAa,MAChB,EAAE,CAAC,YAAY,iBAAiB,0CAA0C;aAC1E,KAAK,CAAC,SAAS;gBAAE,WAAW;YAAK;YAEpC,IAAI,UAAU;gBACZ,MAAM,UAAU,aAAa,CAAC,SAAS,IAAI;gBAC3C,YAAY,UAAU,EAAE,CAAC,SAAS;YACpC;YAEA,yDAAyD;YACzD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,UAAU,EAAE,CAAC,gBAAgB;YAE3D,qEAAqE;YACrE,sEAAsE;YACtE,IAAI,OAAO;gBACT,kCAAkC;gBAClC,MAAM,UAAU;gBAChB,IAAI,QAAQ,IAAI,KAAK,SAAS;oBAC5B,MAAM,EAAE,MAAM,YAAY,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM;oBAC3D,IAAI,eAAe,MAAM;oBACzB,OAAO;gBACT;gBACA,MAAM;YACR;YAEA,OAAO;QACT;QACA,qEAAqE;QACrE,4EAA4E;QAC5E,WAAW;QACX,gBAAgB;QAChB,sBAAsB;IACxB;AACF;AAEO,SAAS,YAAY,EAAU;IACpC,OAAO,IAAA,+MAAQ,EAAC;QACd,UAAU;YAAC;YAAY;SAAG;QAC1B,SAAS;YACP,MAAM,WAAW,IAAA,0KAAY;YAE7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,8BACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,IACT,MAAM;YAET,IAAI,OAAO,MAAM;YACjB,OAAO;QACT;QACA,SAAS,CAAC,CAAC;IACb;AACF","debugId":null}},
    {"offset": {"line": 760, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/drivewise/web/hooks/use-decision-trainer.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { createClient } from '@/utils/supabase/client';\r\n\r\nexport interface DecisionTrainerProgress {\r\n  id: string;\r\n  user_id: string;\r\n  category: string;\r\n  total_xp: number;\r\n  scenarios_completed: number;\r\n  correct_answers: number;\r\n  total_attempts: number;\r\n  current_streak: number;\r\n  best_streak: number;\r\n  best_time_seconds: number | null;\r\n  average_time_seconds: number | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface DecisionTrainerAttempt {\r\n  id: string;\r\n  user_id: string;\r\n  scenario_id: string;\r\n  category: string;\r\n  is_correct: boolean;\r\n  selected_options: number[];\r\n  time_taken_ms: number;\r\n  xp_earned: number;\r\n  created_at: string;\r\n}\r\n\r\n// Get user's progress for a specific category\r\nexport function useDecisionTrainerProgress(userId?: string, category?: string) {\r\n  return useQuery({\r\n    queryKey: ['decision-trainer-progress', userId, category],\r\n    queryFn: async () => {\r\n      const supabase = createClient();\r\n      \r\n      let query = supabase\r\n        .from('decision_trainer_progress')\r\n        .select('*')\r\n        .eq('user_id', userId!);\r\n      \r\n      if (category) {\r\n        query = query.eq('category', category);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n      return data || [];\r\n    },\r\n    enabled: !!userId,\r\n    staleTime: 0,\r\n    refetchOnMount: 'always',\r\n  });\r\n}\r\n\r\n// Get user's overall stats across all categories\r\nexport function useDecisionTrainerStats(userId?: string) {\r\n  return useQuery({\r\n    queryKey: ['decision-trainer-stats', userId],\r\n    queryFn: async () => {\r\n      const supabase = createClient();\r\n      \r\n      const { data, error } = await supabase\r\n        .from('decision_trainer_progress')\r\n        .select('*')\r\n        .eq('user_id', userId!);\r\n\r\n      if (error) throw error;\r\n\r\n      const progress = data || [];\r\n      \r\n      // Calculate overall stats\r\n      const totalXp = progress.reduce((sum, p) => sum + p.total_xp, 0);\r\n      const totalScenarios = progress.reduce((sum, p) => sum + p.scenarios_completed, 0);\r\n      const totalCorrect = progress.reduce((sum, p) => sum + p.correct_answers, 0);\r\n      const totalAttempts = progress.reduce((sum, p) => sum + p.total_attempts, 0);\r\n      const bestStreak = Math.max(...progress.map(p => p.best_streak), 0);\r\n      const bestTime = Math.min(...progress.map(p => p.best_time_seconds).filter(t => t !== null), Infinity);\r\n      const accuracy = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0;\r\n\r\n      return {\r\n        totalXp,\r\n        totalScenarios,\r\n        totalCorrect,\r\n        totalAttempts,\r\n        bestStreak,\r\n        bestTime: bestTime === Infinity ? null : bestTime,\r\n        accuracy,\r\n        categoriesCompleted: progress.length,\r\n        categoryProgress: progress,\r\n      };\r\n    },\r\n    enabled: !!userId,\r\n    staleTime: 60 * 1000, // 1 minute\r\n  });\r\n}\r\n\r\n// Get IDs of scenarios where the user's latest attempt was incorrect\r\nexport function useWeakScenarioIds(userId?: string) {\r\n  return useQuery({\r\n    queryKey: ['weak-scenario-ids', userId],\r\n    queryFn: async () => {\r\n      const supabase = createClient();\r\n      \r\n      // Get all attempts for this user, ordered by date\r\n      const { data, error } = await supabase\r\n        .from('decision_trainer_attempts')\r\n        .select('scenario_id, is_correct, created_at')\r\n        .eq('user_id', userId!)\r\n        .order('created_at', { ascending: true }); // Oldest to newest\r\n\r\n      if (error) throw error;\r\n\r\n      // Calculate latest status for each scenario\r\n      const latestStatus = new Map<string, boolean>();\r\n      (data || []).forEach((attempt) => {\r\n        latestStatus.set(attempt.scenario_id, attempt.is_correct);\r\n      });\r\n\r\n      // Filter for IDs where the latest attempt was FALSE (incorrect)\r\n      const weakIds: string[] = [];\r\n      latestStatus.forEach((isCorrect, id) => {\r\n        if (!isCorrect) {\r\n          weakIds.push(id);\r\n        }\r\n      });\r\n\r\n      return weakIds;\r\n    },\r\n    enabled: !!userId,\r\n    staleTime: 0, // Always fresh\r\n  });\r\n}\r\n\r\n// Submit scenario attempt and update progress\r\nexport function useSubmitScenarioAttempt() {\r\n  const queryClient = useQueryClient();\r\n  \r\n  return useMutation({\r\n    mutationFn: async ({\r\n      userId,\r\n      scenarioId,\r\n      category,\r\n      isCorrect,\r\n      selectedOptions,\r\n      timeTakenMs,\r\n      xpEarned,\r\n    }: {\r\n      userId: string;\r\n      scenarioId: string;\r\n      category: string;\r\n      isCorrect: boolean;\r\n      selectedOptions: number[];\r\n      timeTakenMs: number;\r\n      xpEarned: number;\r\n    }) => {\r\n      const supabase = createClient();\r\n\r\n      // 1. Insert the attempt record\r\n      const { data: attempt, error: attemptError } = await supabase\r\n        .from('decision_trainer_attempts')\r\n        .insert({\r\n          user_id: userId,\r\n          scenario_id: scenarioId,\r\n          category,\r\n          is_correct: isCorrect,\r\n          selected_options: selectedOptions,\r\n          time_taken_ms: timeTakenMs,\r\n          xp_earned: xpEarned,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (attemptError) throw attemptError;\r\n\r\n      // 2. Get current progress for this category\r\n      const { data: currentProgress } = await supabase\r\n        .from('decision_trainer_progress')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .eq('category', category)\r\n        .maybeSingle();\r\n\r\n      // 3. Calculate new progress values\r\n      const newTotalXp = (currentProgress?.total_xp || 0) + xpEarned;\r\n      const newScenariosCompleted = (currentProgress?.scenarios_completed || 0) + 1;\r\n      const newCorrectAnswers = (currentProgress?.correct_answers || 0) + (isCorrect ? 1 : 0);\r\n      const newTotalAttempts = (currentProgress?.total_attempts || 0) + 1;\r\n      \r\n      // Calculate streak\r\n      let newCurrentStreak = 0;\r\n      let newBestStreak = currentProgress?.best_streak || 0;\r\n      \r\n      if (isCorrect) {\r\n        newCurrentStreak = (currentProgress?.current_streak || 0) + 1;\r\n        newBestStreak = Math.max(newBestStreak, newCurrentStreak);\r\n      } else {\r\n        newCurrentStreak = 0;\r\n      }\r\n\r\n      // Calculate time stats\r\n      const timeInSeconds = Math.round(timeTakenMs / 1000);\r\n      const newBestTime = currentProgress?.best_time_seconds \r\n        ? Math.min(currentProgress.best_time_seconds, timeInSeconds)\r\n        : timeInSeconds;\r\n      \r\n      // Calculate average time\r\n      const totalTimeMs = (currentProgress?.average_time_seconds || 0) * (currentProgress?.total_attempts || 0) + timeTakenMs;\r\n      const newAverageTime = Math.round(totalTimeMs / newTotalAttempts / 1000);\r\n\r\n      // 4. Upsert progress record\r\n      const { data: progress, error: progressError } = await supabase\r\n        .from('decision_trainer_progress')\r\n        .upsert({\r\n          user_id: userId,\r\n          category,\r\n          total_xp: newTotalXp,\r\n          scenarios_completed: newScenariosCompleted,\r\n          correct_answers: newCorrectAnswers,\r\n          total_attempts: newTotalAttempts,\r\n          current_streak: newCurrentStreak,\r\n          best_streak: newBestStreak,\r\n          best_time_seconds: newBestTime,\r\n          average_time_seconds: newAverageTime,\r\n          updated_at: new Date().toISOString(),\r\n        }, {\r\n          onConflict: 'user_id,category'\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (progressError) throw progressError;\r\n\r\n      return {\r\n        attempt,\r\n        progress,\r\n        newStats: {\r\n          totalXp: newTotalXp,\r\n          scenariosCompleted: newScenariosCompleted,\r\n          correctAnswers: newCorrectAnswers,\r\n          totalAttempts: newTotalAttempts,\r\n          currentStreak: newCurrentStreak,\r\n          bestStreak: newBestStreak,\r\n          accuracy: Math.round((newCorrectAnswers / newTotalAttempts) * 100),\r\n        }\r\n      };\r\n    },\r\n    onSuccess: (_, variables) => {\r\n      // Invalidate related queries\r\n      queryClient.invalidateQueries({ queryKey: ['decision-trainer-progress', variables.userId] });\r\n      queryClient.invalidateQueries({ queryKey: ['decision-trainer-stats', variables.userId] });\r\n      queryClient.invalidateQueries({ queryKey: ['leaderboard'] });\r\n    },\r\n  });\r\n}\r\n\r\n// Complete category session (batch update for multiple scenarios)\r\nexport function useCompleteCategory() {\r\n  const queryClient = useQueryClient();\r\n  \r\n  return useMutation({\r\n    mutationFn: async ({\r\n      userId,\r\n      category,\r\n      attempts,\r\n      totalTimeMs,\r\n    }: {\r\n      userId: string;\r\n      category: string;\r\n      attempts: Array<{\r\n        scenarioId: string;\r\n        isCorrect: boolean;\r\n        selectedOptions: number[];\r\n        timeTakenMs: number;\r\n        xpEarned: number;\r\n      }>;\r\n      totalTimeMs: number;\r\n    }) => {\r\n      const supabase = createClient();\r\n\r\n      // Insert all attempts\r\n      const attemptRecords = attempts.map(attempt => ({\r\n        user_id: userId,\r\n        scenario_id: attempt.scenarioId,\r\n        category,\r\n        is_correct: attempt.isCorrect,\r\n        selected_options: attempt.selectedOptions,\r\n        time_taken_ms: attempt.timeTakenMs,\r\n        xp_earned: attempt.xpEarned,\r\n      }));\r\n\r\n      const { error: attemptsError } = await supabase\r\n        .from('decision_trainer_attempts')\r\n        .insert(attemptRecords);\r\n\r\n      if (attemptsError) throw attemptsError;\r\n\r\n      // Calculate session stats\r\n      const totalXpEarned = attempts.reduce((sum, a) => sum + a.xpEarned, 0);\r\n      const correctCount = attempts.filter(a => a.isCorrect).length;\r\n      const totalCount = attempts.length;\r\n      \r\n      // Calculate streak (consecutive correct answers)\r\n      let maxStreak = 0;\r\n      let currentStreak = 0;\r\n      for (const attempt of attempts) {\r\n        if (attempt.isCorrect) {\r\n          currentStreak++;\r\n          maxStreak = Math.max(maxStreak, currentStreak);\r\n        } else {\r\n          currentStreak = 0;\r\n        }\r\n      }\r\n\r\n      // Get current progress\r\n      const { data: currentProgress } = await supabase\r\n        .from('decision_trainer_progress')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .eq('category', category)\r\n        .maybeSingle();\r\n\r\n      // Update progress\r\n      const newTotalXp = (currentProgress?.total_xp || 0) + totalXpEarned;\r\n      const newScenariosCompleted = (currentProgress?.scenarios_completed || 0) + totalCount;\r\n      const newCorrectAnswers = (currentProgress?.correct_answers || 0) + correctCount;\r\n      const newTotalAttempts = (currentProgress?.total_attempts || 0) + totalCount;\r\n      const newBestStreak = Math.max(currentProgress?.best_streak || 0, maxStreak);\r\n      \r\n      const avgTimeSeconds = Math.round(totalTimeMs / totalCount / 1000);\r\n      const newBestTime = currentProgress?.best_time_seconds \r\n        ? Math.min(currentProgress.best_time_seconds, avgTimeSeconds)\r\n        : avgTimeSeconds;\r\n\r\n      const { data: progress, error: progressError } = await supabase\r\n        .from('decision_trainer_progress')\r\n        .upsert({\r\n          user_id: userId,\r\n          category,\r\n          total_xp: newTotalXp,\r\n          scenarios_completed: newScenariosCompleted,\r\n          correct_answers: newCorrectAnswers,\r\n          total_attempts: newTotalAttempts,\r\n          current_streak: maxStreak, // Set to session streak\r\n          best_streak: newBestStreak,\r\n          best_time_seconds: newBestTime,\r\n          average_time_seconds: avgTimeSeconds,\r\n          updated_at: new Date().toISOString(),\r\n        }, {\r\n          onConflict: 'user_id,category'\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (progressError) throw progressError;\r\n\r\n      return {\r\n        progress,\r\n        sessionStats: {\r\n          totalXpEarned,\r\n          correctCount,\r\n          totalCount,\r\n          accuracy: Math.round((correctCount / totalCount) * 100),\r\n          maxStreak,\r\n          avgTimeSeconds,\r\n        }\r\n      };\r\n    },\r\n    onSuccess: (_, variables) => {\r\n      // Invalidate related queries\r\n      queryClient.invalidateQueries({ queryKey: ['decision-trainer-progress', variables.userId] });\r\n      queryClient.invalidateQueries({ queryKey: ['decision-trainer-stats', variables.userId] });\r\n      queryClient.invalidateQueries({ queryKey: ['leaderboard'] });\r\n    },\r\n  });\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1053, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/drivewise/web/hooks/use-leaderboard.ts"],"sourcesContent":["import { useQuery } from '@tanstack/react-query';\nimport { createClient } from '@/utils/supabase/client';\n\nexport interface LeaderboardEntry {\n  user_id: string;\n  full_name: string;\n  email: string;\n  total_xp: number;\n  total_scenarios: number;\n  total_correct: number;\n  total_attempts: number;\n  best_streak: number;\n  best_time_seconds: number | null;\n  average_time_seconds: number | null;\n  accuracy: number;\n  categories_completed: number;\n}\n\nexport function useLeaderboard(currentUserId?: string) {\n  return useQuery({\n    queryKey: ['leaderboard', currentUserId],\n    queryFn: async () => {\n      const supabase = createClient();\n      \n      // Get all leaderboard data to calculate ranks\n      const { data: allData, error } = await supabase\n        .from('decision_trainer_leaderboard')\n        .select('*')\n        .order('total_xp', { ascending: false })\n        .order('best_time_seconds', { ascending: true });\n\n      if (error) {\n        console.error('Leaderboard error:', error);\n        return { topTen: [], currentUserRank: null, totalUsers: 0 };\n      }\n      \n      const leaderboard = (allData || []) as LeaderboardEntry[];\n      const totalUsers = leaderboard.length;\n      \n      // Get top 10\n      const topTen = leaderboard.slice(0, 10);\n      \n      // Find current user's rank and data\n      let currentUserRank = null;\n      if (currentUserId) {\n        const userIndex = leaderboard.findIndex(entry => entry.user_id === currentUserId);\n        if (userIndex !== -1) {\n          currentUserRank = {\n            ...leaderboard[userIndex],\n            rank: userIndex + 1,\n            isInTopTen: userIndex < 10\n          };\n        }\n      }\n      \n      return {\n        topTen,\n        currentUserRank,\n        totalUsers\n      };\n    },\n    staleTime: 30 * 1000, // 30 seconds - leaderboard updates frequently\n    refetchInterval: 60 * 1000, // Auto-refresh every minute\n  });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAiBO,SAAS,eAAe,aAAsB;IACnD,OAAO,IAAA,+MAAQ,EAAC;QACd,UAAU;YAAC;YAAe;SAAc;QACxC,SAAS;YACP,MAAM,WAAW,IAAA,0KAAY;YAE7B,8CAA8C;YAC9C,MAAM,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,SACpC,IAAI,CAAC,gCACL,MAAM,CAAC,KACP,KAAK,CAAC,YAAY;gBAAE,WAAW;YAAM,GACrC,KAAK,CAAC,qBAAqB;gBAAE,WAAW;YAAK;YAEhD,IAAI,OAAO;gBACT,QAAQ,KAAK,CAAC,sBAAsB;gBACpC,OAAO;oBAAE,QAAQ,EAAE;oBAAE,iBAAiB;oBAAM,YAAY;gBAAE;YAC5D;YAEA,MAAM,cAAe,WAAW,EAAE;YAClC,MAAM,aAAa,YAAY,MAAM;YAErC,aAAa;YACb,MAAM,SAAS,YAAY,KAAK,CAAC,GAAG;YAEpC,oCAAoC;YACpC,IAAI,kBAAkB;YACtB,IAAI,eAAe;gBACjB,MAAM,YAAY,YAAY,SAAS,CAAC,CAAA,QAAS,MAAM,OAAO,KAAK;gBACnE,IAAI,cAAc,CAAC,GAAG;oBACpB,kBAAkB;wBAChB,GAAG,WAAW,CAAC,UAAU;wBACzB,MAAM,YAAY;wBAClB,YAAY,YAAY;oBAC1B;gBACF;YACF;YAEA,OAAO;gBACL;gBACA;gBACA;YACF;QACF;QACA,WAAW,KAAK;QAChB,iBAAiB,KAAK;IACxB;AACF","debugId":null}},
    {"offset": {"line": 1113, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/drivewise/web/lib/subscriptions.ts"],"sourcesContent":["import type { LicenseCategory } from '@/types/database';\r\n\r\n// Plan identifiers\r\nexport type PlanTier = 'FREE' | 'PLAN_A' | 'PLAN_B' | 'PLAN_C';\r\n\r\nexport type PaidPlanTier = Exclude<PlanTier, 'FREE'>;\r\n\r\nexport interface PlanDefinition {\r\n  id: PaidPlanTier;\r\n  label: string;\r\n  months: number;\r\n  priceEur: number;\r\n  // derived convenience fields\r\n  pricePerMonthEur: number;\r\n  badge?: 'MOST_POPULAR' | 'BEST_VALUE';\r\n  emphasize?: boolean;\r\n}\r\n\r\nexport interface BillingConfig {\r\n  freeTestLimitPerCategory: number;\r\n  paidTestLimitPerCategory: number;\r\n  billingCycleDays: number;\r\n  bestValuePlan: PaidPlanTier;\r\n  plans: Record<PaidPlanTier, PlanDefinition>;\r\n}\r\n\r\n// Centralized billing / pricing configuration.\r\n// Values can be overridden via NEXT_PUBLIC_* env vars without changing code.\r\nconst freeLimit = Number(process.env.NEXT_PUBLIC_FREE_TEST_LIMIT_PER_CATEGORY ?? '3');\r\nconst paidLimit = Number(process.env.NEXT_PUBLIC_PAID_TEST_LIMIT_PER_CATEGORY ?? '9999');\r\nconst cycleDays = Number(process.env.NEXT_PUBLIC_BILLING_CYCLE_DAYS ?? '30');\r\nconst bestValueEnv = process.env.NEXT_PUBLIC_PAYMENT_BEST_VALUE_PLAN as PaidPlanTier | undefined;\r\n\r\nconst rawPlans: Omit<PlanDefinition, 'pricePerMonthEur'>[] = [\r\n  {\r\n    id: 'PLAN_A',\r\n    label: '1 month',\r\n    months: 1,\r\n    priceEur: 3,\r\n  },\r\n  {\r\n    id: 'PLAN_B',\r\n    label: '2 months',\r\n    months: 2,\r\n    priceEur: 6,\r\n  },\r\n  {\r\n    id: 'PLAN_C',\r\n    label: '3 months',\r\n    months: 3,\r\n    priceEur: 8,\r\n    badge: 'BEST_VALUE',\r\n    emphasize: true,\r\n  },\r\n];\r\n\r\nconst plansRecord = rawPlans.reduce<Record<PaidPlanTier, PlanDefinition>>((acc, plan) => {\r\n  const pricePerMonthEur = plan.priceEur / plan.months;\r\n  acc[plan.id] = { ...plan, pricePerMonthEur };\r\n  return acc;\r\n}, {} as Record<PaidPlanTier, PlanDefinition>);\r\n\r\nexport const BILLING_CONFIG: BillingConfig = {\r\n  freeTestLimitPerCategory: freeLimit,\r\n  paidTestLimitPerCategory: paidLimit,\r\n  billingCycleDays: cycleDays,\r\n  bestValuePlan: bestValueEnv ?? 'PLAN_C',\r\n  plans: plansRecord,\r\n};\r\n\r\nexport interface CategoryPlan {\r\n  id: string;\r\n  userId: string;\r\n  category: LicenseCategory;\r\n  planTier: PaidPlanTier;\r\n  startDate: string; // ISO\r\n  endDate: string;   // ISO\r\n  isActive: boolean;\r\n  createdAt: string; // ISO\r\n}\r\n\r\nexport interface Entitlements {\r\n  canAccessTests: boolean;\r\n  canStartNewTest: boolean;\r\n  remainingFreeTests?: number;\r\n  canAccessDecisionTrainer: boolean;\r\n  canAccessStudyMaterial: boolean;\r\n  canReviewTestsInDetail: boolean;\r\n}\r\n\r\nexport interface EntitlementInput {\r\n  isAdmin: boolean;\r\n  testsTakenThisCycle: number;\r\n  activePlan?: Pick<CategoryPlan, 'planTier' | 'startDate' | 'endDate' | 'isActive'> | null;\r\n  now?: Date;\r\n}\r\n\r\nexport function isPlanCurrentlyActive(plan?: { startDate: string; endDate: string } | null, now: Date = new Date()): boolean {\r\n  if (!plan) return false;\r\n  const start = new Date(plan.startDate).getTime();\r\n  const end = new Date(plan.endDate).getTime();\r\n  const ts = now.getTime();\r\n  return ts >= start && ts <= end;\r\n}\r\n\r\nexport function computeEntitlements(input: EntitlementInput): Entitlements {\r\n  const { isAdmin, testsTakenThisCycle, activePlan, now } = input;\r\n\r\n  if (isAdmin) {\r\n    return {\r\n      canAccessTests: true,\r\n      canStartNewTest: true,\r\n      remainingFreeTests: undefined,\r\n      canAccessDecisionTrainer: true,\r\n      canAccessStudyMaterial: true,\r\n      canReviewTestsInDetail: true,\r\n    };\r\n  }\r\n\r\n  const hasActivePaidPlan = !!activePlan && isPlanCurrentlyActive(\r\n    { startDate: activePlan.startDate, endDate: activePlan.endDate },\r\n    now,\r\n  );\r\n\r\n  if (hasActivePaidPlan) {\r\n    return {\r\n      canAccessTests: true,\r\n      canStartNewTest: testsTakenThisCycle < BILLING_CONFIG.paidTestLimitPerCategory,\r\n      remainingFreeTests: Math.max(\r\n        0,\r\n        BILLING_CONFIG.paidTestLimitPerCategory - testsTakenThisCycle,\r\n      ),\r\n      canAccessDecisionTrainer: true,\r\n      canAccessStudyMaterial: true,\r\n      canReviewTestsInDetail: true,\r\n    };\r\n  }\r\n\r\n  const remainingFree = Math.max(0, BILLING_CONFIG.freeTestLimitPerCategory - testsTakenThisCycle);\r\n\r\n  return {\r\n    canAccessTests: true,\r\n    canStartNewTest: remainingFree > 0,\r\n    remainingFreeTests: remainingFree,\r\n    canAccessDecisionTrainer: false,\r\n    canAccessStudyMaterial: false,\r\n    canReviewTestsInDetail: false,\r\n  };\r\n}\r\n\r\nexport interface CycleUsageInput {\r\n  attempts: { category: string; completed_at: string }[];\r\n  category: LicenseCategory;\r\n  now?: Date;\r\n}\r\n\r\nexport function countTestsInCurrentCycle(input: CycleUsageInput): number {\r\n  const { attempts, category, now } = input;\r\n  const current = now ?? new Date();\r\n  const cycleStart = new Date(current);\r\n  cycleStart.setDate(cycleStart.getDate() - BILLING_CONFIG.billingCycleDays + 1);\r\n  const startTs = cycleStart.getTime();\r\n  const endTs = current.getTime();\r\n\r\n  return attempts.filter((a) => {\r\n    if (a.category !== category) return false;\r\n    const ts = new Date(a.completed_at).getTime();\r\n    return ts >= startTs && ts <= endTs;\r\n  }).length;\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AA0BA,+CAA+C;AAC/C,6EAA6E;AAC7E,MAAM,YAAY,OAAO,QAAQ,GAAG,CAAC,wCAAwC,IAAI;AACjF,MAAM,YAAY,OAAO,QAAQ,GAAG,CAAC,wCAAwC,IAAI;AACjF,MAAM,YAAY,OAAO,QAAQ,GAAG,CAAC,8BAA8B,IAAI;AACvE,MAAM,eAAe,QAAQ,GAAG,CAAC,mCAAmC;AAEpE,MAAM,WAAuD;IAC3D;QACE,IAAI;QACJ,OAAO;QACP,QAAQ;QACR,UAAU;IACZ;IACA;QACE,IAAI;QACJ,OAAO;QACP,QAAQ;QACR,UAAU;IACZ;IACA;QACE,IAAI;QACJ,OAAO;QACP,QAAQ;QACR,UAAU;QACV,OAAO;QACP,WAAW;IACb;CACD;AAED,MAAM,cAAc,SAAS,MAAM,CAAuC,CAAC,KAAK;IAC9E,MAAM,mBAAmB,KAAK,QAAQ,GAAG,KAAK,MAAM;IACpD,GAAG,CAAC,KAAK,EAAE,CAAC,GAAG;QAAE,GAAG,IAAI;QAAE;IAAiB;IAC3C,OAAO;AACT,GAAG,CAAC;AAEG,MAAM,iBAAgC;IAC3C,0BAA0B;IAC1B,0BAA0B;IAC1B,kBAAkB;IAClB,eAAe,gBAAgB;IAC/B,OAAO;AACT;AA6BO,SAAS,sBAAsB,IAAoD,EAAE,MAAY,IAAI,MAAM;IAChH,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,QAAQ,IAAI,KAAK,KAAK,SAAS,EAAE,OAAO;IAC9C,MAAM,MAAM,IAAI,KAAK,KAAK,OAAO,EAAE,OAAO;IAC1C,MAAM,KAAK,IAAI,OAAO;IACtB,OAAO,MAAM,SAAS,MAAM;AAC9B;AAEO,SAAS,oBAAoB,KAAuB;IACzD,MAAM,EAAE,OAAO,EAAE,mBAAmB,EAAE,UAAU,EAAE,GAAG,EAAE,GAAG;IAE1D,IAAI,SAAS;QACX,OAAO;YACL,gBAAgB;YAChB,iBAAiB;YACjB,oBAAoB;YACpB,0BAA0B;YAC1B,wBAAwB;YACxB,wBAAwB;QAC1B;IACF;IAEA,MAAM,oBAAoB,CAAC,CAAC,cAAc,sBACxC;QAAE,WAAW,WAAW,SAAS;QAAE,SAAS,WAAW,OAAO;IAAC,GAC/D;IAGF,IAAI,mBAAmB;QACrB,OAAO;YACL,gBAAgB;YAChB,iBAAiB,sBAAsB,eAAe,wBAAwB;YAC9E,oBAAoB,KAAK,GAAG,CAC1B,GACA,eAAe,wBAAwB,GAAG;YAE5C,0BAA0B;YAC1B,wBAAwB;YACxB,wBAAwB;QAC1B;IACF;IAEA,MAAM,gBAAgB,KAAK,GAAG,CAAC,GAAG,eAAe,wBAAwB,GAAG;IAE5E,OAAO;QACL,gBAAgB;QAChB,iBAAiB,gBAAgB;QACjC,oBAAoB;QACpB,0BAA0B;QAC1B,wBAAwB;QACxB,wBAAwB;IAC1B;AACF;AAQO,SAAS,yBAAyB,KAAsB;IAC7D,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,EAAE,GAAG;IACpC,MAAM,UAAU,OAAO,IAAI;IAC3B,MAAM,aAAa,IAAI,KAAK;IAC5B,WAAW,OAAO,CAAC,WAAW,OAAO,KAAK,eAAe,gBAAgB,GAAG;IAC5E,MAAM,UAAU,WAAW,OAAO;IAClC,MAAM,QAAQ,QAAQ,OAAO;IAE7B,OAAO,SAAS,MAAM,CAAC,CAAC;QACtB,IAAI,EAAE,QAAQ,KAAK,UAAU,OAAO;QACpC,MAAM,KAAK,IAAI,KAAK,EAAE,YAAY,EAAE,OAAO;QAC3C,OAAO,MAAM,WAAW,MAAM;IAChC,GAAG,MAAM;AACX","debugId":null}},
    {"offset": {"line": 1226, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/drivewise/web/hooks/use-subscriptions.ts"],"sourcesContent":["import { useQuery } from '@tanstack/react-query';\r\nimport { createClient } from '@/utils/supabase/client';\r\nimport type { LicenseCategory, UserPlan as DbUserPlan } from '@/types/database';\r\nimport {\r\n  computeEntitlements,\r\n  countTestsInCurrentCycle,\r\n  isPlanCurrentlyActive,\r\n  type CategoryPlan,\r\n  type Entitlements,\r\n  type PaidPlanTier,\r\n} from '@/lib/subscriptions';\r\n\r\ninterface CategoryEntitlementsResult {\r\n  entitlements: Entitlements;\r\n  plan: CategoryPlan | null;\r\n  testsTakenThisCycle: number;\r\n}\r\n\r\ninterface TestAttemptRowForEntitlements {\r\n  category: LicenseCategory;\r\n  completed_at: string;\r\n}\r\n\r\nexport function useUserPlans(userId?: string) {\r\n  return useQuery<DbUserPlan[]>({\r\n    queryKey: ['user-plans', userId],\r\n    queryFn: async () => {\r\n      const supabase = createClient();\r\n      const { data, error } = await supabase\r\n        .from('user_plans')\r\n        .select('*')\r\n        .eq('user_id', userId!);\r\n      if (error) {\r\n        throw error;\r\n      }\r\n      return data || [];\r\n    },\r\n    enabled: !!userId,\r\n    staleTime: 0,\r\n    refetchOnMount: 'always',\r\n  });\r\n}\r\n\r\nexport function useGlobalPremium(userId?: string, isAdmin?: boolean) {\r\n  const query = useUserPlans(userId);\r\n\r\n  const now = new Date();\r\n  const hasAnyActivePlan =\r\n    !!isAdmin ||\r\n    (query.data || []).some((plan) =>\r\n      plan.status === 'active' &&\r\n      isPlanCurrentlyActive({ startDate: plan.start_date, endDate: plan.end_date }, now),\r\n    );\r\n\r\n  return {\r\n    ...query,\r\n    hasAnyActivePlan,\r\n  };\r\n}\r\n\r\nexport function useCategoryEntitlements(\r\n  userId: string | undefined,\r\n  category: LicenseCategory | undefined,\r\n  isAdmin: boolean,\r\n) {\r\n  return useQuery<CategoryEntitlementsResult>({\r\n    queryKey: ['category-entitlements', userId, category, isAdmin],\r\n    queryFn: async () => {\r\n      const supabase = createClient();\r\n\r\n      const [plansResult, attemptsResult] = await Promise.all([\r\n        supabase\r\n          .from('user_plans')\r\n          .select('*')\r\n          .eq('user_id', userId!)\r\n          .eq('category', category!)\r\n          .order('end_date', { ascending: false })\r\n          .limit(1),\r\n        supabase\r\n          .from('test_attempts')\r\n          .select('category, completed_at')\r\n          .eq('user_id', userId!),\r\n      ]);\r\n\r\n      if (plansResult.error) {\r\n        throw plansResult.error;\r\n      }\r\n      if (attemptsResult.error) {\r\n        throw attemptsResult.error;\r\n      }\r\n\r\n      const planRow = (plansResult.data || [])[0] as DbUserPlan | undefined;\r\n\r\n      const now = new Date();\r\n\r\n      const testsTakenThisCycle = countTestsInCurrentCycle({\r\n        attempts: (attemptsResult.data || []).map((a: TestAttemptRowForEntitlements) => ({\r\n          category: a.category,\r\n          completed_at: a.completed_at,\r\n        })),\r\n        category: category!,\r\n        now,\r\n      });\r\n\r\n      const plan: CategoryPlan | null = planRow\r\n        ? {\r\n            id: planRow.id,\r\n            userId: planRow.user_id,\r\n            category: planRow.category,\r\n            planTier: planRow.plan_tier as PaidPlanTier,\r\n            startDate: planRow.start_date,\r\n            endDate: planRow.end_date,\r\n            isActive: planRow.status === 'active',\r\n            createdAt: planRow.created_at,\r\n          }\r\n        : null;\r\n\r\n      const entitlements = computeEntitlements({\r\n        isAdmin,\r\n        testsTakenThisCycle,\r\n        activePlan: plan\r\n          ? {\r\n              planTier: plan.planTier,\r\n              startDate: plan.startDate,\r\n              endDate: plan.endDate,\r\n              isActive: plan.isActive,\r\n            }\r\n          : null,\r\n        now,\r\n      });\r\n\r\n      return {\r\n        entitlements,\r\n        plan,\r\n        testsTakenThisCycle,\r\n      };\r\n    },\r\n    enabled: !!userId && !!category,\r\n    staleTime: 1000 * 60 * 5, // 5 minutes\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AAEA;;;;AAoBO,SAAS,aAAa,MAAe;IAC1C,OAAO,IAAA,+MAAQ,EAAe;QAC5B,UAAU;YAAC;YAAc;SAAO;QAChC,SAAS;YACP,MAAM,WAAW,IAAA,0KAAY;YAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW;YACjB,IAAI,OAAO;gBACT,MAAM;YACR;YACA,OAAO,QAAQ,EAAE;QACnB;QACA,SAAS,CAAC,CAAC;QACX,WAAW;QACX,gBAAgB;IAClB;AACF;AAEO,SAAS,iBAAiB,MAAe,EAAE,OAAiB;IACjE,MAAM,QAAQ,aAAa;IAE3B,MAAM,MAAM,IAAI;IAChB,MAAM,mBACJ,CAAC,CAAC,WACF,CAAC,MAAM,IAAI,IAAI,EAAE,EAAE,IAAI,CAAC,CAAC,OACvB,KAAK,MAAM,KAAK,YAChB,kLAAsB;YAAE,WAAW,KAAK,UAAU;YAAE,SAAS,KAAK,QAAQ;QAAC,GAAG;IAGlF,OAAO;QACL,GAAG,KAAK;QACR;IACF;AACF;AAEO,SAAS,wBACd,MAA0B,EAC1B,QAAqC,EACrC,OAAgB;IAEhB,OAAO,IAAA,+MAAQ,EAA6B;QAC1C,UAAU;YAAC;YAAyB;YAAQ;YAAU;SAAQ;QAC9D,SAAS;YACP,MAAM,WAAW,IAAA,0KAAY;YAE7B,MAAM,CAAC,aAAa,eAAe,GAAG,MAAM,QAAQ,GAAG,CAAC;gBACtD,SACG,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,QACd,EAAE,CAAC,YAAY,UACf,KAAK,CAAC,YAAY;oBAAE,WAAW;gBAAM,GACrC,KAAK,CAAC;gBACT,SACG,IAAI,CAAC,iBACL,MAAM,CAAC,0BACP,EAAE,CAAC,WAAW;aAClB;YAED,IAAI,YAAY,KAAK,EAAE;gBACrB,MAAM,YAAY,KAAK;YACzB;YACA,IAAI,eAAe,KAAK,EAAE;gBACxB,MAAM,eAAe,KAAK;YAC5B;YAEA,MAAM,UAAU,CAAC,YAAY,IAAI,IAAI,EAAE,CAAC,CAAC,EAAE;YAE3C,MAAM,MAAM,IAAI;YAEhB,MAAM,sBAAsB,IAAA,+KAAwB,EAAC;gBACnD,UAAU,CAAC,eAAe,IAAI,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,IAAqC,CAAC;wBAC/E,UAAU,EAAE,QAAQ;wBACpB,cAAc,EAAE,YAAY;oBAC9B,CAAC;gBACD,UAAU;gBACV;YACF;YAEA,MAAM,OAA4B,UAC9B;gBACE,IAAI,QAAQ,EAAE;gBACd,QAAQ,QAAQ,OAAO;gBACvB,UAAU,QAAQ,QAAQ;gBAC1B,UAAU,QAAQ,SAAS;gBAC3B,WAAW,QAAQ,UAAU;gBAC7B,SAAS,QAAQ,QAAQ;gBACzB,UAAU,QAAQ,MAAM,KAAK;gBAC7B,WAAW,QAAQ,UAAU;YAC/B,IACA;YAEJ,MAAM,eAAe,IAAA,0KAAmB,EAAC;gBACvC;gBACA;gBACA,YAAY,OACR;oBACE,UAAU,KAAK,QAAQ;oBACvB,WAAW,KAAK,SAAS;oBACzB,SAAS,KAAK,OAAO;oBACrB,UAAU,KAAK,QAAQ;gBACzB,IACA;gBACJ;YACF;YAEA,OAAO;gBACL;gBACA;gBACA;YACF;QACF;QACA,SAAS,CAAC,CAAC,UAAU,CAAC,CAAC;QACvB,WAAW,OAAO,KAAK;IACzB;AACF","debugId":null}},
    {"offset": {"line": 1338, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/drivewise/web/app/%28pages%29/decision-trainer/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/contexts/auth-context';\nimport { Navbar } from '@/components/navbar';\nimport { Button } from '@/components/ui/button';\nimport { GlassCard } from '@/components/ui/glass-card';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ArrowLeft, Check, X, Lightbulb, Trophy, Zap, Timer, TrafficCone, Octagon, User, GitBranch, AlertTriangle, Car, Play, Lock, Target, ChevronRight } from 'lucide-react';\nimport Link from 'next/link';\nimport { CATEGORY_INFO, type Category } from '@/data/scenarios';\nimport { useScenarios, type Scenario as TrainerScenario, TOPIC_MAPPING } from '@/hooks/use-scenarios';\nimport { useCompleteCategory, useDecisionTrainerProgress, useDecisionTrainerStats, useWeakScenarioIds } from '@/hooks/use-decision-trainer';\nimport { useLeaderboard } from '@/hooks/use-leaderboard';\nimport type { DecisionTrainerProgress } from '@/hooks/use-decision-trainer';\nimport { toast } from 'sonner';\nimport { useLanguage } from '@/contexts/language-context';\nimport { useGlobalPremium, useUserPlans } from '@/hooks/use-subscriptions';\nimport { isPlanCurrentlyActive } from '@/lib/subscriptions';\n// import Confetti from 'react-canvas-confetti';\n\ntype SessionAttempt = {\n  scenarioId: string;\n  isCorrect: boolean;\n  selectedOptions: number[];\n  timeTakenMs: number;\n  xpEarned: number;\n};\n\nconst CATEGORY_ICONS: Record<Category, React.ReactNode> = {\n  'traffic-lights': <TrafficCone className=\"w-5 h-5\" />,\n  'signs': <Octagon className=\"w-5 h-5\" />,\n  'pedestrians': <User className=\"w-5 h-5\" />,\n  'right-of-way': <GitBranch className=\"w-5 h-5\" />,\n  'hazards': <AlertTriangle className=\"w-5 h-5\" />,\n  'parking': <Car className=\"w-5 h-5\" />,\n};\n\nexport default function DecisionTrainerPage() {\n  const { user, loading: authLoading, isAdmin } = useAuth();\n  const router = useRouter();\n  const { t, language } = useLanguage();\n  const isSq = language === 'sq';\n  const { data: categoryProgressData } = useDecisionTrainerProgress(user?.id);\n  const { data: trainerStats } = useDecisionTrainerStats(user?.id);\n  const { data: leaderboardData } = useLeaderboard(user?.id);\n  const { data: weakScenarioIds } = useWeakScenarioIds(user?.id);\n  \n  const [selectedCategory, setSelectedCategory] = useState<Category | null>(null);\n  const [currentScenarioIndex, setCurrentScenarioIndex] = useState(0);\n  const [selectedOptions, setSelectedOptions] = useState<number[]>([]);\n  const [showResult, setShowResult] = useState(false);\n  const [stats, setStats] = useState({ correct: 0, total: 0, streak: 0, xp: 0 });\n  const [timeLeft, setTimeLeft] = useState(30); // 30 seconds per scenario\n  const [totalTime, setTotalTime] = useState(0);\n  const [sessionAttempts, setSessionAttempts] = useState<SessionAttempt[]>([]);\n  const [mode, setMode] = useState<'full' | 'quick5' | 'quick10' | 'weak'>('full');\n  const [sessionScenarioIds, setSessionScenarioIds] = useState<string[] | null>(null);\n  const [lastSessionSummary, setLastSessionSummary] = useState<{\n    category: Category;\n    stats: {\n      totalXpEarned: number;\n      correctCount: number;\n      totalCount: number;\n      accuracy: number;\n      maxStreak: number;\n      avgTimeSeconds: number;\n    };\n    mistakes: Array<{\n      scenarioId: string;\n      question: string;\n      chapterId?: number | null;\n    }>;\n  } | null>(null);\n  // const [confettiInstance, setConfettiInstance] = useState<any>(null);\n\n  const toastBaseClass =\n    'text-[13px] rounded-xl px-3 py-2 shadow-[0_18px_60px_rgba(0,0,0,0.9)] backdrop-blur-sm';\n\n  const toastStyles = {\n    success: {\n      className:\n        toastBaseClass +\n        ' bg-emerald-500/15 border border-emerald-400/70 text-emerald-50',\n    },\n    error: {\n      className:\n        toastBaseClass +\n        ' bg-red-500/15 border border-red-500/70 text-red-50',\n    },\n    info: {\n      className:\n        toastBaseClass +\n        ' bg-primary/10 border border-primary/70 text-foreground',\n    },\n  } as const;\n  \n  const { hasAnyActivePlan, isLoading: premiumLoading } = useGlobalPremium(user?.id, isAdmin);\n  const { data: userPlans } = useUserPlans(user?.id);\n\n  const activeLicenseCategory = React.useMemo(() => {\n    if (isAdmin) return 'B'; // Default for admin\n    const now = new Date();\n    const activePlan = (userPlans || []).find(\n      (plan) =>\n        plan.status === 'active' &&\n        isPlanCurrentlyActive({ startDate: plan.start_date, endDate: plan.end_date }, now)\n    );\n    return (activePlan?.category as string) || 'B';\n  }, [userPlans, isAdmin]);\n\n  // Fetch scenarios from database\n  const { data: rawScenarios = [], isLoading: scenariosLoading, error: scenariosError } = useScenarios(\n    selectedCategory || undefined,\n    activeLicenseCategory\n  );\n  const scenarios = (rawScenarios ?? []) as TrainerScenario[];\n\n  const completeCategoryMutation = useCompleteCategory();\n\n  const categoryScenarios = selectedCategory\n    ? (sessionScenarioIds\n        ? scenarios.filter((s) => sessionScenarioIds.includes(s.id))\n        : scenarios)\n    : scenarios;\n  const currentScenario = categoryScenarios[currentScenarioIndex];\n\n  useEffect(() => {\n    if (!authLoading && !user) {\n      router.push('/login');\n    }\n  }, [user, authLoading, router]);\n\n  // --- DEFINE HANDLERS & HELPERS BEFORE EARLY RETURNS ---\n\n  const resetSessionState = (resetCategory: boolean) => {\n    if (resetCategory) {\n      setSelectedCategory(null);\n    }\n    setCurrentScenarioIndex(0);\n    setSelectedOptions([]);\n    setShowResult(false);\n    setStats({ correct: 0, total: 0, streak: 0, xp: 0 });\n    setTimeLeft(30);\n    setTotalTime(0);\n    setSessionAttempts([]);\n    setSessionScenarioIds(null);\n    if (resetCategory && mode === 'weak') {\n      setMode('full');\n    }\n  };\n\n  const recordAttempt = (attempt: SessionAttempt) => {\n    setSessionAttempts((prev) => [...prev, attempt]);\n    setShowResult(true);\n\n    setStats((prev) => {\n      const newStreak = attempt.isCorrect ? prev.streak + 1 : 0;\n      const newStats = {\n        correct: prev.correct + (attempt.isCorrect ? 1 : 0),\n        total: prev.total + 1,\n        streak: newStreak,\n        xp: prev.xp + attempt.xpEarned,\n      };\n      return newStats;\n    });\n\n    if (attempt.isCorrect) {\n      toast.success(\n        `${t('trainer.toastCorrect')} +${attempt.xpEarned} XP`,\n        toastStyles.success,\n      );\n    } else {\n      toast.error(t('trainer.toastIncorrect'), toastStyles.error);\n    }\n  };\n\n  const handleTimeUp = () => {\n    if (!currentScenario || showResult) return;\n\n    const correctOptionIndices = currentScenario.options\n      .map((option, index) => (option.isCorrect ? index : -1))\n      .filter((index: number) => index !== -1);\n\n    const isCorrect =\n      selectedOptions.length === correctOptionIndices.length &&\n      selectedOptions.every((index: number) =>\n        correctOptionIndices.includes(index),\n      ) &&\n      correctOptionIndices.every((index: number) =>\n        selectedOptions.includes(index),\n      );\n\n    const timeTaken = (30 - timeLeft) * 1000;\n    const xpEarned = isCorrect ? currentScenario.xp : 0;\n\n    const attempt: SessionAttempt = {\n      scenarioId: currentScenario.id,\n      isCorrect,\n      selectedOptions,\n      timeTakenMs: timeTaken,\n      xpEarned,\n    };\n\n    recordAttempt(attempt);\n  };\n\n  const handleSubmitAnswer = () => {\n    if (selectedOptions.length === 0 || !currentScenario) return;\n\n    const correctOptionIndices = currentScenario.options\n      .map((option, index) => (option.isCorrect ? index : -1))\n      .filter((index: number) => index !== -1);\n\n    const isCorrect =\n      selectedOptions.length === correctOptionIndices.length &&\n      selectedOptions.every((index: number) =>\n        correctOptionIndices.includes(index),\n      ) &&\n      correctOptionIndices.every((index: number) =>\n        selectedOptions.includes(index),\n      );\n\n    const timeTaken = (30 - timeLeft) * 1000; // Convert to milliseconds\n    const xpEarned = isCorrect ? currentScenario.xp : 0;\n\n    const attempt: SessionAttempt = {\n      scenarioId: currentScenario.id,\n      isCorrect,\n      selectedOptions,\n      timeTakenMs: timeTaken,\n      xpEarned,\n    };\n\n    recordAttempt(attempt);\n  };\n\n  const handleSelectOption = (index: number) => {\n    if (showResult) return;\n    setSelectedOptions(prev => {\n      if (prev.includes(index)) {\n        return prev.filter(i => i !== index);\n      } else {\n        return [...prev, index];\n      }\n    });\n  };\n  \n  const handleNext = async () => {\n    if (currentScenarioIndex < categoryScenarios.length - 1) {\n      setCurrentScenarioIndex((prev) => prev + 1);\n      setSelectedOptions([]);\n      setShowResult(false);\n      setTimeLeft(30); // Reset timer for next scenario\n    } else {\n      // Category completed - save results to database\n      const completionTime = sessionAttempts.reduce(\n        (sum, a) => sum + a.timeTakenMs,\n        0,\n      );\n      setTotalTime(Math.floor(completionTime / 1000));\n      \n      if (user?.id && selectedCategory && sessionAttempts.length > 0) {\n        try {\n          const result = await completeCategoryMutation.mutateAsync({\n            userId: user.id,\n            category: selectedCategory,\n            attempts: sessionAttempts,\n            totalTimeMs: completionTime,\n          });\n          \n          toast.success(\n            `${t('trainer.toastCompleted')} ‚Äì ${result.sessionStats.accuracy}% ${t('trainer.toastAccuracy')}, +${result.sessionStats.totalXpEarned} XP`,\n            { ...toastStyles.success, duration: 5000 }\n          );\n\n          // Helper for mistakes (simple re-calc or just pass empty array if needed, \n          // but for now we rely on it being available in scope or we define it here)\n          // Ideally computeMistakes should be imported or defined. \n          // Since it was likely defined at the bottom or outside, let's assume we need to move it too or import it.\n          // Checking file... computeMistakes is likely defined at the bottom of the file outside component.\n          // If so, we are fine. If it was inside component, we need to hoist it.\n          // Looking at previous reads, it seemed to be used but I didn't see the definition. \n          // Assuming it's outside or imported.\n          \n          const mistakes = computeMistakes(\n            sessionAttempts,\n            categoryScenarios as TrainerScenario[],\n          );\n\n          setLastSessionSummary({\n            category: selectedCategory,\n            stats: {\n              totalXpEarned: result.sessionStats.totalXpEarned,\n              correctCount: result.sessionStats.correctCount,\n              totalCount: result.sessionStats.totalCount,\n              accuracy: result.sessionStats.accuracy,\n              maxStreak: result.sessionStats.maxStreak,\n              avgTimeSeconds: result.sessionStats.avgTimeSeconds,\n            },\n            mistakes,\n          });\n        } catch (error) {\n          console.error('Error saving results:', error);\n          toast.error(t('trainer.toastSyncFailed'), toastStyles.error);\n\n          const computedStats = computeSessionStats(\n            sessionAttempts,\n            completionTime,\n          );\n          const mistakes = computeMistakes(\n            sessionAttempts,\n            categoryScenarios as TrainerScenario[],\n          );\n\n          if (selectedCategory) {\n            setLastSessionSummary({\n              category: selectedCategory,\n              stats: computedStats,\n              mistakes,\n            });\n          }\n        }\n      }\n\n      // Reset for next session\n      resetSessionState(true);\n    }\n  };\n  \n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const startCategory = (category: Category, specificIds: string[] | null = null) => {\n    const dbTopic = TOPIC_MAPPING[category] || category;\n    const availableScenarios = (scenarios || []).filter((s) => s.topic === dbTopic);\n    \n    if (!availableScenarios.length) {\n      toast.error(t('trainer.noScenariosTitle'), toastStyles.error);\n      return;\n    }\n\n    setSelectedCategory(category);\n    setCurrentScenarioIndex(0);\n    setSelectedOptions([]);\n    setShowResult(false);\n    setStats({ correct: 0, total: 0, streak: 0, xp: 0 });\n    setTimeLeft(30);\n    setTotalTime(0);\n    setSessionAttempts([]);\n    setSessionScenarioIds(specificIds);\n  };\n  \n  const handleStartWeakPoints = () => {\n    const progressList = (categoryProgressData || []) as DecisionTrainerProgress[];\n    const withAttempts = progressList.filter((p) => p.total_attempts > 0);\n    if (withAttempts.length === 0) {\n      toast.error(t('trainer.toastWeakLocked'), toastStyles.error);\n      return;\n    }\n\n    const weakest = withAttempts.reduce((lowest, p) => {\n      const acc = p.total_attempts > 0 ? p.correct_answers / p.total_attempts : 1;\n      const lowestAcc = lowest.total_attempts > 0 ? lowest.correct_answers / lowest.total_attempts : 1;\n      return acc < lowestAcc ? p : lowest;\n    }, withAttempts[0]);\n\n    const weakestCategory = weakest.category as Category;\n    const info = CATEGORY_INFO[weakestCategory];\n    \n    // Filter global weak IDs to only those in this category\n    const categoryWeakIds = (weakScenarioIds || []).filter(id => {\n      const s = scenarios.find(sc => sc.id === id);\n      return s && s.category === weakestCategory;\n    });\n\n    setMode('weak');\n    \n    if (categoryWeakIds.length > 0) {\n      startCategory(weakestCategory, categoryWeakIds);\n      if (info) {\n        toast.info(`${t('trainer.toastFocusingWeak')} ${info.name} (${categoryWeakIds.length} ${t('test.questions')})`, toastStyles.info);\n      }\n    } else {\n      // Fallback if no specific IDs found\n      startCategory(weakestCategory);\n      if (info) {\n        toast.info(`${t('trainer.toastFocusingWeak')} ${info.name}`, toastStyles.info);\n      }\n    }\n  };\n\n  // --- HOOKS THAT USE HANDLERS ---\n\n  // Timer countdown for each scenario\n  useEffect(() => {\n    if (!selectedCategory || !currentScenario || showResult) return;\n\n    const interval = setInterval(() => {\n      setTimeLeft((prev) => (prev > 0 ? prev - 1 : 0));\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [selectedCategory, currentScenarioIndex, showResult, currentScenario]);\n\n  // When time runs out, auto-submit\n  useEffect(() => {\n    if (!selectedCategory || !currentScenario || showResult) return;\n    if (timeLeft > 0) return;\n\n    handleTimeUp();\n  }, [timeLeft, selectedCategory, currentScenario, showResult]); // Added handleTimeUp to dependencies effectively? No, it's stable enough if defined in scope.\n\n  // --- EARLY RETURNS START HERE ---\n  \n  if (authLoading || !user || premiumLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navbar />\n        <div className=\"container mx-auto px-4 py-8 max-w-7xl pt-32\">\n           <div className=\"mb-8\">\n             <Skeleton className=\"h-10 w-32 mb-4\" />\n             <GlassCard className=\"p-6 h-64 flex flex-col justify-center items-center\">\n                <Skeleton className=\"h-8 w-48 mb-2\" />\n                <Skeleton className=\"h-4 w-64\" />\n             </GlassCard>\n           </div>\n           <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {Array.from({ length: 6 }).map((_, i) => (\n                <GlassCard key={i} className=\"p-6 h-40\">\n                   <Skeleton className=\"w-12 h-12 rounded-2xl mb-4\" />\n                   <Skeleton className=\"h-5 w-24 mb-2\" />\n                   <Skeleton className=\"h-3 w-full\" />\n                </GlassCard>\n              ))}\n           </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAdmin && !hasAnyActivePlan) {\n    return (\n      <div className=\"min-h-screen bg-background text-foreground\">\n        {/* Background elements */}\n        <div className=\"pointer-events-none absolute inset-x-0 top-0 h-72 bg-gradient-to-b from-orange-500/20 via-transparent to-transparent blur-3xl\" />\n        <Navbar />\n        <div className=\"pt-32\">\n          <div className=\"container mx-auto px-4 py-10 max-w-3xl\">\n            <GlassCard className=\"p-8 md:p-10 border border-orange-500/30 bg-black/85 text-center relative overflow-hidden\">\n              <div className=\"pointer-events-none absolute -top-24 -right-24 w-64 h-64 bg-orange-500/10 rounded-full blur-3xl\" />\n              \n              <div className=\"relative z-10 flex flex-col items-center\">\n                <div className=\"w-16 h-16 rounded-full bg-orange-500/10 flex items-center justify-center mb-6 border border-orange-500/20\">\n                  <Lock className=\"w-8 h-8 text-orange-400\" />\n                </div>\n                \n                <h1 className=\"text-3xl font-semibold mb-3 tracking-tight\">\n                  {t('trainer.premiumRequiredTitle')}\n                </h1>\n                <p className=\"text-base text-muted-foreground mb-8 max-w-lg mx-auto leading-relaxed\">\n                  {t('trainer.premiumRequiredDescription')}\n                </p>\n                \n                <div className=\"grid gap-4 text-left max-w-md mx-auto mb-8 w-full\">\n                  {[\n                    t('trainer.premiumBenefitUnlimited'),\n                    t('trainer.premiumBenefitStudy'),\n                    t('trainer.premiumBenefitFocus')\n                  ].map((benefit, i) => (\n                    <div key={i} className=\"flex items-start gap-3 p-3 rounded-xl bg-white/5 border border-white/10\">\n                      <div className=\"mt-0.5 w-5 h-5 rounded-full bg-orange-500/20 flex items-center justify-center flex-shrink-0\">\n                        <div className=\"w-2 h-2 rounded-full bg-orange-400\" />\n                      </div>\n                      <span className=\"text-sm text-muted-foreground\">{benefit}</span>\n                    </div>\n                  ))}\n                </div>\n\n                <div className=\"flex flex-col sm:flex-row gap-4 w-full max-w-sm\">\n                  <Button asChild className=\"flex-1 bg-orange-500 hover:bg-orange-600 text-black font-medium h-11\">\n                    <Link href=\"/pricing\">\n                      {t('trainer.premiumUpgradeCta')}\n                    </Link>\n                  </Button>\n                  <Button asChild variant=\"outline\" className=\"flex-1 h-11 border-white/10 hover:bg-white/5\">\n                    <Link href=\"/dashboard\">\n                      {t('auth.backToHome')}\n                    </Link>\n                  </Button>\n                </div>\n              </div>\n            </GlassCard>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n\n  if (selectedCategory && scenariosLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navbar />\n        <div className=\"container mx-auto px-4 py-8 max-w-4xl pt-32\">\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <Skeleton className=\"h-9 w-40\" />\n              <div className=\"flex gap-4\">\n                <div className=\"text-center\">\n                  <Skeleton className=\"h-8 w-20 mb-1\" />\n                  <Skeleton className=\"h-3 w-16\" />\n                </div>\n                <div className=\"text-center\">\n                  <Skeleton className=\"h-6 w-16 mb-1\" />\n                  <Skeleton className=\"h-3 w-12\" />\n                </div>\n                <div className=\"text-center\">\n                  <Skeleton className=\"h-6 w-16 mb-1\" />\n                  <Skeleton className=\"h-3 w-16\" />\n                </div>\n              </div>\n            </div>\n            <Skeleton className=\"h-2 w-full rounded-full\" />\n          </div>\n\n          <GlassCard className=\"p-8\">\n            <Skeleton className=\"h-6 w-3/4 mb-6\" />\n            <div className=\"space-y-3\">\n              {Array.from({ length: 4 }).map((_, i) => (\n                <div key={i} className=\"w-full p-4 rounded-lg border-2 border-border\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <Skeleton className=\"w-5 h-5 rounded\" />\n                      <Skeleton className=\"h-4 w-40\" />\n                    </div>\n                    <Skeleton className=\"h-4 w-16\" />\n                  </div>\n                </div>\n              ))}\n            </div>\n          </GlassCard>\n        </div>\n      </div>\n    );\n  }\n\n  if (selectedCategory && !scenariosLoading && categoryScenarios.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navbar />\n        <div className=\"container mx-auto px-4 py-8 max-w-4xl pt-32\">\n          <GlassCard className=\"p-6 border border-border/80 bg-black/80\">\n            <h1 className=\"text-xl font-semibold mb-2 flex items-center gap-2\">\n              <Trophy className=\"w-5 h-5 text-primary\" />\n              {t('trainer.noScenariosTitle')}\n            </h1>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              {t('trainer.noScenariosSubtitle')}\n            </p>\n            <Button variant=\"outline\" onClick={() => setSelectedCategory(null)}>\n              {t('auth.backToHome')}\n            </Button>\n          </GlassCard>\n        </div>\n      </div>\n    );\n  }\n\n  if (!selectedCategory) {\n    return (\n      <div className=\"relative min-h-screen bg-background text-foreground overflow-hidden\">\n        {/* Background grid */}\n        <div\n          aria-hidden\n          className=\"pointer-events-none absolute inset-0 -z-10 [mask-image:radial-gradient(60%_60%_at_50%_20%,#000_20%,transparent_70%)]\"\n        >\n          <svg className=\"h-full w-full opacity-[0.06]\" xmlns=\"http://www.w3.org/2000/svg\">\n            <defs>\n              <pattern id=\"trainer-grid\" width=\"32\" height=\"32\" patternUnits=\"userSpaceOnUse\">\n                <path d=\"M32 0H0V32\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"0.4\" />\n              </pattern>\n            </defs>\n            <rect width=\"100%\" height=\"100%\" fill=\"url(#trainer-grid)\" />\n          </svg>\n        </div>\n\n        {/* Warm glows & rails */}\n        <div className=\"pointer-events-none absolute inset-x-0 top-0 h-72 bg-gradient-to-b from-orange-500/25 via-transparent to-transparent blur-3xl\" />\n        <div aria-hidden className=\"pointer-events-none absolute inset-0\">\n          <div className=\"hidden lg:block absolute top-24 bottom-24 left-[10%] w-px bg-gradient-to-b from-transparent via-orange-500/25 to-transparent\" />\n          <div className=\"hidden lg:block absolute top-24 bottom-24 right-[10%] w-px bg-gradient-to-b from-transparent via-orange-500/25 to-transparent\" />\n        </div>\n\n        <Navbar />\n        \n        <div className=\"container mx-auto px-4 py-8 max-w-7xl pt-32 relative\">\n          <div className=\"mb-8\">\n            <Button variant=\"ghost\" asChild className=\"mb-6 hover:bg-orange-500/10 hover:text-orange-400 transition-colors\">\n              <Link href=\"/dashboard\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                {t('auth.backToHome')}\n              </Link>\n            </Button>\n            \n            <GlassCard className=\"p-6 md:p-8 border border-border/80 bg-black/85 flex flex-col md:flex-row items-start md:items-center justify-between gap-6 relative overflow-hidden\">\n              <div className=\"pointer-events-none absolute -right-24 -top-24 h-64 w-64 rounded-full bg-orange-500/10 blur-3xl opacity-60\" />\n              \n              <div className=\"relative z-10 space-y-3 max-w-2xl\">\n                <div className=\"inline-flex items-center gap-2 rounded-full border border-orange-500/40 bg-orange-500/10 px-3 py-1 text-[11px] font-medium text-orange-300\">\n                  <Zap className=\"w-3.5 h-3.5\" />\n                  <span>{t('trainer.practiceModes')}</span>\n                </div>\n                <h1 className=\"text-3xl md:text-4xl font-semibold tracking-tight\">\n                  {t('trainer.title')}\n                </h1>\n                <p className=\"text-base text-muted-foreground leading-relaxed\">\n                  {t('trainer.heroExplainer')}\n                </p>\n              </div>\n              \n              <div className=\"relative z-10 flex flex-col sm:flex-row gap-3 w-full md:w-auto\">\n                <Button asChild variant=\"outline\" className=\"h-11 border-border/60 bg-black/40 hover:bg-black/60 hover:border-orange-500/50\">\n                  <Link href=\"/decision-trainer/leaderboard\">\n                    <Trophy className=\"w-4 h-4 mr-2 text-yellow-500\" />\n                    {t('trainer.leaderboard')}\n                  </Link>\n                </Button>\n              </div>\n            </GlassCard>\n          </div>\n\n          {scenariosError && (\n            <div className=\"mb-6\">\n              <GlassCard className=\"p-6 border-red-500/30 bg-black/80\">\n                <p className=\"text-sm text-red-400 font-medium mb-1 flex items-center gap-2\">\n                  <AlertTriangle className=\"w-4 h-4\" />\n                  {t('error.title')}\n                </p>\n                <p className=\"text-xs text-muted-foreground\">\n                  {t('error.message')}\n                </p>\n              </GlassCard>\n            </div>\n          )}\n\n          {!scenariosError && !scenariosLoading && scenarios.length === 0 && (\n            <div className=\"mb-6\">\n              <GlassCard className=\"p-6 text-center bg-black/80\">\n                <Trophy className=\"w-12 h-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n                <p className=\"text-lg font-medium mb-1\">\n                  {t('trainer.noScenariosTitle')}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  {t('trainer.noScenariosSubtitle')}\n                </p>\n              </GlassCard>\n            </div>\n          )}\n\n          {lastSessionSummary && (\n            <div className=\"mb-8\">\n              <GlassCard className=\"p-6 md:p-8 border border-border/80 bg-black/85 relative overflow-hidden\">\n                <div className=\"pointer-events-none absolute inset-x-4 top-0 h-px bg-gradient-to-r from-transparent via-orange-500/50 to-transparent opacity-70\" />\n                <div className=\"pointer-events-none absolute -right-24 bottom-0 w-64 h-64 rounded-full bg-orange-500/10 blur-3xl\" />\n                \n                <div className=\"relative z-10\">\n                  <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6\">\n                    <div>\n                      <h2 className=\"text-xl font-bold flex items-center gap-2 mb-1\">\n                        <Trophy className=\"w-5 h-5 text-orange-400\" />\n                        {t('trainer.lastSessionTitle')}: {CATEGORY_INFO[lastSessionSummary.category]?.name || lastSessionSummary.category}\n                      </h2>\n                      <div className=\"flex items-center gap-3 text-xs text-muted-foreground\">\n                        <span className=\"flex items-center gap-1\">\n                          <Check className=\"w-3 h-3 text-green-500\" />\n                          {lastSessionSummary.stats.correctCount}/{lastSessionSummary.stats.totalCount} {t('test.correctLabel')}\n                        </span>\n                        <span>‚Ä¢</span>\n                        <span>{lastSessionSummary.stats.accuracy}% {t('test.accuracy')}</span>\n                        <span>‚Ä¢</span>\n                        <span className=\"text-orange-300\">+{lastSessionSummary.stats.totalXpEarned} XP</span>\n                      </div>\n                    </div>\n                    <div className=\"text-sm text-muted-foreground bg-white/5 px-3 py-1.5 rounded-lg border border-white/10\">\n                      {t('test.timeLeft')}: {lastSessionSummary.stats.avgTimeSeconds}s ¬∑ {t('dashboard.trainerBestStreak')}: {lastSessionSummary.stats.maxStreak}\n                    </div>\n                  </div>\n\n                  {lastSessionSummary.mistakes.length > 0 ? (\n                    <div className=\"space-y-3 bg-white/5 rounded-xl p-4 border border-white/10\">\n                      <p className=\"text-sm font-medium flex items-center gap-2 text-orange-200\">\n                        <Lightbulb className=\"w-4 h-4\" />\n                        {t('trainer.questionsToReview')}\n                      </p>\n                      {lastSessionSummary.mistakes.map((m) => (\n                        <div key={m.scenarioId} className=\"text-sm flex flex-col md:flex-row md:items-center justify-between gap-3 border-t border-white/5 pt-3 mt-2 first:mt-0 first:border-0 first:pt-0\">\n                          <span className=\"text-muted-foreground line-clamp-2 flex-1\">\n                            {m.question || t('test.question')}\n                          </span>\n                          {m.chapterId && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"flex-shrink-0 h-8 text-xs border-white/10 hover:bg-white/5\"\n                              onClick={() => router.push(`/materials?chapter=${m.chapterId}`)}\n                            >\n                              {t('trainer.reviewChapterCta')} {m.chapterId}\n                            </Button>\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"bg-green-500/10 border border-green-500/20 rounded-xl p-4 flex items-center gap-3 text-green-400\">\n                      <div className=\"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n                        <Check className=\"w-5 h-5\" />\n                      </div>\n                      <p className=\"text-sm font-medium\">{t('trainer.perfectSession')}</p>\n                    </div>\n                  )}\n\n                  {/* Smart recommended next steps based on session accuracy */}\n                  <div className=\"mt-6 pt-6 border-t border-white/10 flex flex-col md:flex-row md:items-center justify-between gap-4\">\n                    <div>\n                      <p className=\"text-sm font-semibold mb-1 text-foreground/90\">{t('trainer.nextStepsTitle')}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {lastSessionSummary.stats.accuracy >= 80\n                          ? t('trainer.nextStepsHigh')\n                          : lastSessionSummary.stats.accuracy >= 50\n                          ? t('trainer.nextStepsMedium')\n                          : t('trainer.nextStepsLow')}\n                      </p>\n                    </div>\n                    <div className=\"flex flex-col sm:flex-row gap-2 md:justify-end\">\n                      {/* Practice more in Decision Trainer */}\n                      <Button\n                        size=\"sm\"\n                        className=\"bg-orange-500 hover:bg-orange-600 text-black border-none font-medium\"\n                        onClick={() => {\n                          setMode('quick5');\n                          startCategory(lastSessionSummary.category);\n                        }}\n                      >\n                        {t('trainer.practiceMoreCta')}\n                      </Button>\n\n                      {/* Weak points mode (if available via handleStartWeakPoints) */}\n                      {(categoryProgressData || []).some((p) => p.total_attempts > 0) && (\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          className=\"border-white/10 hover:bg-white/5\"\n                          onClick={handleStartWeakPoints}\n                        >\n                          {t('trainer.weakPointsModeCta')}\n                        </Button>\n                      )}\n\n                      {/* Go to related tests for this category */}\n                      <Button\n                        size=\"sm\"\n                        asChild\n                        variant=\"outline\"\n                        className=\"border-white/10 hover:bg-white/5\"\n                      >\n                        <Link href={`/category/${lastSessionSummary.category.toLowerCase()}`}>\n                          {t('trainer.goToTestsCta')}\n                        </Link>\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </GlassCard>\n            </div>\n          )}\n\n          {trainerStats && (\n            <div className=\"mb-8\">\n              <GlassCard className=\"p-6 md:p-8 border border-border/80 bg-black/80\">\n                {(() => {\n                  const achievements = [\n                    {\n                      id: 'first-scenario',\n                      label: t('trainer.firstSteps'),\n                      description: t('trainer.firstScenarioDesc'),\n                      unlocked: trainerStats.totalScenarios >= 1,\n                    },\n                    {\n                      id: 'accuracy-ace',\n                      label: t('trainer.accuracyAce'),\n                      description: t('trainer.accuracyAceDesc'),\n                      unlocked: trainerStats.totalAttempts >= 20 && trainerStats.accuracy >= 80,\n                    },\n                    {\n                      id: 'streak-master',\n                      label: t('trainer.streakMaster'),\n                      description: t('trainer.streakMasterDesc'),\n                      unlocked: trainerStats.bestStreak >= 10,\n                    },\n                    {\n                      id: 'xp-hunter',\n                      label: t('trainer.xpHunter'),\n                      description: t('trainer.xpHunterDesc'),\n                      unlocked: trainerStats.totalXp >= 500,\n                    },\n                    {\n                      id: 'category-explorer',\n                      label: t('trainer.categoryExplorer'),\n                      description: t('trainer.categoryExplorerDesc'),\n                      unlocked: trainerStats.categoriesCompleted >= 3,\n                    },\n                    {\n                      id: 'consistency-pro',\n                      label: t('trainer.consistencyPro'),\n                      description: t('trainer.consistencyProDesc'),\n                      unlocked: trainerStats.totalScenarios >= 50,\n                    },\n                  ];\n\n                  const unlockedCount = achievements.filter((a) => a.unlocked).length;\n\n                  return (\n                    <>\n                      <div className=\"flex items-center justify-between mb-6\">\n                        <h2 className=\"text-lg font-semibold flex items-center gap-2\">\n                          <Trophy className=\"w-5 h-5 text-orange-400\" />\n                          {t('dashboard.trainerAchievementsLabel')}\n                        </h2>\n                        <span className=\"text-xs font-medium px-2.5 py-1 rounded-full bg-white/5 border border-white/10 text-muted-foreground\">\n                          {unlockedCount}/{achievements.length} {t('trainer.achievementsUnlockedLabel')}\n                        </span>\n                      </div>\n\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n                        {achievements.map((ach) => (\n                          <div\n                            key={ach.id}\n                            className={`border rounded-xl p-4 transition-all duration-300 ${\n                              ach.unlocked\n                                ? 'border-orange-500/30 bg-orange-500/5 shadow-[0_0_15px_rgba(249,115,22,0.05)]'\n                                : 'border-white/5 bg-black/40 opacity-60 grayscale'\n                            }`}\n                          >\n                            <div className=\"font-semibold flex items-center gap-2 mb-2 text-sm\">\n                              {ach.unlocked ? (\n                                <div className=\"w-5 h-5 rounded-full bg-orange-500/20 flex items-center justify-center flex-shrink-0\">\n                                  <Check className=\"w-3 h-3 text-orange-400\" />\n                                </div>\n                              ) : (\n                                <div className=\"w-5 h-5 rounded-full bg-white/10 flex-shrink-0\" />\n                              )}\n                              <span className={ach.unlocked ? 'text-orange-100' : 'text-muted-foreground'}>\n                                {ach.label}\n                              </span>\n                            </div>\n                            <p className=\"text-xs text-muted-foreground pl-7 leading-relaxed\">{ach.description}</p>\n                          </div>\n                        ))}\n                      </div>\n                    </>\n                  );\n                })()}\n              </GlassCard>\n            </div>\n          )}\n          \n          <GlassCard className=\"p-6 border border-border/80 bg-black/80 mb-8\">\n            <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center border border-blue-500/20\">\n                  <Zap className=\"w-5 h-5 text-blue-400\" />\n                </div>\n                <div>\n                  <span className=\"text-sm font-semibold block text-foreground/90\">\n                    {t('trainer.practiceModes')}\n                  </span>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {t('category.selectTestDesc')}\n                  </span>\n                </div>\n              </div>\n              <div className=\"flex flex-wrap gap-2 w-full md:w-auto\">\n                <Button\n                  size=\"sm\"\n                  variant={mode === 'full' ? 'default' : 'outline'}\n                  onClick={() => setMode('full')}\n                  className={mode === 'full' ? 'bg-orange-500 text-black hover:bg-orange-600' : 'border-white/10 hover:bg-white/5'}\n                >\n                  {t('trainer.fullCategory')}\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant={mode === 'quick5' ? 'default' : 'outline'}\n                  onClick={() => setMode('quick5')}\n                  className={mode === 'quick5' ? 'bg-orange-500 text-black hover:bg-orange-600' : 'border-white/10 hover:bg-white/5'}\n                >\n                  {t('trainer.quick5')}\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant={mode === 'quick10' ? 'default' : 'outline'}\n                  onClick={() => setMode('quick10')}\n                  className={mode === 'quick10' ? 'bg-orange-500 text-black hover:bg-orange-600' : 'border-white/10 hover:bg-white/5'}\n                >\n                  {t('trainer.quick10')}\n                </Button>\n                {(categoryProgressData || []).some((p) => p.total_attempts > 0) && (\n                  <Button\n                    size=\"sm\"\n                    variant={mode === 'weak' ? 'default' : 'outline'}\n                    onClick={handleStartWeakPoints}\n                    className={mode === 'weak' ? 'bg-orange-500 text-black hover:bg-orange-600' : 'border-white/10 hover:bg-white/5'}\n                  >\n                    {t('trainer.weakPoints')}\n                  </Button>\n                )}\n              </div>\n            </div>\n          </GlassCard>\n\n          {scenariosLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {Array.from({ length: 6 }).map((_, i) => (\n                <GlassCard\n                  key={i}\n                  className=\"p-6 md:p-7 border border-border/80 bg-black/80\"\n                >\n                  <div className=\"flex items-start gap-4\">\n                    <Skeleton className=\"w-12 h-12 md:w-14 md:h-14 rounded-2xl\" />\n                    <div className=\"flex-1 space-y-2\">\n                      <Skeleton className=\"h-5 w-32\" />\n                      <Skeleton className=\"h-3 w-40\" />\n                      <Skeleton className=\"h-3 w-28\" />\n                      <Skeleton className=\"h-8 w-32\" />\n                    </div>\n                  </div>\n                </GlassCard>\n              ))}\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {Object.entries(CATEGORY_INFO).map(([key, info]) => {\n                const dbTopic = TOPIC_MAPPING[key] || key;\n                const categoryCount = scenarios.filter((scenario) => scenario.topic === dbTopic).length;\n                const progressForCategory = (categoryProgressData || []).find((p) => p.category === key);\n                const totalAttempts = progressForCategory?.total_attempts ?? 0;\n                const correctAnswers = progressForCategory?.correct_answers ?? 0;\n                const accuracy = totalAttempts > 0 ? Math.round((correctAnswers / totalAttempts) * 100) : null;\n                let statusLabel = t('trainer.statusNew');\n                let statusClass = 'bg-white/5 text-muted-foreground border border-white/10';\n                \n                if (totalAttempts > 0 && accuracy !== null) {\n                  if (accuracy >= 80) {\n                    statusLabel = t('trainer.statusStrong');\n                    statusClass = 'bg-green-500/10 text-green-400 border border-green-500/20';\n                  } else if (accuracy >= 50) {\n                    statusLabel = t('trainer.statusImproving');\n\n                    statusClass = 'bg-blue-500/10 text-blue-600 border border-blue-500/30';\n                  } else {\n                    statusLabel = t('trainer.statusNeedsAttention');\n                    statusClass = 'bg-yellow-500/10 text-yellow-600 border border-yellow-500/30';\n                  }\n                }\n                return (\n                  <GlassCard\n                    key={key}\n                    className=\"group relative overflow-hidden p-6 md:p-7 border border-border/80 bg-black/80 hover:border-primary/60 hover:shadow-[0_22px_60px_rgba(0,0,0,0.9)] transition-all cursor-pointer\"\n                    onClick={() => startCategory(key as Category)}\n                  >\n                    {/* Hover effects */}\n                    <div className=\"pointer-events-none absolute -right-10 top-8 h-40 w-40 rounded-full border border-dashed border-primary/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\n                    <div className=\"pointer-events-none absolute -bottom-8 left-6 h-24 w-24 rounded-full bg-primary/10 blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\n\n                    <div className=\"relative z-10 flex items-start gap-4\">\n                      <div className=\"w-12 h-12 md:w-14 md:h-14 rounded-2xl bg-primary/10 flex items-center justify-center\">\n                        {CATEGORY_ICONS[key as Category]}\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"text-lg md:text-xl font-semibold mb-1\">{info.name}</h3>\n                        <p className=\"text-sm text-muted-foreground mb-2\">{info.description}</p>\n                        <div className=\"flex flex-wrap items-center gap-2 mb-2 text-xs\">\n                          <span\n                            className={`inline-flex items-center px-2 py-0.5 rounded-full font-medium ${statusClass}`}\n                          >\n                            {statusLabel}\n                          </span>\n                          <span className=\"text-muted-foreground\">\n                            {categoryCount} {t('trainer.scenariosShort')}\n                            {accuracy !== null && ` ¬∑ ${accuracy}% ${t('trainer.accuracyShort')}`}\n                          </span>\n                        </div>\n                        <Button size=\"sm\" className=\"w-full sm:w-auto\">\n                          {t('categories.startPractice')} ‚Üí\n                        </Button>\n                      </div>\n                    </div>\n                  </GlassCard>\n                );\n              })}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  const categoryInfo = CATEGORY_INFO[selectedCategory];\n  const progress = ((currentScenarioIndex + 1) / categoryScenarios.length) * 100;\n  const correctOptionIndices = currentScenario\n    ? currentScenario.options\n        .map((option, index) => (option.isCorrect ? index : -1))\n        .filter((index: number) => index !== -1)\n    : [];\n  const optionLetter = (index: number) => String.fromCharCode(65 + index);\n  const correctLetters = correctOptionIndices.map(optionLetter);\n  const selectedLetters = selectedOptions.map(optionLetter);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Navbar />\n      {/* <Confetti refConfetti={setConfettiInstance} /> */}\n      \n      <div className=\"container mx-auto px-4 py-8 max-w-4xl pt-28\">\n        <div className=\"mb-8\">\n          <Button\n            variant=\"ghost\"\n            onClick={() => {\n              setSelectedCategory(null);\n              setSessionScenarioIds(null);\n              if (mode === 'weak') {\n                setMode('full');\n              }\n            }}\n            className=\"mb-4\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            {t('test.backToTests')}\n          </Button>\n          \n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4\">\n            <div>\n              <h1 className=\"text-3xl font-bold flex items-center gap-2\">\n                <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                  {CATEGORY_ICONS[selectedCategory as Category]}\n                </div>\n                {categoryInfo.name}\n              </h1>\n              <p className=\"text-muted-foreground\">{t('test.question')} {currentScenarioIndex + 1} {t('test.of')} {categoryScenarios.length}</p>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Mode:{' '}\n                {mode === 'full' && t('trainer.modeFull')}\n                {mode === 'quick5' && t('trainer.modeQuick5')}\n                {mode === 'quick10' && t('trainer.modeQuick10')}\n                {mode === 'weak' && t('trainer.modeWeak')}\n              </p>\n            </div>\n            <div className=\"flex flex-wrap sm:flex-nowrap gap-4 justify-start sm:justify-end\">\n              <div className=\"text-center min-w-[90px]\">\n                <div className={`flex items-center justify-center gap-1.5 text-2xl font-semibold ${\n                  timeLeft <= 10 ? 'text-red-500 animate-pulse' : 'text-sky-400'\n                }`}>\n                  <Timer className=\"w-5 h-5\" />\n                  <span>{timeLeft}s</span>\n                </div>\n                <div className=\"text-xs text-muted-foreground\">{t('test.timeLeft')}</div>\n              </div>\n              <div className=\"text-center min-w-[70px]\">\n                <div className=\"text-2xl font-bold text-primary\">{stats.xp}</div>\n                <div className=\"text-xs text-muted-foreground\">{t('dashboard.trainerXp')}</div>\n              </div>\n              <div className=\"text-center min-w-[70px]\">\n                <div className=\"text-2xl font-bold text-amber-300\">{stats.streak}</div>\n                <div className=\"text-xs text-muted-foreground\">{t('dashboard.streak')}</div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"w-full bg-muted rounded-full h-2\">\n            <div className=\"bg-primary h-2 rounded-full transition-all\" style={{ width: `${progress}%` }} />\n          </div>\n        </div>\n\n        {currentScenario && (\n          <GlassCard className=\"p-6 md:p-8 border border-border/80 bg-black/80\">\n            <h2 className=\"text-2xl font-bold mb-6\">{currentScenario.question}</h2>\n\n            <div className=\"space-y-3 mb-6\">\n              {currentScenario.options.map((option, index: number) => {\n                const isSelected = selectedOptions.includes(index);\n                const isCorrect = option.isCorrect;\n                const showCorrect = showResult && isCorrect;\n                const showWrong = showResult && isSelected && !isCorrect;\n                const showMissed = showResult && !isSelected && isCorrect;\n\n                return (\n                  <motion.button\n                    key={index}\n                    onClick={() => handleSelectOption(index)}\n                    disabled={showResult}\n                    className={`w-full p-4 md:p-5 rounded-xl border-2 text-left transition-all ${\n                      showCorrect\n                        ? 'border-green-500/80 bg-green-500/15'\n                        : showWrong\n                        ? 'border-red-500/80 bg-red-500/15'\n                        : showMissed\n                        ? 'border-yellow-500/80 bg-yellow-500/12'\n                        : isSelected\n                        ? 'border-primary/70 bg-primary/10 shadow-[0_18px_50px_rgba(0,0,0,0.9)]'\n                        : 'border-border/70 bg-black/60 hover:border-primary/50 hover:bg-black/80'\n                    }`}\n                    whileHover={{ scale: showResult ? 1 : 1.02 }}\n                    whileTap={{ scale: showResult ? 1 : 0.98 }}\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center ${\n                          isSelected \n                            ? 'border-primary bg-primary text-primary-foreground' \n                            : 'border-border bg-black/60'\n                        }`}>\n                          {isSelected && <Check className=\"w-3.5 h-3.5\" />}\n                        </div>\n                        <span className=\"font-medium break-words text-left\">{option.text}</span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {showCorrect && <Check className=\"w-5 h-5 text-green-500\" />}\n                        {showWrong && <X className=\"w-5 h-5 text-red-500\" />}\n                        {showMissed && <span className=\"text-yellow-500 text-sm font-medium\">{t('test.failed')}</span>}\n                      </div>\n                    </div>\n                  </motion.button>\n                );\n              })}\n            </div>\n\n            <AnimatePresence>\n              {showResult && (\n                <motion.div\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  exit={{ opacity: 0 }}\n                  className=\"space-y-4\"\n                >\n                  <div className={`p-4 rounded-lg border-2 ${\n                    sessionAttempts[sessionAttempts.length - 1]?.isCorrect\n                      ? 'border-green-500 bg-green-500/10'\n                      : 'border-red-500 bg-red-500/10'\n                  }`}>\n                    <div className=\"flex items-start gap-3\">\n                      <Lightbulb className=\"w-5 h-5 mt-1 flex-shrink-0\" />\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-bold mb-2\">\n                          {sessionAttempts[sessionAttempts.length - 1]?.isCorrect ? t('test.correctTitle') : t('test.incorrectTitle')}\n                        </h3>\n                        <div className=\"mb-3 text-sm\">\n                          <p className=\"font-semibold\">\n                            {t('trainer.correctCombinationLabel')}{' '}\n                            <span className=\"text-green-600\">\n                              {correctLetters.length > 0 ? correctLetters.join(' + ') : '-'}\n                            </span>\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {t('trainer.yourSelectionLabel')}{' '}\n                            {selectedLetters.length > 0 ? selectedLetters.join(' + ') : t('trainer.noSelectionLabel')}\n                          </p>\n                        </div>\n                        \n                        {!sessionAttempts[sessionAttempts.length - 1]?.isCorrect && (\n                          <div className=\"bg-red-500/10 border border-red-500/30 p-3 rounded-lg mb-3\">\n                            <p className=\"text-sm font-semibold mb-1\">{t('test.correctLabel')}</p>\n                            <div className=\"space-y-1\">\n                              {selectedOptions.map((optionIndex: number) => (\n                                <p key={optionIndex} className=\"text-sm\">\n                                  ‚Ä¢ {currentScenario.options[optionIndex].text}\n                                  {currentScenario.options[optionIndex].explanation && (\n                                    <span className=\"text-muted-foreground\"> - {currentScenario.options[optionIndex].explanation}</span>\n                                  )}\n                                </p>\n                              ))}\n                            </div>\n                          </div>\n                        )}\n                        \n                        <div className=\"bg-green-500/10 border border-green-500/30 p-3 rounded-lg mb-3\">\n                          <p className=\"text-sm font-semibold mb-1\">{t('test.correctAnswers')}</p>\n                          <p className=\"text-sm\">{currentScenario.correct_explanation}</p>\n                        </div>\n                        \n                        <div className=\"bg-background/50 p-3 rounded-lg\">\n                          <div className=\"flex items-start gap-2\">\n                            <Lightbulb className=\"w-4 h-4 mt-0.5 text-primary flex-shrink-0\" />\n                            <p className=\"text-sm text-muted-foreground\">{currentScenario.real_world_tip}</p>\n                          </div>\n                        </div>\n\n                        {currentScenario.chapter_id && (\n                          <div className=\"mt-3\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => router.push(`/materials?chapter=${currentScenario.chapter_id}`)}\n                            >\n                              {t('trainer.reviewChapterCta')} {currentScenario.chapter_id}\n                            </Button>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n\n                  <Button onClick={handleNext} className=\"w-full\" size=\"lg\">\n                    {currentScenarioIndex < categoryScenarios.length - 1 ? t('test.next') : t('test.submitTest')}\n                  </Button>\n                </motion.div>\n              )}\n            </AnimatePresence>\n\n            {!showResult && (\n              <div className=\"space-y-3\">\n                <div className=\"text-sm text-muted-foreground text-center\">\n                  {selectedOptions.length === 0 \n                    ? t('test.selectAnswers')\n                    : `${selectedOptions.length} ${t('test.optionsSelected')}`\n                  }\n                </div>\n                <Button\n                  onClick={handleSubmitAnswer}\n                  disabled={selectedOptions.length === 0}\n                  className=\"w-full\"\n                  size=\"lg\"\n                >\n                  {t('test.submitAnswer')}\n                </Button>\n              </div>\n            )}\n          </GlassCard>\n        )}\n\n        <div className=\"mt-8\">\n          <GlassCard className=\"p-6 border border-border/80 bg-black/80\">\n            <h3 className=\"font-bold mb-4 flex items-center gap-2\">\n              <Trophy className=\"w-5 h-5 text-primary\" />\n              {t('test.sessionStats')}\n            </h3>\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 text-center\">\n              <div>\n                <div className=\"text-2xl font-bold\">{stats.correct}/{stats.total}</div>\n                <div className=\"text-xs text-muted-foreground\">{t('test.correctLabel')}</div>\n              </div>\n              <div>\n                <div className=\"text-2xl font-bold text-primary\">{stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0}%</div>\n                <div className=\"text-xs text-muted-foreground\">{t('test.accuracy')}</div>\n              </div>\n              <div>\n                <div className=\"text-2xl font-bold text-green-500\">{stats.streak}</div>\n                <div className=\"text-xs text-muted-foreground\">{t('test.bestStreak')}</div>\n              </div>\n            </div>\n          </GlassCard>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction selectSessionScenarioIds({\n  scenarios,\n  mode,\n}: {\n  scenarios: TrainerScenario[];\n  mode: 'full' | 'quick5' | 'quick10' | 'weak';\n}): string[] {\n  if (mode === 'full') {\n    return [];\n  }\n\n  const maxQuestions = mode === 'quick5' || mode === 'weak' ? 5 : 10;\n  const shuffled = [...scenarios].sort(() => Math.random() - 0.5);\n  return shuffled\n    .slice(0, Math.min(maxQuestions, shuffled.length))\n    .map((s) => s.id as string);\n}\n\nfunction computeSessionStats(\n  attempts: SessionAttempt[],\n  completionTimeMs: number,\n) {\n  const totalXpEarned = attempts.reduce((sum, a) => sum + a.xpEarned, 0);\n  const correctCount = attempts.filter((a) => a.isCorrect).length;\n  const totalCount = attempts.length;\n  const accuracy =\n    totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;\n\n  let maxStreak = 0;\n  let currentStreak = 0;\n  for (const attempt of attempts) {\n    if (attempt.isCorrect) {\n      currentStreak += 1;\n      maxStreak = Math.max(maxStreak, currentStreak);\n    } else {\n      currentStreak = 0;\n    }\n  }\n\n  const avgTimeSeconds =\n    totalCount > 0\n      ? Math.round(completionTimeMs / totalCount / 1000)\n      : 0;\n\n  return {\n    totalXpEarned,\n    correctCount,\n    totalCount,\n    accuracy,\n    maxStreak,\n    avgTimeSeconds,\n  };\n}\n\nfunction computeMistakes(\n  attempts: SessionAttempt[],\n  scenarios: TrainerScenario[],\n) {\n  return attempts\n    .filter((a) => !a.isCorrect)\n    .map((a) => {\n      const scenario = scenarios.find((s) => s.id === a.scenarioId);\n      return {\n        scenarioId: a.scenarioId,\n        question: scenario?.question || '',\n        chapterId: scenario?.chapter_id ?? null,\n      };\n    });\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}