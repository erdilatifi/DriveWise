{"version":3,"sources":["turbopack:///[project]/Desktop/drivewise/web/app/(pages)/test/[category]/[testNumber]/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport type { SupabaseClient } from '@supabase/supabase-js';\nimport dynamic from 'next/dynamic';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { GlassCard } from '@/components/ui/glass-card';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { CATEGORY_INFO, type LicenseCategory } from '@/types/database';\nimport Link from 'next/link';\nimport { ArrowLeft, ArrowRight, CheckCircle, CheckSquare, Lock } from 'lucide-react';\nimport { useParams, useRouter } from 'next/navigation';\nimport { createClient } from '@/utils/supabase/client';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { toast } from 'sonner';\nimport { useLanguage } from '@/contexts/language-context';\nimport { useAuth } from '@/contexts/auth-context';\nimport { useCategoryEntitlements } from '@/hooks/use-subscriptions';\n\n// Test question data structure\ninterface Question {\n  id: string;\n  question_text: string;\n  option_a: string;\n  option_b: string;\n  option_c: string;\n  correct_answer: string;\n  correct_answers?: string[]; // Multiple correct answers support\n  image_url?: string;\n  topic?: string | null;\n}\n\n// Lazily load the rating modal to keep the main test bundle small\nconst RatingModal = dynamic(\n  () => import('@/components/rating-modal').then((mod) => mod.RatingModal),\n  {\n    ssr: false,\n  },\n);\n\n// Single browser Supabase client (avoids re-creating in effects)\nconst supabase = createClient();\n\nexport default function TestPage() {\n  const params = useParams();\n  const router = useRouter();\n  const queryClient = useQueryClient();\n  const { t, language } = useLanguage();\n\n  const category = (params.category as string).toUpperCase() as LicenseCategory;\n  const testNumber = params.testNumber as string;\n\n  const isMixedTest = testNumber === 'mixed';\n  const isPersonalizedTest = testNumber === 'personalized';\n\n  const [currentQuestion, setCurrentQuestion] = useState(0);\n  const [answers, setAnswers] = useState<Record<string, string[]>>({});\n  const [showResults, setShowResults] = useState(false);\n  const [questions, setQuestions] = useState<Question[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [userId, setUserId] = useState<string | null>(null);\n  const [startTime, setStartTime] = useState(Date.now());\n  const [showRatingModal, setShowRatingModal] = useState(false);\n  const [lastTestAttemptId, setLastTestAttemptId] = useState<string | null>(null);\n\n  const { user, isAdmin, loading: authLoading } = useAuth();\n  const { data: entitlementResult } = useCategoryEntitlements(\n    user?.id,\n    category,\n    isAdmin,\n  );\n\n  useEffect(() => {\n    if (authLoading) return;\n\n    if (!user) {\n      router.push('/login');\n      return;\n    }\n\n    const fetchQuestions = async () => {\n      try {\n        setUserId(user.id);\n        setStartTime(Date.now());\n\n        const storageKey = `test_progress_${user.id}_${category}_${testNumber}`;\n        const saved = localStorage.getItem(storageKey);\n        \n        if (saved) {\n          try {\n            const parsed = JSON.parse(saved);\n            // Check if data is less than 24 hours old\n            if (Date.now() - parsed.timestamp < 24 * 60 * 60 * 1000) {\n              console.log('Restoring test progress from local storage');\n              setQuestions(parsed.questions);\n              setAnswers(parsed.answers);\n              setCurrentQuestion(parsed.currentQuestion);\n              setStartTime(parsed.startTime || Date.now());\n              setLoading(false);\n              return;\n            }\n          } catch (e) {\n            console.error('Failed to parse saved test progress', e);\n            localStorage.removeItem(storageKey);\n          }\n        }\n\n        const loadedQuestions = await loadQuestionsForTest({\n          supabase,\n          userId: user.id,\n          category,\n          testNumber,\n        });\n\n        setQuestions(loadedQuestions);\n      } catch (error) {\n        console.error('Error loading questions:', error);\n        toast.error(t('test.loadError'));\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchQuestions();\n  }, [authLoading, user, category, testNumber, router]);\n\n  // Save progress to local storage\n  useEffect(() => {\n    if (!userId || questions.length === 0 || showResults) return;\n\n    const storageKey = `test_progress_${userId}_${category}_${testNumber}`;\n    const data = {\n      questions,\n      answers,\n      currentQuestion,\n      startTime,\n      timestamp: Date.now(),\n    };\n    localStorage.setItem(storageKey, JSON.stringify(data));\n  }, [userId, category, testNumber, questions, answers, currentQuestion, startTime, showResults]);\n\n  const categoryInfo = CATEGORY_INFO[category];\n  const totalQuestions = questions.length;\n  const progress = totalQuestions > 0 ? ((currentQuestion + 1) / totalQuestions) * 100 : 0;\n\n  const answeredCount = questions.reduce((count, q) => {\n    const userAnswer = answers[q.id];\n    return userAnswer && userAnswer.length > 0 ? count + 1 : count;\n  }, 0);\n  const allAnswered = totalQuestions > 0 && answeredCount === totalQuestions;\n\n  const handleAnswer = (value: string) => {\n    if (questions.length === 0) return;\n    const question = questions[currentQuestion];\n    const currentAnswers = answers[question.id] || [];\n    const newAnswers = currentAnswers.includes(value)\n      ? currentAnswers.filter((a) => a !== value)\n      : [...currentAnswers, value];\n    setAnswers({ ...answers, [question.id]: newAnswers });\n  };\n\n  const handleNext = () => {\n    if (currentQuestion < totalQuestions - 1) {\n      setCurrentQuestion((prev) => prev + 1);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentQuestion > 0) {\n      setCurrentQuestion((prev) => prev - 1);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!userId) return;\n\n    try {\n      // Calculate score\n      const score = calculateScore(questions, answers);\n      const timeElapsed = Math.floor((Date.now() - startTime) / 1000);\n\n      // Ensure user profile exists before saving test\n      const {\n        data: existingProfile,\n        error: profileCheckError,\n      } = await supabase\n        .from('user_profiles')\n        .select('id')\n        .eq('id', userId)\n        .maybeSingle();\n\n      if (profileCheckError) {\n        // Silent log for monitoring, but proceed to try insert\n        console.error('Error checking profile:', profileCheckError);\n      }\n\n      if (!existingProfile) {\n        if (user) {\n          const {\n            error: profileError,\n          } = await supabase\n            .from('user_profiles')\n            .insert({\n              id: user.id,\n              email: user.email || '',\n              full_name:\n                user.user_metadata?.full_name ||\n                user.email?.split('@')[0] ||\n                'User',\n            })\n            .select()\n            .single();\n\n          if (profileError) {\n            toast.error(t('test.createProfileError'));\n            setShowResults(true);\n            return;\n          }\n        } else {\n          toast.error(t('auth.loginAgain'));\n          router.push('/login');\n          return;\n        }\n      }\n\n      const {\n        data: testAttempt,\n        error: attemptError,\n      } = await supabase\n        .from('test_attempts')\n        .insert({\n          user_id: userId,\n          category,\n          test_number: testNumber,\n          score: score.correct,\n          total_questions: score.total,\n          percentage: score.percentage,\n          time_taken_seconds: timeElapsed,\n          completed_at: new Date().toISOString(),\n        })\n        .select()\n        .single();\n\n      if (attemptError) {\n        toast.error(t('test.saveError'));\n        setShowResults(true);\n        return;\n      }\n\n      setLastTestAttemptId(testAttempt.id);\n\n      // Invalidate cache to show updated results\n      queryClient.invalidateQueries({ queryKey: ['user-test-stats', userId] });\n      queryClient.invalidateQueries({ queryKey: ['dashboard-stats', userId] });\n\n      // Check if this is the user's first test\n      const {\n        count: testCount,\n      } = await supabase\n        .from('test_attempts')\n        .select('*', { count: 'exact', head: true })\n        .eq('user_id', userId);\n\n      // Check if user has already rated the app\n      const {\n        data: userProfile,\n      } = await supabase\n        .from('user_profiles')\n        .select('app_rating')\n        .eq('id', userId)\n        .single();\n\n      const isUserFirstTest = testCount === 1 && !userProfile?.app_rating;\n\n      // Save individual answers\n      if (testAttempt) {\n        const answersToSave = questions.map((q) => {\n          const userAnswer = answers[q.id] || [];\n          const correctAnswers =\n            q.correct_answers && q.correct_answers.length > 0\n              ? q.correct_answers\n              : [q.correct_answer];\n\n          const isCorrect =\n            userAnswer.length === correctAnswers.length &&\n            userAnswer.every((a) => correctAnswers.includes(a));\n\n          const selectedAnswerString =\n            userAnswer.length > 0 ? userAnswer.join(',') : null;\n\n          return {\n            test_attempt_id: testAttempt.id,\n            question_id: q.id,\n            selected_answer: selectedAnswerString,\n            is_correct: isCorrect,\n          };\n        });\n\n        const {\n          error: answersError,\n        } = await supabase\n          .from('test_attempt_answers')\n          .insert(answersToSave)\n          .select();\n\n        if (answersError) {\n          toast.error(t('test.saveDetailsError'));\n        }\n      }\n\n      // Clear local storage\n      const storageKey = `test_progress_${userId}_${category}_${testNumber}`;\n      localStorage.removeItem(storageKey);\n\n      setShowResults(true);\n\n      if (isUserFirstTest) {\n        setTimeout(() => {\n          setShowRatingModal(true);\n        }, 1500);\n      }\n    } catch (error) {\n      console.error('Error submitting test:', error);\n      toast.error(t('test.unexpectedError'));\n      setShowResults(true);\n    }\n  };\n\n  const score = calculateScore(questions, answers);\n  const weakTopics = showResults ? computeWeakTopics(questions, answers) : [];\n\n  if (authLoading || !user) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center px-4\">\n        <Card className=\"max-w-md w-full border border-border/80 bg-card/95 backdrop-blur-xl\">\n          <CardHeader>\n            <CardTitle>Loading</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-col items-center gap-4\">\n              <div className=\"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin\" />\n              <p className=\"text-muted-foreground\">\n                {authLoading ? 'Authenticating...' : 'Redirecting...'}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center px-4\">\n        <Card className=\"max-w-3xl w-full mx-auto border-primary/20 bg-card/95 backdrop-blur-xl shadow-xl shadow-primary/5\">\n          <CardHeader>\n            <Skeleton className=\"h-4 w-32 mb-3\" />\n            <Skeleton className=\"h-8 w-3/4\" />\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <Skeleton className=\"h-48 w-full rounded-xl\" />\n            <div className=\"space-y-3\">\n              {Array.from({ length: 3 }).map((_, i) => (\n                <div key={i} className=\"flex items-center gap-3\">\n                  <Skeleton className=\"h-5 w-5 rounded-md\" />\n                  <Skeleton className=\"h-4 flex-1\" />\n                </div>\n              ))}\n            </div>\n            <div className=\"flex gap-3\">\n              <Skeleton className=\"h-10 flex-1\" />\n              <Skeleton className=\"h-10 flex-1\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (questions.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Card className=\"max-w-md\">\n          <CardHeader>\n            <CardTitle>{t('test.noQuestionsTitle')}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground mb-4\">\n              {t('test.noQuestionsDescription')}\n            </p>\n            <Button asChild>\n              <Link href={`/category/${category.toLowerCase()}`}>\n                {t('test.backToTests')}\n              </Link>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (\n    !isAdmin &&\n    entitlementResult &&\n    !entitlementResult.entitlements.canStartNewTest &&\n    !showResults\n  ) {\n    const used = entitlementResult.testsTakenThisCycle;\n    const remaining = entitlementResult.entitlements.remainingFreeTests ?? 0;\n    const total = used + remaining;\n    const isSq = language === 'sq';\n\n    return (\n      <div className=\"min-h-screen bg-background text-foreground\">\n        {/* Background elements */}\n        <div className=\"pointer-events-none absolute inset-x-0 top-0 h-72 bg-gradient-to-b from-orange-500/20 via-transparent to-transparent blur-3xl\" />\n        \n        <div className=\"flex items-center justify-center min-h-screen p-4\">\n          <GlassCard className=\"w-full max-w-2xl p-8 md:p-10 border border-orange-500/30 bg-black/85 text-center relative overflow-hidden\">\n            <div className=\"pointer-events-none absolute -top-24 -right-24 w-64 h-64 bg-orange-500/10 rounded-full blur-3xl\" />\n            \n            <div className=\"relative z-10 flex flex-col items-center\">\n              <div className=\"w-16 h-16 rounded-full bg-orange-500/10 flex items-center justify-center mb-6 border border-orange-500/20\">\n                <Lock className=\"w-8 h-8 text-orange-400\" />\n              </div>\n              \n              <h1 className=\"text-3xl font-semibold mb-3 tracking-tight\">\n                {t('test.limitReachedTitle') || 'Free test limit reached'}\n              </h1>\n              <p className=\"text-base text-muted-foreground mb-8 max-w-lg mx-auto leading-relaxed\">\n                {t('test.limitReachedDescription') ||\n                  `You have used ${used}/${total} free tests for ${\n                    CATEGORY_INFO[category].name\n                  } this cycle.`}\n              </p>\n              \n              <div className=\"grid gap-4 text-left max-w-md mx-auto mb-8 w-full\">\n                {[\n                  t('test.unlimitedTestsBenefit'),\n                  t('test.fullReviewBenefit'),\n                  t('test.trainerUnlockedBenefit')\n                ].map((benefit, i) => (\n                  <div key={i} className=\"flex items-start gap-3 p-3 rounded-xl bg-white/5 border border-white/10\">\n                    <div className=\"mt-0.5 w-5 h-5 rounded-full bg-orange-500/20 flex items-center justify-center flex-shrink-0\">\n                      <div className=\"w-2 h-2 rounded-full bg-orange-400\" />\n                    </div>\n                    <span className=\"text-sm text-muted-foreground\">{benefit}</span>\n                  </div>\n                ))}\n              </div>\n\n              <div className=\"flex flex-col sm:flex-row gap-4 w-full max-w-sm\">\n                <Button asChild className=\"flex-1 bg-orange-500 hover:bg-orange-600 text-black font-medium h-11\">\n                  <Link href={`/pricing?category=${category}`}>\n                    {t('test.upgradeCta') || 'See plans'}\n                  </Link>\n                </Button>\n                <Button asChild variant=\"outline\" className=\"flex-1 h-11 border-white/10 hover:bg-white/5\">\n                  <Link href={`/category/${category.toLowerCase()}`}>\n                    {t('test.backToTests')}\n                  </Link>\n                </Button>\n              </div>\n            </div>\n          </GlassCard>\n        </div>\n      </div>\n    );\n  }\n\n  if (showResults) {\n    const passed = score.percentage >= 80;\n\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <header className=\"border-b border-border/40 bg-card/50 backdrop-blur-sm\">\n          <div className=\"container mx-auto px-4 py-4\">\n            <Button variant=\"ghost\" asChild>\n              <Link href={`/category/${category.toLowerCase()}`}>\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                {t('test.backToTests')}\n              </Link>\n            </Button>\n          </div>\n        </header>\n\n        <div className=\"container mx-auto px-4 py-16\">\n          <Card className=\"max-w-2xl mx-auto border border-border/80 bg-black/80 backdrop-blur-xl shadow-[0_30px_100px_rgba(0,0,0,0.9)]\">\n            <CardHeader className=\"text-center space-y-6\">\n              <div className=\"relative mx-auto w-24 h-24\">\n                <div\n                  className={`absolute inset-0 blur-2xl rounded-full ${\n                    passed ? 'bg-primary/30' : 'bg-destructive/30'\n                  }`}\n                />\n                <div\n                  className={`relative w-24 h-24 rounded-2xl flex items-center justify-center ${\n                    passed\n                      ? 'bg-gradient-to-br from-primary/20 to-primary/10 border-2 border-primary/30'\n                      : 'bg-gradient-to-br from-destructive/20 to-destructive/10 border-2 border-destructive/30'\n                  }`}\n                >\n                  <CheckCircle\n                    className={`w-14 h-14 ${\n                      passed ? 'text-primary' : 'text-destructive'\n                    }`}\n                  />\n                </div>\n              </div>\n              <div>\n                <CardTitle className=\"text-4xl font-bold mb-2\">\n                  {passed ? t('test.congratulations') : t('test.keepPracticing')}\n                </CardTitle>\n                <p className=\"text-muted-foreground text-lg\">\n                  {categoryInfo.name} -{' '}\n                  {testNumber === 'mixed'\n                    ? t('test.mixedName')\n                    : testNumber === 'personalized'\n                    ? t('test.personalizedName')\n                    : `${t('test.test')} ${testNumber}`}\n                </p>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-8\">\n              <div className=\"text-center\">\n                <div\n                  className={`text-7xl font-bold mb-3 ${\n                    passed ? 'text-primary' : 'text-destructive'\n                  }`}\n                >\n                  {score.percentage}%\n                </div>\n                <p className=\"text-muted-foreground text-lg\">\n                  {score.correct} {t('test.of')} {score.total}{' '}\n                  {t('test.correctAnswers')}\n                </p>\n              </div>\n\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between text-sm font-medium\">\n                  <span>{t('test.passingScore')}: 80%</span>\n                  <span\n                    className={passed ? 'text-primary' : 'text-destructive'}\n                  >\n                    {passed\n                      ? `✓ ${t('test.passed')}`\n                      : `✗ ${t('test.failed')}`}\n                  </span>\n                </div>\n                <div className=\"w-full bg-secondary rounded-full h-3 overflow-hidden\">\n                  <div\n                    className={`h-3 rounded-full transition-all ${\n                      passed\n                        ? 'bg-gradient-to-r from-primary to-primary/80'\n                        : 'bg-gradient-to-r from-destructive to-destructive/80'\n                    }`}\n                    style={{ width: `${score.percentage}%` }}\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"border rounded-lg p-4 bg-muted/40\">\n                  <h3 className=\"text-sm font-semibold mb-1\">\n                    {t('test.nextStepsTitle')}\n                  </h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {passed ? (\n                      isMixedTest || isPersonalizedTest ? (\n                        t('test.nextStepsPassedMixedOrPersonalized')\n                      ) : (\n                        t('test.nextStepsPassedStandard')\n                      )\n                    ) : isPersonalizedTest ? (\n                      t('test.nextStepsFailedPersonalized')\n                    ) : (\n                      t('test.nextStepsFailedStandard')\n                    )}\n                  </p>\n                  {weakTopics.length > 0 && (\n                    <>\n                      <p className=\"text-xs text-amber-500 mt-2\">\n                        {t('test.weakTopicsInThisTest')}\n                        {': '}\n                        {weakTopics.map((tTopic, idx) => (\n                          <span key={tTopic.topic}>\n                            {idx > 0 && ', '}\n                            {tTopic.topic}\n                          </span>\n                        ))}\n                      </p>\n\n                      <div className=\"mt-3 flex flex-wrap gap-2\">\n                        {weakTopics.map((tTopic) => {\n                          const query = encodeURIComponent(tTopic.topic);\n                          return (\n                            <Button\n                              key={tTopic.topic}\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"text-xs px-3 py-1\"\n                              asChild\n                            >\n                              <Link href={`/materials?search=${query}`}>\n                                {t('materials.title')}\n                              </Link>\n                            </Button>\n                          );\n                        })}\n                      </div>\n                    </>\n                  )}\n                </div>\n\n                <div className=\"flex flex-col sm:flex-row gap-3\">\n                  <Button variant=\"outline\" className=\"flex-1\" asChild>\n                    <Link href={`/category/${category.toLowerCase()}`}>\n                      {t('test.backToTests')}\n                    </Link>\n                  </Button>\n\n                  {lastTestAttemptId && (\n                    <Button className=\"flex-1\" variant=\"secondary\" asChild>\n                      <Link href={`/history/${lastTestAttemptId}`}>\n                        {t('test.reviewTest')}\n                      </Link>\n                    </Button>\n                  )}\n\n                  <Button\n                    className=\"flex-1\"\n                    onClick={async () => {\n                      if (!userId) return;\n                      try {\n                        setLoading(true);\n                        setShowResults(false);\n                        setAnswers({});\n                        setCurrentQuestion(0);\n                        setLastTestAttemptId(null);\n                        setShowRatingModal(false);\n                        setStartTime(Date.now());\n                        const reloaded = await loadQuestionsForTest({\n                          supabase,\n                          userId,\n                          category,\n                          testNumber,\n                        });\n                        setQuestions(reloaded);\n                      } catch (error) {\n                        console.error('Error reloading test:', error);\n                        toast.error('Could not restart test. Please try again.');\n                      } finally {\n                        setLoading(false);\n                      }\n                    }}\n                  >\n                    {t('test.retakeTest')}\n                  </Button>\n                </div>\n\n                <div className=\"flex flex-col sm:flex-row gap-3\">\n                  {!isPersonalizedTest && (\n                    <Button variant=\"outline\" className=\"flex-1\" asChild>\n                      <Link href={`/test/${category.toLowerCase()}/personalized`}>\n                        {t('test.practiceWeakPointsCta')}\n                      </Link>\n                    </Button>\n                  )}\n\n                  {!isMixedTest && (\n                    <Button variant=\"outline\" className=\"flex-1\" asChild>\n                      <Link href={`/test/${category.toLowerCase()}/mixed`}>\n                        {t('test.mixedTestCta')}\n                      </Link>\n                    </Button>\n                  )}\n\n                  <Button variant=\"outline\" className=\"flex-1\" asChild>\n                    <Link href=\"/decision-trainer\">\n                      {t('test.decisionTrainerCta')}\n                    </Link>\n                  </Button>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {userId && (\n          <RatingModal\n            open={showRatingModal}\n            onClose={() => setShowRatingModal(false)}\n            userId={userId}\n          />\n        )}\n      </div>\n    );\n  }\n\n  const question = questions[currentQuestion];\n\n  if (!question) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center px-4\">\n        <Card className=\"max-w-md w-full border border-border/80 bg-card/95 backdrop-blur-xl\">\n          <CardHeader>\n            <CardTitle>{t('test.noQuestionsTitle')}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground mb-4\">\n              {t('test.noQuestionsDescription')}\n            </p>\n            <Button asChild>\n              <Link href={`/category/${category.toLowerCase()}`}>\n                {t('test.backToTests')}\n              </Link>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const questionText = question.question_text;\n  const currentAnswer = answers[question.id] || [];\n  const topicQuery = question.topic ? encodeURIComponent(question.topic) : '';\n\n  const options = [\n    {\n      id: 'A',\n      text: question.option_a,\n    },\n    {\n      id: 'B',\n      text: question.option_b,\n    },\n    {\n      id: 'C',\n      text: question.option_c,\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b border-border/40 bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <Button variant=\"ghost\" asChild size=\"sm\">\n              <Link href={`/category/${category.toLowerCase()}`}>\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                {t('test.exitTest')}\n              </Link>\n            </Button>\n            <div className=\"text-sm font-semibold px-4 py-2 rounded-full bg-primary/10 border border-primary/20 text-primary\">\n              {t('test.question')} {currentQuestion + 1} {t('test.of')}{' '}\n              {totalQuestions}\n            </div>\n          </div>\n          <div className=\"w-full bg-secondary rounded-full h-2 overflow-hidden\">\n            <div\n              className=\"bg-gradient-to-r from-primary to-primary/80 h-2 rounded-full transition-all duration-300\"\n              style={{ width: `${progress}%` }}\n            />\n          </div>\n        </div>\n      </header>\n\n      {/* Question */}\n      <div className=\"container mx-auto px-4 py-8\">\n        <Card\n          className={`${\n            question.image_url ? 'max-w-6xl' : 'max-w-3xl'\n          } mx-auto border border-border/80 bg-black/80 backdrop-blur-xl shadow-[0_24px_80px_rgba(0,0,0,0.85)]`}\n        >\n          <CardHeader>\n            <div className=\"text-sm text-primary font-medium mb-3\">\n              {categoryInfo.name} -{' '}\n              {testNumber === 'mixed'\n                ? t('test.mixedName')\n                : testNumber === 'personalized'\n                ? t('test.personalizedName')\n                : `${t('test.test')} ${testNumber}`}\n            </div>\n            <CardTitle className=\"text-2xl md:text-3xl\">\n              {questionText}\n            </CardTitle>\n            {question.topic && topicQuery && (\n              <div className=\"mt-2 flex flex-wrap items-center gap-2\">\n                <span className=\"text-xs text-muted-foreground\">\n                  {question.topic}\n                </span>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-7 px-2 text-[11px]\"\n                  asChild\n                >\n                  <Link href={`/materials?search=${topicQuery}`}>\n                    {t('materials.title')}\n                  </Link>\n                </Button>\n              </div>\n            )}\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            {/* Side-by-side layout when image exists */}\n            <div\n              className={\n                question.image_url\n                  ? 'grid grid-cols-1 lg:grid-cols-2 gap-6'\n                  : ''\n              }\n            >\n              {/* Image Section */}\n              {question.image_url && (\n                <div className=\"flex flex-col\">\n                  <div className=\"relative rounded-xl overflow-hidden border-2 border-border shadow-lg\">\n                    <img\n                      src={question.image_url}\n                      alt={t('test.questionIllustration')}\n                      className=\"w-full h-auto object-contain bg-muted/30\"\n                      style={{ maxHeight: '400px' }}\n                    />\n                  </div>\n                  <p className=\"text-xs text-muted-foreground text-center mt-2\">\n                    {t('test.questionImage')}\n                  </p>\n                </div>\n              )}\n\n              {/* Options Section - Always use checkboxes for multiple selection */}\n              <div className=\"flex flex-col justify-center\">\n                <div className=\"space-y-3\">\n                  {options.map((option) => {\n                    const isSelected = currentAnswer.includes(option.id);\n                    return (\n                      <div\n                        key={option.id}\n                        className={`flex items-center gap-3 p-4 md:p-5 rounded-xl border transition-colors cursor-pointer ${\n                          isSelected\n                            ? 'border-primary/70 bg-primary/10 shadow-[0_18px_50px_rgba(0,0,0,0.9)]'\n                            : 'border-border/70 bg-black/60 hover:border-primary/50 hover:bg-black/80'\n                        }`}\n                        onClick={() => handleAnswer(option.id)}\n                      >\n                        <div\n                          className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center ${\n                            isSelected\n                              ? 'border-primary bg-primary text-primary-foreground'\n                              : 'border-border bg-black/60'\n                          }`}\n                        >\n                          {isSelected && (\n                            <CheckSquare className=\"w-3.5 h-3.5\" />\n                          )}\n                        </div>\n                        <Label className=\"cursor-pointer flex-1 font-medium\">\n                          <span className=\"font-semibold mr-2\">\n                            {option.id}.\n                          </span>\n                          {option.text}\n                        </Label>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex gap-3\">\n              <Button\n                variant=\"outline\"\n                onClick={handlePrevious}\n                disabled={currentQuestion === 0}\n                className=\"flex-1\"\n              >\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                {t('test.previous')}\n              </Button>\n              {currentQuestion === totalQuestions - 1 ? (\n                <Button\n                  onClick={handleSubmit}\n                  disabled={!allAnswered}\n                  className=\"flex-1\"\n                >\n                  {t('test.submitTest')}\n                  <CheckCircle className=\"w-4 h-4 ml-2\" />\n                </Button>\n              ) : (\n                <Button\n                  onClick={handleNext}\n                  disabled={currentAnswer.length === 0}\n                  className=\"flex-1\"\n                >\n                  {t('test.next')}\n                  <ArrowRight className=\"w-4 h-4 ml-2\" />\n                </Button>\n              )}\n            </div>\n\n            {/* Question Navigator - Smart Pagination */}\n            <div className=\"border-t pt-3\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <p className=\"text-xs text-muted-foreground\">\n                  {t('test.question')} {currentQuestion + 1} {t('test.of')}{' '}\n                  {totalQuestions}\n                </p>\n                <div className=\"flex items-center gap-1\">\n                  <span\n                    className={`w-2 h-2 rounded-full ${\n                      currentAnswer.length > 0 ? 'bg-primary' : 'bg-secondary'\n                    }`}\n                  />\n                  <span className=\"text-xs text-muted-foreground\">\n                    {answeredCount}/{totalQuestions}{' '}\n                    {t('test.answeredLabel')}\n                  </span>\n                </div>\n              </div>\n\n              {/* Compact scrollable navigation */}\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={() =>\n                    setCurrentQuestion(Math.max(0, currentQuestion - 5))\n                  }\n                  disabled={currentQuestion === 0}\n                  className=\"p-1 rounded hover:bg-secondary disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  <ArrowLeft className=\"w-3 h-3\" />\n                </button>\n\n                <div className=\"flex-1 overflow-x-auto scrollbar-hide\">\n                  <div className=\"flex gap-1\">\n                    {questions.map((q, idx) => {\n                      const distance = Math.abs(idx - currentQuestion);\n                      if (\n                        distance > 4 &&\n                        idx !== 0 &&\n                        idx !== totalQuestions - 1\n                      )\n                        return null;\n\n                      if (distance === 5) {\n                        return (\n                          <span\n                            key={`ellipsis-${idx}`}\n                            className=\"px-1 text-xs text-muted-foreground\"\n                          >\n                            ...\n                          </span>\n                        );\n                      }\n\n                      const answeredForQ =\n                        answers[q.id] && answers[q.id].length > 0;\n\n                      return (\n                        <button\n                          key={q.id}\n                          onClick={() => setCurrentQuestion(idx)}\n                          className={`min-w-[28px] h-7 px-2 rounded text-xs font-medium transition-colors whitespace-nowrap ${\n                            idx === currentQuestion\n                              ? 'bg-primary text-primary-foreground'\n                              : answeredForQ\n                              ? 'bg-primary/20 text-primary'\n                              : 'bg-secondary hover:bg-secondary/80'\n                          }`}\n                        >\n                          {idx + 1}\n                        </button>\n                      );\n                    })}\n                  </div>\n                </div>\n\n                <button\n                  onClick={() =>\n                    setCurrentQuestion(\n                      Math.min(totalQuestions - 1, currentQuestion + 5),\n                    )\n                  }\n                  disabled={currentQuestion === totalQuestions - 1}\n                  className=\"p-1 rounded hover:bg-secondary disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  <ArrowRight className=\"w-3 h-3\" />\n                </button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\n/* Helpers */\n\nfunction shuffleArray<T>(items: T[]): T[] {\n  return [...items].sort(() => 0.5 - Math.random());\n}\n\nasync function getPersonalizedQuestions({\n  supabase,\n  userId,\n  category,\n}: {\n  supabase: SupabaseClient;\n  userId: string;\n  category: LicenseCategory;\n}): Promise<Question[]> {\n  const { data: testAttempts, error: attemptsError } = await supabase\n    .from('test_attempts')\n    .select('id')\n    .eq('user_id', userId)\n    .eq('category', category);\n\n  if (attemptsError) {\n    throw new Error(`Error fetching test attempts: ${attemptsError.message}`);\n  }\n\n  const testAttemptIds = testAttempts?.map((t) => t.id) || [];\n  if (testAttemptIds.length === 0) return [];\n\n  const { data: wrongAnswers, error: answersError } = await supabase\n    .from('test_attempt_answers')\n    .select('question_id')\n    .eq('is_correct', false)\n    .in('test_attempt_id', testAttemptIds);\n\n  if (answersError) {\n    throw new Error(`Error fetching wrong answers: ${answersError.message}`);\n  }\n\n  const wrongQuestionIds = [\n    ...new Set(wrongAnswers?.map((a) => a.question_id) || []),\n  ];\n  if (wrongQuestionIds.length === 0) return [];\n\n  const { data: wrongQuestions, error: questionsError } = await supabase\n    .from('admin_questions')\n    .select('*')\n    .in('id', wrongQuestionIds)\n    .eq('category', category);\n\n  if (questionsError) {\n    throw new Error(`Error fetching questions: ${questionsError.message}`);\n  }\n\n  let personalizedQuestions: Question[] = (wrongQuestions || []) as Question[];\n\n  if (personalizedQuestions.length < 10) {\n    const { data: allQuestions } = await supabase\n      .from('admin_questions')\n      .select('*')\n      .eq('category', category);\n\n    if (allQuestions && allQuestions.length > 0) {\n      const existingIds = new Set(personalizedQuestions.map((q) => q.id));\n      const availableQuestions = (allQuestions as Question[]).filter(\n        (q) => !existingIds.has(q.id),\n      );\n      const shuffled = shuffleArray(availableQuestions);\n      const needed = 10 - personalizedQuestions.length;\n      personalizedQuestions = [\n        ...personalizedQuestions,\n        ...shuffled.slice(0, Math.max(0, needed)),\n      ];\n    }\n  }\n\n  return shuffleArray(personalizedQuestions).slice(0, 10);\n}\n\nasync function getMixedQuestions({\n  supabase,\n  category,\n}: {\n  supabase: SupabaseClient;\n  category: LicenseCategory;\n}): Promise<Question[]> {\n  const { data, error } = await supabase\n    .from('admin_questions')\n    .select('*')\n    .eq('category', category);\n\n  if (error) {\n    throw new Error(`Error fetching mixed questions: ${error.message}`);\n  }\n\n  if (!data || data.length === 0) {\n    return [];\n  }\n\n  const shuffled = shuffleArray(data as Question[]);\n  return shuffled.slice(0, Math.min(10, shuffled.length));\n}\n\nasync function getFixedTestQuestions({\n  supabase,\n  category,\n  testNumber,\n}: {\n  supabase: SupabaseClient;\n  category: LicenseCategory;\n  testNumber: string;\n}): Promise<Question[]> {\n  const parsedNumber = parseInt(testNumber, 10);\n  if (Number.isNaN(parsedNumber)) {\n    throw new Error('Invalid test number');\n  }\n\n  const { data, error } = await supabase\n    .from('admin_questions')\n    .select('*')\n    .eq('category', category)\n    .eq('test_number', parsedNumber);\n\n  if (error) {\n    throw new Error(`Error fetching fixed test questions: ${error.message}`);\n  }\n\n  if (!data || data.length === 0) {\n    return [];\n  }\n\n  return data as Question[];\n}\n\nasync function loadQuestionsForTest({\n  supabase,\n  userId,\n  category,\n  testNumber,\n}: {\n  supabase: SupabaseClient;\n  userId: string;\n  category: LicenseCategory;\n  testNumber: string;\n}): Promise<Question[]> {\n  if (testNumber === 'personalized') {\n    const personalized = await getPersonalizedQuestions({\n      supabase,\n      userId,\n      category,\n    });\n    if (personalized.length > 0) return personalized;\n    return getMixedQuestions({ supabase, category });\n  }\n\n  if (testNumber === 'mixed') {\n    return getMixedQuestions({ supabase, category });\n  }\n\n  return getFixedTestQuestions({ supabase, category, testNumber });\n}\n\nfunction calculateScore(\n  questions: Question[],\n  answers: Record<string, string[]>,\n) {\n  const totalQuestions = questions.length;\n  let correct = 0;\n\n  questions.forEach((q) => {\n    const userAnswer = answers[q.id] || [];\n    const correctAnswers =\n      q.correct_answers && q.correct_answers.length > 0\n        ? q.correct_answers\n        : [q.correct_answer];\n\n    const isCorrect =\n      userAnswer.length === correctAnswers.length &&\n      userAnswer.every((a) => correctAnswers.includes(a));\n\n    if (isCorrect) correct += 1;\n  });\n\n  return {\n    correct,\n    total: totalQuestions,\n    percentage:\n      totalQuestions > 0\n        ? Math.round((correct / totalQuestions) * 100)\n        : 0,\n  };\n}\n\nfunction computeWeakTopics(\n  questions: Question[],\n  answers: Record<string, string[]>,\n) {\n  const topicStatsMap: Record<string, { total: number; correct: number }> = {};\n\n  questions.forEach((q) => {\n    const topic = q.topic;\n    if (!topic) return;\n\n    if (!topicStatsMap[topic]) {\n      topicStatsMap[topic] = { total: 0, correct: 0 };\n    }\n\n    const userAnswer = answers[q.id] || [];\n    const correctAnswers =\n      q.correct_answers && q.correct_answers.length > 0\n        ? q.correct_answers\n        : [q.correct_answer];\n\n    const isCorrect =\n      userAnswer.length === correctAnswers.length &&\n      userAnswer.every((a) => correctAnswers.includes(a));\n\n    topicStatsMap[topic].total += 1;\n    if (isCorrect) {\n      topicStatsMap[topic].correct += 1;\n    }\n  });\n\n  const topicStats = Object.entries(topicStatsMap)\n    .map(([topic, stats]) => {\n      const accuracy =\n        stats.total > 0 ? stats.correct / stats.total : 0;\n      return {\n        topic,\n        total: stats.total,\n        correct: stats.correct,\n        accuracy,\n      };\n    })\n    .sort((a, b) => a.accuracy - b.accuracy);\n\n  return topicStats.filter((t) => t.total >= 2 && t.accuracy < 0.8).slice(0, 3);\n}"],"names":[],"mappings":"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"}