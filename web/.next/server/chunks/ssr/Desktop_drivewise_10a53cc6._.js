module.exports=[6396,a=>{"use strict";let b=(0,a.i(2017).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["default",()=>b])},10226,a=>{"use strict";let b=(0,a.i(2017).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);a.s(["Trash2",()=>b],10226)},14505,a=>{"use strict";var b=a.i(681),c=a.i(84813),d=a.i(46444);let e=c.forwardRef(({className:a,type:c,...e},f)=>(0,b.jsx)("input",{type:c,className:(0,d.cn)("flex h-10 w-full rounded-xl border border-input/70 bg-background/60 px-3.5 py-2 text-sm text-foreground shadow-[0_8px_24px_rgba(0,0,0,0.7)] backdrop-blur-xl","transition-all duration-200 file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground/80","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/80 focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:cursor-not-allowed disabled:opacity-50",a),ref:f,...e}));e.displayName="Input",a.s(["Input",()=>e])},63875,a=>{"use strict";var b=a.i(681),c=a.i(84813),d=a.i(46444);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("label",{ref:e,className:(0,d.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",a),...c}));e.displayName="Label",a.s(["Label",()=>e])},98065,a=>{"use strict";var b=a.i(681),c=a.i(84813),d=a.i(46444);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("textarea",{className:(0,d.cn)("flex min-h-[80px] w-full rounded-xl border border-input/70 bg-background/60 px-3.5 py-2.5 text-sm text-foreground shadow-[0_8px_24px_rgba(0,0,0,0.7)] backdrop-blur-xl","transition-all duration-200 placeholder:text-muted-foreground/80","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/80 focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:cursor-not-allowed disabled:opacity-50",a),ref:e,...c}));e.displayName="Textarea",a.s(["Textarea",()=>e])},64,a=>{"use strict";let b=(0,a.i(2017).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);a.s(["Save",()=>b],64)},35644,a=>{"use strict";var b=a.i(60854),c=a.i(20416),d=a.i(37979),e=a.i(25761);function f(a={}){let{search:c,chapterId:d,category:g,page:h=1,pageSize:i=50,includeUnpublished:j=!1,fields:k="*"}=a,l=(0,e.createClient)();return(0,b.useQuery)({queryKey:["materials",c,d,g,h,i,j,k],queryFn:async()=>{let a=(h-1)*i,b=l.from("study_materials").select(k,{count:"planned"}).order("order_index",{ascending:!0});if(d&&(b=b.eq("chapter_id",d)),g&&(b=b.eq("category",g)),j||(b=b.eq("is_published",!0)),c&&c.trim()){let a=c.trim();b=b.ilike("title",`%${a}%`)}let{data:e,error:f,count:m}=await b.range(a,a+i-1);if(f)throw f;let n=e||[];if("*"!==k)return{materials:n,total:m||0};let o=n.map(a=>a.id),p=[];if(o.length>0){let{data:a,error:b}=await l.from("material_images").select("*").in("material_id",o).order("order_index",{ascending:!0}).order("created_at",{ascending:!0});if(b)throw b;p=a||[]}return{materials:n.map(a=>({...a,images:p.filter(b=>b.material_id===a.id)})),total:m||0}}})}function g(a){let c=(0,e.createClient)();return(0,b.useQuery)({queryKey:["material-by-chapter",a],queryFn:async()=>{if(void 0===a)return null;let{data:b,error:d}=await c.from("study_materials").select("*").eq("chapter_id",a).single();if(d)throw d;let{data:e,error:f}=await c.from("material_images").select("*").eq("material_id",b.id).order("order_index",{ascending:!0}).order("created_at",{ascending:!0});if(f)throw f;return{...b,images:e||[]}},enabled:!!a,staleTime:3e5})}function h(a){let c=(0,e.createClient)();return(0,b.useQuery)({queryKey:["material",a],queryFn:async()=>{if(!a)return null;let{data:b,error:d}=await c.from("study_materials").select("*").eq("id",a).single();if(d)throw d;let{data:e,error:f}=await c.from("material_images").select("*").eq("material_id",a).order("order_index",{ascending:!0}).order("created_at",{ascending:!0});if(f)throw f;return{...b,images:e||[]}},enabled:!!a})}function i(){let a=(0,d.useQueryClient)(),b=(0,e.createClient)();return(0,c.useMutation)({mutationFn:async a=>{let{data:c,error:d}=await b.from("study_materials").insert([a]).select().single();if(d)throw Error(d.message||d.details||"Failed to create material");return c},onSuccess:()=>{a.invalidateQueries({queryKey:["materials"]})}})}function j(){let a=(0,d.useQueryClient)(),b=(0,e.createClient)();return(0,c.useMutation)({mutationFn:async({id:a,...c})=>{let{data:d,error:e}=await b.from("study_materials").update(c).eq("id",a).select().single();if(e)throw Error(e.message||e.details||"Failed to update material");return d},onSuccess:b=>{a.invalidateQueries({queryKey:["materials"]}),a.invalidateQueries({queryKey:["material",b.id]})}})}function k(){let a=(0,d.useQueryClient)(),b=(0,e.createClient)();return(0,c.useMutation)({mutationFn:async a=>{let{error:c}=await b.from("study_materials").delete().eq("id",a);if(c)throw Error(c.message||"Failed to delete material");return a},onSuccess:()=>{a.invalidateQueries({queryKey:["materials"]})}})}function l(){let a=(0,d.useQueryClient)(),b=(0,e.createClient)();return(0,c.useMutation)({mutationFn:async a=>{let{data:c,error:d}=await b.from("material_images").insert([a]).select().single();if(d)throw Error(d.message||d.details||"Failed to create material image");return c},onSuccess:b=>{a.invalidateQueries({queryKey:["material",b.material_id]}),a.invalidateQueries({queryKey:["materials"]})}})}function m(){let a=(0,d.useQueryClient)(),b=(0,e.createClient)();return(0,c.useMutation)({mutationFn:async a=>{let{data:c,error:d}=await b.from("material_images").delete().eq("id",a).select().single();if(d)throw Error(d.message||"Failed to delete material image");return c},onSuccess:b=>{b?.material_id&&a.invalidateQueries({queryKey:["material",b.material_id]}),a.invalidateQueries({queryKey:["materials"]})}})}function n(){let a=(0,e.createClient)();return(0,c.useMutation)({mutationFn:async b=>{let c=b.name.split(".").pop()||"jpg",d=`${Date.now()}-${Math.random().toString(36).slice(2)}`,e=`materials/${d}.${c}`,{error:f}=await a.storage.from("material-images").upload(e,b,{cacheControl:"3600",upsert:!1});if(f)throw Error(f.message||"Failed to upload material image");let{data:{publicUrl:g}}=a.storage.from("material-images").getPublicUrl(e);return g}})}a.s(["useCreateMaterial",()=>i,"useCreateMaterialImage",()=>l,"useDeleteMaterial",()=>k,"useDeleteMaterialImage",()=>m,"useMaterial",()=>h,"useMaterialByChapterId",()=>g,"useMaterials",()=>f,"useUpdateMaterial",()=>j,"useUploadMaterialImage",()=>n])},68518,a=>{"use strict";let b=(0,a.i(2017).default)("image-plus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);a.s(["ImagePlus",()=>b],68518)},67601,a=>{"use strict";var b=a.i(681),c=a.i(84813),d=a.i(53365),e=a.i(22309),f=a.i(78330),g=a.i(93639),h=a.i(663),i=a.i(14505),j=a.i(63875),k=a.i(98065),l=a.i(42185),m=a.i(34213),n=a.i(35644),o=a.i(61334),p=a.i(40591),q=a.i(64),r=a.i(68518),s=a.i(10226),t=a.i(1004);function u({params:a}){let{id:u}=(0,c.use)(a),{user:v,isAdmin:w,loading:x}=(0,e.useAuth)(),y=(0,d.useRouter)(),{data:z,isLoading:A}=(0,n.useMaterial)(u),B=(0,n.useUpdateMaterial)(),C=(0,n.useUploadMaterialImage)(),D=(0,n.useCreateMaterialImage)(),E=(0,n.useDeleteMaterialImage)(),[F,G]=(0,c.useState)({chapter_id:1,category:"B",order_index:1,title:"",content_text:"{\n  \n}",is_published:!0}),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)("");(0,c.useEffect)(()=>{x||v&&w||y.push("/")},[v,w,x,y]),(0,c.useEffect)(()=>{z&&G({chapter_id:z.chapter_id,category:z.category||"B",order_index:z.order_index,title:z.title,content_text:JSON.stringify(z.content||{},null,2),is_published:z.is_published})},[z]);let N=async a=>{a.preventDefault();let b=[];F.title.trim()||b.push("Title is required"),(!F.chapter_id||F.chapter_id<1||F.chapter_id>20)&&b.push("Chapter must be between 1 and 20"),F.order_index||b.push("Order index is required");let c={};try{c=JSON.parse(F.content_text||"{}")}catch{b.push("Content must be valid JSON")}if(b.length>0)return void o.toast.error(b[0]);try{await B.mutateAsync({id:u,chapter_id:F.chapter_id,category:F.category,order_index:F.order_index,title:F.title.trim(),content:c,is_published:F.is_published}),o.toast.success("Material updated successfully!"),setTimeout(()=>{y.push("/admin/materials")},500)}catch(b){let a=b instanceof Error?b.message:"Failed to update material";o.toast.error(a)}},O=async()=>{if(!z)return void o.toast.error("Material not loaded yet");if(!H)return void o.toast.error("Please select an image file");try{let a=""===L?(z.images?.length||0)+1:Number(L)||null,b=await C.mutateAsync(H);await D.mutateAsync({material_id:z.id,image_url:b,caption:J||void 0,order_index:null===a?void 0:a}),o.toast.success("Image added successfully"),I(null),K(""),M("")}catch(b){let a=b instanceof Error?b.message:"Failed to add image";o.toast.error(a)}},P=async a=>{try{await E.mutateAsync(a),o.toast.success("Image deleted")}catch(b){let a=b instanceof Error?b.message:"Failed to delete image";o.toast.error(a)}};return x||A?(0,b.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]})}):v&&w&&z?(0,b.jsxs)("div",{className:"min-h-screen bg-background text-foreground",children:[(0,b.jsx)(f.Navbar,{}),(0,b.jsxs)(m.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto px-6 py-8 max-w-4xl pt-28",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("div",{className:"flex gap-2 mb-4",children:(0,b.jsx)(h.Button,{variant:"ghost",asChild:!0,children:(0,b.jsxs)(t.default,{href:"/admin/materials",children:[(0,b.jsx)(p.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Materials"]})})}),(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Edit Study Material"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Chapter ",z.chapter_id," â€“ ",z.title]})]}),(0,b.jsx)("form",{onSubmit:N,children:(0,b.jsxs)(g.GlassCard,{className:"p-6 space-y-6 border border-border/80 bg-black/80",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"chapter_id",children:"Chapter *"}),(0,b.jsxs)(l.Select,{value:String(F.chapter_id),onValueChange:a=>{let b=parseInt(a,10)||1;G({...F,chapter_id:b})},children:[(0,b.jsx)(l.SelectTrigger,{id:"chapter_id",children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsx)(l.SelectContent,{children:Array.from({length:20}).map((a,c)=>{let d=c+1;return(0,b.jsxs)(l.SelectItem,{value:String(d),children:["Chapter ",d]},d)})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"order_index",children:"Order Index *"}),(0,b.jsx)(i.Input,{id:"order_index",type:"number",min:"1",value:F.order_index,onChange:a=>G({...F,order_index:parseInt(a.target.value,10)||1}),required:!0})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"title",children:"Title *"}),(0,b.jsx)(i.Input,{id:"title",value:F.title,onChange:a=>G({...F,title:a.target.value}),required:!0})]}),(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"content_text",children:"Content (JSON) *"}),(0,b.jsx)(k.Textarea,{id:"content_text",rows:10,value:F.content_text,onChange:a=>G({...F,content_text:a.target.value}),className:"font-mono text-xs",required:!0})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-3 pt-2",children:[(0,b.jsx)("input",{id:"is_published",type:"checkbox",checked:F.is_published,onChange:a=>G({...F,is_published:a.target.checked})}),(0,b.jsx)(j.Label,{htmlFor:"is_published",className:"text-sm",children:"Published (visible to users)"})]}),(0,b.jsxs)("div",{className:"space-y-4 pt-4 border-t border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(r.ImagePlus,{className:"w-4 h-4"}),(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Material Images"})]}),(0,b.jsxs)("div",{className:"grid gap-6 md:grid-cols-[minmax(0,2fr),minmax(0,3fr)]",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"image_file",children:"Add Image"}),(0,b.jsx)("input",{id:"image_file",type:"file",accept:"image/*",onChange:a=>I(a.target.files?.[0]||null),className:"block w-full text-sm text-muted-foreground"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"image_caption",children:"Caption"}),(0,b.jsx)(i.Input,{id:"image_caption",value:J,onChange:a=>K(a.target.value),placeholder:"Optional caption"})]}),(0,b.jsxs)("div",{className:"space-y-2 max-w-xs",children:[(0,b.jsx)(j.Label,{htmlFor:"image_order_index",children:"Order Index"}),(0,b.jsx)(i.Input,{id:"image_order_index",type:"number",min:"1",value:""===L?"":L,onChange:a=>{let b=a.target.value;M(""===b?"":parseInt(b,10)||"")},placeholder:"Leave empty to append at the end"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Images are shown above the chapter content on the materials page."})]}),(0,b.jsx)(h.Button,{type:"button",onClick:O,disabled:C.isPending||D.isPending||!z,className:"shadow-sm",children:C.isPending||D.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Uploading..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.ImagePlus,{className:"w-4 h-4 mr-2"}),"Upload Image"]})})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Existing Images"}),z.images&&0!==z.images.length?(0,b.jsx)("div",{className:"grid grid-cols-2 gap-3",children:z.images.map(a=>(0,b.jsxs)("div",{className:"border border-border rounded-md overflow-hidden bg-muted/30 flex flex-col",children:[(0,b.jsx)("div",{className:"aspect-video bg-muted",children:(0,b.jsx)("img",{src:a.image_url,alt:a.caption||"Material image",className:"w-full h-full object-cover",loading:"lazy"})}),(0,b.jsxs)("div",{className:"p-2 space-y-1 text-xs",children:[(0,b.jsx)("p",{className:"font-medium truncate",children:a.caption||"No caption"}),"number"==typeof a.order_index&&(0,b.jsxs)("p",{className:"text-[10px] text-muted-foreground",children:["Order: ",a.order_index]}),(0,b.jsx)("div",{className:"flex justify-end pt-1",children:(0,b.jsx)(h.Button,{type:"button",variant:"destructive",size:"icon",className:"h-7 w-7",onClick:()=>P(a.id),disabled:E.isPending,children:(0,b.jsx)(s.Trash2,{className:"w-3 h-3"})})})]})]},a.id))}):(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"No images added for this material yet."})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,b.jsx)(h.Button,{type:"submit",disabled:B.isPending,className:"flex-1 shadow-lg shadow-primary/20",children:B.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Updating..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.Save,{className:"w-4 h-4 mr-2"}),"Update Material"]})}),(0,b.jsx)(h.Button,{type:"button",variant:"outline",onClick:()=>y.push("/admin/materials"),disabled:B.isPending,children:"Cancel"})]})]})})]})]}):null}a.s(["default",()=>u])}];

//# sourceMappingURL=Desktop_drivewise_10a53cc6._.js.map