{"version":3,"sources":["turbopack:///[project]/Desktop/drivewise/web/lib/subscriptions.ts","turbopack:///[project]/Desktop/drivewise/web/components/ui/badge.tsx","turbopack:///[project]/Desktop/drivewise/web/app/(pages)/admin/subscriptions/page.tsx"],"sourcesContent":["import type { LicenseCategory } from '@/types/database';\r\n\r\n// Plan identifiers\r\nexport type PlanTier = 'FREE' | 'PLAN_A' | 'PLAN_B' | 'PLAN_C';\r\n\r\nexport type PaidPlanTier = Exclude<PlanTier, 'FREE'>;\r\n\r\nexport interface PlanDefinition {\r\n  id: PaidPlanTier;\r\n  label: string;\r\n  months: number;\r\n  priceEur: number;\r\n  // derived convenience fields\r\n  pricePerMonthEur: number;\r\n  badge?: 'MOST_POPULAR' | 'BEST_VALUE';\r\n  emphasize?: boolean;\r\n}\r\n\r\nexport interface BillingConfig {\r\n  freeTestLimitPerCategory: number;\r\n  paidTestLimitPerCategory: number;\r\n  billingCycleDays: number;\r\n  bestValuePlan: PaidPlanTier;\r\n  plans: Record<PaidPlanTier, PlanDefinition>;\r\n}\r\n\r\n// Centralized billing / pricing configuration.\r\n// Values can be overridden via NEXT_PUBLIC_* env vars without changing code.\r\nconst freeLimit = Number(process.env.NEXT_PUBLIC_FREE_TEST_LIMIT_PER_CATEGORY ?? '3');\r\nconst paidLimit = Number(process.env.NEXT_PUBLIC_PAID_TEST_LIMIT_PER_CATEGORY ?? '9999');\r\nconst cycleDays = Number(process.env.NEXT_PUBLIC_BILLING_CYCLE_DAYS ?? '30');\r\nconst bestValueEnv = process.env.NEXT_PUBLIC_PAYMENT_BEST_VALUE_PLAN as PaidPlanTier | undefined;\r\n\r\nconst rawPlans: Omit<PlanDefinition, 'pricePerMonthEur'>[] = [\r\n  {\r\n    id: 'PLAN_A',\r\n    label: '1 month',\r\n    months: 1,\r\n    priceEur: 3,\r\n  },\r\n  {\r\n    id: 'PLAN_B',\r\n    label: '2 months',\r\n    months: 2,\r\n    priceEur: 6,\r\n  },\r\n  {\r\n    id: 'PLAN_C',\r\n    label: '3 months',\r\n    months: 3,\r\n    priceEur: 8,\r\n    badge: 'BEST_VALUE',\r\n    emphasize: true,\r\n  },\r\n];\r\n\r\nconst plansRecord = rawPlans.reduce<Record<PaidPlanTier, PlanDefinition>>((acc, plan) => {\r\n  const pricePerMonthEur = plan.priceEur / plan.months;\r\n  acc[plan.id] = { ...plan, pricePerMonthEur };\r\n  return acc;\r\n}, {} as Record<PaidPlanTier, PlanDefinition>);\r\n\r\nexport const BILLING_CONFIG: BillingConfig = {\r\n  freeTestLimitPerCategory: freeLimit,\r\n  paidTestLimitPerCategory: paidLimit,\r\n  billingCycleDays: cycleDays,\r\n  bestValuePlan: bestValueEnv ?? 'PLAN_C',\r\n  plans: plansRecord,\r\n};\r\n\r\nexport interface CategoryPlan {\r\n  id: string;\r\n  userId: string;\r\n  category: LicenseCategory;\r\n  planTier: PaidPlanTier;\r\n  startDate: string; // ISO\r\n  endDate: string;   // ISO\r\n  isActive: boolean;\r\n  createdAt: string; // ISO\r\n}\r\n\r\nexport interface Entitlements {\r\n  canAccessTests: boolean;\r\n  canStartNewTest: boolean;\r\n  remainingFreeTests?: number;\r\n  canAccessDecisionTrainer: boolean;\r\n  canAccessStudyMaterial: boolean;\r\n  canReviewTestsInDetail: boolean;\r\n}\r\n\r\nexport interface EntitlementInput {\r\n  isAdmin: boolean;\r\n  testsTakenThisCycle: number;\r\n  activePlan?: Pick<CategoryPlan, 'planTier' | 'startDate' | 'endDate' | 'isActive'> | null;\r\n  now?: Date;\r\n}\r\n\r\nexport function isPlanCurrentlyActive(plan?: { startDate: string; endDate: string } | null, now: Date = new Date()): boolean {\r\n  if (!plan) return false;\r\n  const start = new Date(plan.startDate).getTime();\r\n  const end = new Date(plan.endDate).getTime();\r\n  const ts = now.getTime();\r\n  return ts >= start && ts <= end;\r\n}\r\n\r\nexport function computeEntitlements(input: EntitlementInput): Entitlements {\r\n  const { isAdmin, testsTakenThisCycle, activePlan, now } = input;\r\n\r\n  if (isAdmin) {\r\n    return {\r\n      canAccessTests: true,\r\n      canStartNewTest: true,\r\n      remainingFreeTests: undefined,\r\n      canAccessDecisionTrainer: true,\r\n      canAccessStudyMaterial: true,\r\n      canReviewTestsInDetail: true,\r\n    };\r\n  }\r\n\r\n  const hasActivePaidPlan = !!activePlan && isPlanCurrentlyActive(\r\n    { startDate: activePlan.startDate, endDate: activePlan.endDate },\r\n    now,\r\n  );\r\n\r\n  if (hasActivePaidPlan) {\r\n    return {\r\n      canAccessTests: true,\r\n      canStartNewTest: testsTakenThisCycle < BILLING_CONFIG.paidTestLimitPerCategory,\r\n      remainingFreeTests: Math.max(\r\n        0,\r\n        BILLING_CONFIG.paidTestLimitPerCategory - testsTakenThisCycle,\r\n      ),\r\n      canAccessDecisionTrainer: true,\r\n      canAccessStudyMaterial: true,\r\n      canReviewTestsInDetail: true,\r\n    };\r\n  }\r\n\r\n  const remainingFree = Math.max(0, BILLING_CONFIG.freeTestLimitPerCategory - testsTakenThisCycle);\r\n\r\n  return {\r\n    canAccessTests: true,\r\n    canStartNewTest: remainingFree > 0,\r\n    remainingFreeTests: remainingFree,\r\n    canAccessDecisionTrainer: false,\r\n    canAccessStudyMaterial: false,\r\n    canReviewTestsInDetail: false,\r\n  };\r\n}\r\n\r\nexport interface CycleUsageInput {\r\n  attempts: { category: string; completed_at: string }[];\r\n  category: LicenseCategory;\r\n  now?: Date;\r\n}\r\n\r\nexport function countTestsInCurrentCycle(input: CycleUsageInput): number {\r\n  const { attempts, category, now } = input;\r\n  const current = now ?? new Date();\r\n  const cycleStart = new Date(current);\r\n  cycleStart.setDate(cycleStart.getDate() - BILLING_CONFIG.billingCycleDays + 1);\r\n  const startTs = cycleStart.getTime();\r\n  const endTs = current.getTime();\r\n\r\n  return attempts.filter((a) => {\r\n    if (a.category !== category) return false;\r\n    const ts = new Date(a.completed_at).getTime();\r\n    return ts >= startTs && ts <= endTs;\r\n  }).length;\r\n}\r\n","import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-[11px] font-semibold tracking-tight transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-ring/70 focus:ring-offset-2 focus:ring-offset-background\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"border-transparent bg-primary/90 text-primary-foreground hover:bg-primary\",\r\n        secondary:\r\n          \"border-transparent bg-secondary/80 text-secondary-foreground hover:bg-secondary\",\r\n        destructive:\r\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\r\n        outline: \"border-border/70 text-foreground/80 bg-background/40\",\r\n        success:\r\n          \"border-transparent bg-green-500 text-white hover:bg-green-500/80\",\r\n        warning:\r\n          \"border-transparent bg-yellow-500 text-white hover:bg-yellow-500/80\",\r\n        info:\r\n          \"border-transparent bg-blue-500 text-white hover:bg-blue-500/80\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface BadgeProps\r\n  extends React.HTMLAttributes<HTMLDivElement>,\r\n    VariantProps<typeof badgeVariants> {}\r\n\r\nfunction Badge({ className, variant, ...props }: BadgeProps) {\r\n  return (\r\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\r\n  )\r\n}\r\n\r\nexport { Badge, badgeVariants }\r\n","'use client';\r\n\r\nimport { useMemo, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { createClient } from '@/utils/supabase/client';\r\nimport { Navbar } from '@/components/navbar';\r\nimport { GlassCard } from '@/components/ui/glass-card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { CATEGORY_INFO, type LicenseCategory } from '@/types/database';\r\nimport { useAuth } from '@/contexts/auth-context';\r\nimport {\r\n  BILLING_CONFIG,\r\n  isPlanCurrentlyActive,\r\n  type PaidPlanTier,\r\n} from '@/lib/subscriptions';\r\n// We now use a dedicated admin API route for granting plans\r\nimport { toast } from 'sonner';\r\n\r\ninterface AdminUserProfile {\r\n  id: string;\r\n  email: string | null;\r\n  full_name: string | null;\r\n  created_at: string;\r\n}\r\n\r\ninterface AdminUserPlan {\r\n  id: string;\r\n  user_id: string;\r\n  category: LicenseCategory;\r\n  plan_tier: string;\r\n  start_date: string;\r\n  end_date: string;\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\nconst LICENSE_CATEGORIES: LicenseCategory[] = ['A', 'B', 'C', 'D'];\r\n\r\nexport default function AdminSubscriptionsPage() {\r\n  const router = useRouter();\r\n  const { user, loading: authLoading, isAdmin } = useAuth();\r\n  const queryClient = useQueryClient();\r\n  const supabase = createClient();\r\n\r\n  const [selectedPlanTier, setSelectedPlanTier] = useState<PaidPlanTier>(\r\n    BILLING_CONFIG.bestValuePlan,\r\n  );\r\n\r\n  const { data, isLoading, error } = useQuery({\r\n    queryKey: ['admin-subscriptions'],\r\n    queryFn: async () => {\r\n      const [profilesRes, plansRes] = await Promise.all([\r\n        supabase\r\n          .from('user_profiles')\r\n          .select('id, email, full_name, created_at')\r\n          .order('created_at'),\r\n        supabase.from('user_plans').select('*'),\r\n      ]);\r\n\r\n      if (profilesRes.error) throw profilesRes.error;\r\n      if (plansRes.error) throw plansRes.error;\r\n\r\n      return {\r\n        profiles: (profilesRes.data || []) as AdminUserProfile[],\r\n        plans: (plansRes.data || []) as AdminUserPlan[],\r\n      };\r\n    },\r\n    enabled: !!user && isAdmin,\r\n    staleTime: 60 * 1000,\r\n  });\r\n\r\n  const grantMutation = useMutation({\r\n    mutationFn: async (params: {\r\n      userId: string;\r\n      category: LicenseCategory;\r\n      planTier: PaidPlanTier;\r\n    }) => {\r\n      const res = await fetch('/api/admin/plans/grant', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(params),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        let message = 'Failed to grant plan';\r\n        try {\r\n          const data = await res.json();\r\n          if (data?.error) message = data.error;\r\n        } catch {\r\n          // ignore JSON parse errors\r\n        }\r\n        throw new Error(message);\r\n      }\r\n    },\r\n    onSuccess: (_data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin-subscriptions'] });\r\n\r\n      const vars = variables as {\r\n        userId: string;\r\n        category: LicenseCategory;\r\n        planTier: PaidPlanTier;\r\n      };\r\n\r\n      const profile = data?.profiles?.find((p) => p.id === vars.userId);\r\n      const planDef = BILLING_CONFIG.plans[vars.planTier];\r\n\r\n      const userLabel = profile?.full_name || profile?.email || 'user';\r\n\r\n      toast.success(\r\n        `Granted ${planDef.label} plan (${vars.planTier}) for category ${vars.category} to ${userLabel}.`,\r\n      );\r\n    },\r\n    onError: (err: any) => {\r\n      console.error(err);\r\n      toast.error('Failed to grant plan. Please try again.');\r\n    },\r\n  });\r\n\r\n  const plansByUser = useMemo(() => {\r\n    const map = new Map<string, AdminUserPlan[]>();\r\n    if (!data?.plans) return map;\r\n    for (const plan of data.plans) {\r\n      const arr = map.get(plan.user_id) || [];\r\n      arr.push(plan);\r\n      map.set(plan.user_id, arr);\r\n    }\r\n    return map;\r\n  }, [data]);\r\n\r\n  // ❗ these must be BEFORE any conditional returns (no hooks below!)\r\n  const profiles = data?.profiles || [];\r\n\r\n  const totalPaidUsers = useMemo(() => {\r\n    if (!data?.plans) return 0;\r\n    const usersWithPlans = new Set<string>();\r\n    for (const plan of data.plans) {\r\n      usersWithPlans.add(plan.user_id);\r\n    }\r\n    return usersWithPlans.size;\r\n  }, [data]);\r\n\r\n  // ------------- conditional UI branches (no hooks below this) -------------\r\n\r\n  if (authLoading || !user) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\r\n          <p className=\"text-muted-foreground\">Authenticating...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!isAdmin) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background\">\r\n        <Navbar />\r\n        <div className=\"container mx-auto px-4 pt-28 pb-12 max-w-4xl\">\r\n          <GlassCard className=\"p-8 border border-border/80 bg-black/85 text-center space-y-4\">\r\n            <div>\r\n              <h1 className=\"text-xl font-semibold mb-1\">Admin access required</h1>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                This page is only available to admins. If you believe this is a mistake,\r\n                please contact the owner.\r\n              </p>\r\n            </div>\r\n            <Button onClick={() => router.push('/dashboard')}>Back to dashboard</Button>\r\n          </GlassCard>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background\">\r\n        <Navbar />\r\n        <div className=\"container mx-auto px-4 pt-28 pb-12 max-w-5xl flex flex-col items-center justify-center gap-3\">\r\n          <div className=\"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin\" />\r\n          <p className=\"text-xs text-muted-foreground\">\r\n            Loading subscription overview…\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background\">\r\n        <Navbar />\r\n        <div className=\"container mx-auto px-4 pt-28 pb-12 max-w-5xl\">\r\n          <GlassCard className=\"p-6 border border-border/80 bg-black/85 space-y-2\">\r\n            <p className=\"text-sm font-semibold text-destructive\">\r\n              Failed to load subscriptions\r\n            </p>\r\n            <p className=\"text-xs text-muted-foreground break-words\">\r\n              Something went wrong while loading subscription data. Please try again\r\n              later.\r\n            </p>\r\n          </GlassCard>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background\">\r\n      <Navbar />\r\n      <div className=\"container mx-auto px-4 pt-28 pb-12 max-w-6xl space-y-6\">\r\n        {/* Header / summary card */}\r\n        <GlassCard className=\"p-6 md:p-7 border border-border/80 bg-black/85 flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <p className=\"text-xs text-muted-foreground uppercase tracking-wide\">\r\n                Admin\r\n              </p>\r\n              <Badge variant=\"outline\" className=\"border-primary/70 text-primary text-[10px]\">\r\n                Using mock payments\r\n              </Badge>\r\n            </div>\r\n            <h1 className=\"text-2xl md:text-3xl font-semibold tracking-tight\">\r\n              Subscription overview\r\n            </h1>\r\n            <p className=\"text-sm text-muted-foreground max-w-xl\">\r\n              See all users, their plans by category, and quickly grant or extend access\r\n              while payments are in testing.\r\n            </p>\r\n            <div className=\"flex flex-wrap items-center gap-3 text-xs text-muted-foreground\">\r\n              <span>\r\n                Total users:&nbsp;\r\n                <span className=\"font-semibold text-foreground\">\r\n                  {profiles.length}\r\n                </span>\r\n              </span>\r\n              <span>\r\n                Paying users (at least one plan):{' '}\r\n                <span className=\"font-semibold text-foreground\">\r\n                  {totalPaidUsers}\r\n                </span>\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex flex-col items-end gap-2\">\r\n            <div className=\"flex flex-col items-end gap-1\">\r\n              <label className=\"text-[11px] text-muted-foreground\">\r\n                Plan used for grants\r\n              </label>\r\n              <select\r\n                className=\"text-[11px] bg-black/70 border border-border/70 rounded-md px-2 py-1 text-foreground focus:outline-none focus:ring-1 focus:ring-primary/60\"\r\n                value={selectedPlanTier}\r\n                onChange={(e) => setSelectedPlanTier(e.target.value as PaidPlanTier)}\r\n              >\r\n                {Object.values(BILLING_CONFIG.plans).map((plan) => (\r\n                  <option key={plan.id} value={plan.id}>\r\n                    {plan.label} ({plan.months}m)\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              className=\"text-xs\"\r\n              onClick={() => router.push('/profile')}\r\n            >\r\n              Open account page\r\n            </Button>\r\n          </div>\r\n        </GlassCard>\r\n\r\n        {/* Users / plans table */}\r\n        <GlassCard className=\"p-4 md:p-5 border border-border/80 bg-black/85 overflow-x-auto\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <h2 className=\"text-sm font-medium text-foreground\">\r\n              Users &amp; license categories\r\n            </h2>\r\n            <p className=\"text-[11px] text-muted-foreground\">\r\n              Click &ldquo;Grant free plan&rdquo; to create or extend access.\r\n            </p>\r\n          </div>\r\n\r\n          {profiles.length === 0 ? (\r\n            <div className=\"py-10 text-center\">\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                No users found yet. New users will appear here automatically.\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            <table className=\"w-full text-xs md:text-sm border-collapse\">\r\n              <thead>\r\n                <tr className=\"border-b border-border/60 bg-black/70\">\r\n                  <th className=\"py-2 pr-3 text-left font-medium text-muted-foreground sticky top-0 bg-black/80 backdrop-blur z-10\">\r\n                    User\r\n                  </th>\r\n                  <th className=\"py-2 pr-3 text-left font-medium text-muted-foreground hidden md:table-cell sticky top-0 bg-black/80 backdrop-blur z-10\">\r\n                    Email\r\n                  </th>\r\n                  {LICENSE_CATEGORIES.map((cat) => (\r\n                    <th\r\n                      key={cat}\r\n                      className=\"py-2 px-2 text-left font-medium text-muted-foreground whitespace-nowrap sticky top-0 bg-black/80 backdrop-blur z-10\"\r\n                    >\r\n                      Cat {cat}\r\n                    </th>\r\n                  ))}\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {profiles.map((profile) => {\r\n                  const userPlans = plansByUser.get(profile.id) || [];\r\n\r\n                  const getPlanCell = (category: LicenseCategory) => {\r\n                    const row = userPlans.find((p) => p.category === category);\r\n                    if (!row) {\r\n                      return {\r\n                        label: 'Free',\r\n                        detail: '',\r\n                        isActive: false,\r\n                        isExpired: false,\r\n                      };\r\n                    }\r\n\r\n                    const active =\r\n                      row.status === 'active' &&\r\n                      isPlanCurrentlyActive({\r\n                        startDate: row.start_date,\r\n                        endDate: row.end_date,\r\n                      });\r\n\r\n                    const endDate = new Date(row.end_date);\r\n                    const now = new Date();\r\n                    const remainingDays = Math.max(\r\n                      0,\r\n                      Math.ceil(\r\n                        (endDate.getTime() - now.getTime()) /\r\n                          (1000 * 60 * 60 * 24),\r\n                      ),\r\n                    );\r\n\r\n                    return {\r\n                      label: active ? row.plan_tier : `${row.plan_tier} (expired)`,\r\n                      detail: active\r\n                        ? `${remainingDays}d left`\r\n                        : endDate.toLocaleDateString(),\r\n                      isActive: active,\r\n                      isExpired: !active,\r\n                    };\r\n                  };\r\n\r\n                  return (\r\n                    <tr\r\n                      key={profile.id}\r\n                      className=\"border-b border-border/30 last:border-0 hover:bg-white/5 transition-colors\"\r\n                    >\r\n                      <td className=\"py-2 pr-3 align-top\">\r\n                        <div className=\"flex flex-col\">\r\n                          <span className=\"font-medium text-foreground\">\r\n                            {profile.full_name || profile.email || 'Unknown user'}\r\n                          </span>\r\n                          <span className=\"md:hidden text-[11px] text-muted-foreground\">\r\n                            {profile.email || ''}\r\n                          </span>\r\n                          <span className=\"text-[10px] text-muted-foreground mt-0.5\">\r\n                            Joined:{' '}\r\n                            {new Date(profile.created_at).toLocaleDateString()}\r\n                          </span>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"py-2 pr-3 align-top hidden md:table-cell text-muted-foreground\">\r\n                        {profile.email || ''}\r\n                      </td>\r\n                      {LICENSE_CATEGORIES.map((cat) => {\r\n                        const planCell = getPlanCell(cat);\r\n                        const isMutating = grantMutation.isPending;\r\n\r\n                        return (\r\n                          <td key={cat} className=\"py-2 px-2 align-top\">\r\n                            <div className=\"flex flex-col gap-1\">\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <span\r\n                                  className={`inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] font-medium border ${\r\n                                    planCell.isActive\r\n                                      ? 'bg-emerald-500/10 text-emerald-400 border-emerald-500/40'\r\n                                      : planCell.isExpired\r\n                                      ? 'bg-red-500/10 text-red-400 border-red-500/40'\r\n                                      : 'bg-muted/60 text-muted-foreground border-border/50'\r\n                                  }`}\r\n                                >\r\n                                  {planCell.label}\r\n                                </span>\r\n                              </div>\r\n                              {planCell.detail && (\r\n                                <span className=\"text-[10px] text-muted-foreground\">\r\n                                  {planCell.detail}\r\n                                </span>\r\n                              )}\r\n                              <Button\r\n                                size=\"sm\"\r\n                                variant=\"outline\"\r\n                                className=\"mt-1 text-[10px] px-2 py-1 h-7\"\r\n                                disabled={isMutating}\r\n                                onClick={() =>\r\n                                  grantMutation.mutate({\r\n                                    userId: profile.id,\r\n                                    category: cat,\r\n                                    planTier: selectedPlanTier,\r\n                                  })\r\n                                }\r\n                              >\r\n                                {planCell.isActive ? 'Extend (free)' : 'Grant free plan'}\r\n                              </Button>\r\n                            </div>\r\n                          </td>\r\n                        );\r\n                      })}\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          )}\r\n        </GlassCard>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}