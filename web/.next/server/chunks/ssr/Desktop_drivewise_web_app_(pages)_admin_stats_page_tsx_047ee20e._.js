module.exports=[96094,a=>{"use strict";var b=a.i(681),c=a.i(84813),d=a.i(53365),e=a.i(22309),f=a.i(78330),g=a.i(93639),h=a.i(663),i=a.i(34213);let j=(0,a.i(2017).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var k=a.i(73957),l=a.i(46667),m=a.i(96112),n=a.i(9857),o=a.i(82114),p=a.i(40591),q=a.i(38041),r=a.i(1004),s=a.i(60854),t=a.i(20416),u=a.i(37979),v=a.i(25761),w=a.i(61334),x=a.i(28667);function y(){let{user:a,isAdmin:y,loading:z}=(0,e.useAuth)(),A=(0,d.useRouter)(),B=(0,v.createClient)(),C=(0,u.useQueryClient)(),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(1),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=setTimeout(()=>{G(D),I(1)},500);return()=>clearTimeout(a)},[D]),(0,c.useEffect)(()=>{z||a&&y||A.push("/")},[a,y,z,A]);let{data:P,isLoading:Q}=(0,s.useQuery)({queryKey:["admin-stats"],queryFn:async()=>{let{data:a,error:b}=await B.rpc("get_admin_dashboard_stats");if(b)throw b;return{totalUsers:a?.totalUsers||0,totalQuestions:a?.totalQuestions||0,totalAttempts:a?.totalAttempts||0,passedAttempts:a?.passedAttempts||0,failedAttempts:a?.failedAttempts||0,categoryCounts:a?.categoryCounts||{},questionsPerTest:a?.questionsPerTest||{},scenarioCategoryCounts:a?.scenarioCategoryCounts||{},scenarioLevelCounts:a?.scenarioLevelCounts||{},materialsByChapter:a?.materialsByChapter||{}}}}),{data:R,isLoading:S}=(0,s.useQuery)({queryKey:["admin-users",F,H],queryFn:async()=>{let{data:a,error:b}=await B.rpc("get_users_with_stats",{page_number:H,page_size:20,search_term:F||null,role_filter:"all",premium_filter:"all"});if(b)throw b;return{users:a?.users||[],total:a?.total||0}},staleTime:3e4,gcTime:3e5}),T=(0,t.useMutation)({mutationFn:async a=>{let{error:b}=await B.from("user_profiles").delete().eq("id",a);if(b)throw b},onSuccess:()=>{w.toast.success("User deleted successfully"),C.invalidateQueries({queryKey:["admin-users"]}),C.invalidateQueries({queryKey:["admin-stats"]}),K(!1),O(null)},onError:a=>{let b=a instanceof Error?a.message:"Unknown error";w.toast.error(`Failed to delete user: ${b}`)}}),U=(0,t.useMutation)({mutationFn:async({userId:a,isBlocked:b})=>{let{error:c}=await B.from("user_profiles").update({is_blocked:b}).eq("id",a);if(c)throw c},onSuccess:()=>{w.toast.success("User status updated"),C.invalidateQueries({queryKey:["admin-users"]}),M(!1),O(null)},onError:a=>{let b=a instanceof Error?a.message:"Unknown error";w.toast.error(`Failed to update user: ${b}`)}});return(R&&R.total,z||Q)?(0,b.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading statistics..."})]})}):a&&y?(0,b.jsxs)("div",{className:"min-h-screen bg-background text-foreground",children:[(0,b.jsx)(f.Navbar,{}),(0,b.jsxs)(i.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto px-6 py-8 max-w-7xl pt-28",children:[(0,b.jsx)(h.Button,{variant:"ghost",asChild:!0,className:"mb-4",children:(0,b.jsxs)(r.default,{href:"/admin",children:[(0,b.jsx)(p.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Admin Dashboard"]})}),(0,b.jsxs)("div",{className:"mb-8 space-y-2",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Statistics & User Management"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"System overview, metrics, and user administration"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Need to adjust plans?"," ",(0,b.jsx)(r.default,{href:"/admin/subscriptions",className:"underline underline-offset-2",children:"Open subscriptions admin"}),"."]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[(0,b.jsx)(i.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:(0,b.jsxs)(g.GlassCard,{className:"h-full flex flex-col justify-between p-6 border border-border/80 bg-black/80",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center",children:(0,b.jsx)(j,{className:"w-6 h-6 text-primary"})}),(0,b.jsx)(n.TrendingUp,{className:"w-5 h-5 text-primary"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold mb-1",children:P?.totalUsers||0}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Users"})]})}),(0,b.jsx)(i.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:(0,b.jsxs)(g.GlassCard,{className:"h-full flex flex-col justify-between p-6 border border-border/80 bg-black/80",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center",children:(0,b.jsx)(k.FileText,{className:"w-6 h-6 text-primary"})}),(0,b.jsx)(o.BarChart3,{className:"w-5 h-5 text-primary"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold mb-1",children:P?.totalQuestions||0}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Questions"})]})}),(0,b.jsx)(i.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:(0,b.jsxs)(g.GlassCard,{className:"h-full flex flex-col justify-between p-6 border border-border/80 bg-black/80",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center",children:(0,b.jsx)(o.BarChart3,{className:"w-6 h-6 text-primary"})}),(0,b.jsx)(n.TrendingUp,{className:"w-5 h-5 text-primary"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold mb-1",children:P?.totalAttempts||0}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Test Attempts"})]})}),(0,b.jsx)(i.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:(0,b.jsxs)(g.GlassCard,{className:"h-full flex flex-col justify-between p-6 border border-border/80 bg-black/80",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,b.jsx)("div",{className:"w-12 h-12 bg-green-500/10 rounded-xl flex items-center justify-center",children:(0,b.jsx)(l.CheckCircle,{className:"w-6 h-6 text-green-500"})})}),(0,b.jsx)("p",{className:"text-3xl font-bold mb-1 text-green-500",children:P?.passedAttempts||0}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Passed Tests"})]})}),(0,b.jsx)(i.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:(0,b.jsxs)(g.GlassCard,{className:"h-full flex flex-col justify-between p-6 border border-border/80 bg-black/80",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,b.jsx)("div",{className:"w-12 h-12 bg-red-500/10 rounded-xl flex items-center justify-center",children:(0,b.jsx)(m.XCircle,{className:"w-6 h-6 text-red-500"})})}),(0,b.jsx)("p",{className:"text-3xl font-bold mb-1 text-red-500",children:P?.failedAttempts||0}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Failed Tests"})]})}),(0,b.jsx)(i.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:(0,b.jsxs)(g.GlassCard,{className:"h-full flex flex-col justify-between p-6 border border-border/80 bg-black/80",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,b.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center",children:(0,b.jsx)(n.TrendingUp,{className:"w-6 h-6 text-primary"})})}),(0,b.jsxs)("p",{className:"text-3xl font-bold mb-1",children:[P?.totalAttempts?Math.round(P.passedAttempts/P.totalAttempts*100):0,"%"]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Pass Rate"})]})})]}),(0,b.jsxs)(g.GlassCard,{className:"p-6 border border-border/80 bg-black/90",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-6",children:"Questions by Category"}),(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:Object.entries(P?.categoryCounts||{}).map(([a,c])=>(0,b.jsxs)("div",{className:"text-center p-4 rounded-xl bg-black/80 border border-border/80",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-primary mb-1",children:c}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Category ",a]})]},a))})]}),(0,b.jsx)(g.GlassCard,{className:"p-6 mt-8 border border-border/80 bg-black/80",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Theory Test Coverage"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-3",children:"Questions per category/test. Cells with low counts help you see where more questions are needed."}),(0,b.jsxs)("div",{className:"space-y-1 text-xs",children:[Object.entries(P?.questionsPerTest||{}).sort(([a],[b])=>a.localeCompare(b)).map(([a,c])=>{let[d,e]=a.split("-"),f=c<20;return(0,b.jsxs)("div",{className:`flex items-center justify-between px-2 py-1 rounded ${f?"bg-amber-500/15 border border-amber-500/50":"bg-black/60 border border-border/70"}`,children:[(0,b.jsxs)("span",{className:"font-medium",children:["Cat ",d," Â· Test ",e]}),(0,b.jsxs)("span",{className:f?"text-amber-600 font-semibold":"text-muted-foreground",children:[c," questions"]})]},a)}),0===Object.keys(P?.questionsPerTest||{}).length&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"No theory questions found."})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Decision Trainer Coverage"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-3",children:"Scenarios by category and level to spot gaps in practical training content."}),(0,b.jsxs)("div",{className:"space-y-3 text-xs",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold mb-1",children:"By Category"}),(0,b.jsxs)("div",{className:"space-y-1",children:[Object.entries(P?.scenarioCategoryCounts||{}).map(([a,c])=>(0,b.jsxs)("div",{className:"flex items-center justify-between px-2 py-1 rounded bg-black/60 border border-border/70",children:[(0,b.jsxs)("span",{className:"font-medium",children:["Category ",a]}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:[c," scenarios"]})]},a)),0===Object.keys(P?.scenarioCategoryCounts||{}).length&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"No Decision Trainer scenarios found."})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold mb-1",children:"By Level"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[Object.entries(P?.scenarioLevelCounts||{}).map(([a,c])=>(0,b.jsxs)("div",{className:"px-2 py-1 rounded-full bg-black/60 border border-border/70",children:[(0,b.jsxs)("span",{className:"font-medium mr-1",children:["L",a]}),(0,b.jsx)("span",{className:"text-muted-foreground",children:c})]},a)),0===Object.keys(P?.scenarioLevelCounts||{}).length&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"No scenarios by level yet."})]})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Study Materials Coverage"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-3",children:"Materials per chapter and publication status. Chapters with no or few materials are highlighted."}),(0,b.jsx)("div",{className:"space-y-1 text-xs",children:Array.from({length:13}).map((a,c)=>{let d=c+1,e=(P?.materialsByChapter||{})[d]||{total:0,published:0},f=0===e.total;return(0,b.jsxs)("div",{className:`flex items-center justify-between px-2 py-1 rounded ${f?"bg-red-500/15 border border-red-500/50":"bg-black/60 border border-border/70"}`,children:[(0,b.jsxs)("span",{className:"font-medium",children:["Chapter ",d]}),(0,b.jsxs)("span",{className:f?"text-red-600 font-semibold":"text-muted-foreground",children:[e.published,"/",e.total," published"]})]},d)})})]})]})})]}),(0,b.jsx)(x.Dialog,{open:J,onOpenChange:K,children:(0,b.jsxs)(x.DialogContent,{children:[(0,b.jsxs)(x.DialogHeader,{children:[(0,b.jsxs)(x.DialogTitle,{className:"flex items-center gap-2 text-destructive",children:[(0,b.jsx)(q.AlertTriangle,{className:"w-5 h-5"}),"Delete User Account"]}),(0,b.jsxs)(x.DialogDescription,{children:["Are you sure you want to delete ",(0,b.jsx)("strong",{children:N?.email}),"? This action cannot be undone. All their test history will be permanently deleted."]})]}),(0,b.jsxs)(x.DialogFooter,{children:[(0,b.jsx)(h.Button,{variant:"outline",onClick:()=>K(!1),children:"Cancel"}),(0,b.jsx)(h.Button,{variant:"destructive",onClick:()=>{N&&T.mutate(N.id)},disabled:T.isPending,children:T.isPending?"Deleting...":"Delete User"})]})]})}),(0,b.jsx)(x.Dialog,{open:L,onOpenChange:M,children:(0,b.jsxs)(x.DialogContent,{children:[(0,b.jsxs)(x.DialogHeader,{children:[(0,b.jsxs)(x.DialogTitle,{children:[N?.is_blocked?"Unblock":"Block"," User"]}),(0,b.jsx)(x.DialogDescription,{children:N?.is_blocked?`Are you sure you want to unblock ${N?.email}? They will regain access to their account.`:`Are you sure you want to block ${N?.email}? They will not be able to access their account.`})]}),(0,b.jsxs)(x.DialogFooter,{children:[(0,b.jsx)(h.Button,{variant:"outline",onClick:()=>M(!1),children:"Cancel"}),(0,b.jsx)(h.Button,{onClick:()=>{N&&U.mutate({userId:N.id,isBlocked:!N.is_blocked})},disabled:U.isPending,children:U.isPending?"Updating...":N?.is_blocked?"Unblock User":"Block User"})]})]})})]}):null}a.s(["default",()=>y],96094)}];

//# sourceMappingURL=Desktop_drivewise_web_app_%28pages%29_admin_stats_page_tsx_047ee20e._.js.map