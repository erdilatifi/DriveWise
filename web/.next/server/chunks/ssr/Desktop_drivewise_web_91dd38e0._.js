module.exports=[57737,a=>{"use strict";let b={freeTestLimitPerCategory:Number(process.env.NEXT_PUBLIC_FREE_TEST_LIMIT_PER_CATEGORY??"3"),paidTestLimitPerCategory:Number(process.env.NEXT_PUBLIC_PAID_TEST_LIMIT_PER_CATEGORY??"9999"),billingCycleDays:Number(process.env.NEXT_PUBLIC_BILLING_CYCLE_DAYS??"30"),bestValuePlan:process.env.NEXT_PUBLIC_PAYMENT_BEST_VALUE_PLAN??"PLAN_C",plans:[{id:"PLAN_A",label:"1 month",months:1,priceEur:3},{id:"PLAN_B",label:"2 months",months:2,priceEur:6},{id:"PLAN_C",label:"3 months",months:3,priceEur:8,badge:"BEST_VALUE",emphasize:!0}].reduce((a,b)=>{let c=b.priceEur/b.months;return a[b.id]={...b,pricePerMonthEur:c},a},{})};function c(a,b=new Date){if(!a)return!1;let d=new Date(a.startDate).getTime(),e=new Date(a.endDate).getTime(),f=b.getTime();return f>=d&&f<=e}function d(a){let{isAdmin:d,testsTakenThisCycle:e,activePlan:f,now:g}=a;if(d)return{canAccessTests:!0,canStartNewTest:!0,remainingFreeTests:void 0,canAccessDecisionTrainer:!0,canAccessStudyMaterial:!0,canReviewTestsInDetail:!0};if(f&&c({startDate:f.startDate,endDate:f.endDate},g))return{canAccessTests:!0,canStartNewTest:e<b.paidTestLimitPerCategory,remainingFreeTests:Math.max(0,b.paidTestLimitPerCategory-e),canAccessDecisionTrainer:!0,canAccessStudyMaterial:!0,canReviewTestsInDetail:!0};let h=Math.max(0,b.freeTestLimitPerCategory-e);return{canAccessTests:!0,canStartNewTest:h>0,remainingFreeTests:h,canAccessDecisionTrainer:!1,canAccessStudyMaterial:!1,canReviewTestsInDetail:!1}}function e(a){let{attempts:c,category:d,now:e}=a,f=e??new Date,g=new Date(f);g.setDate(g.getDate()-b.billingCycleDays+1);let h=g.getTime(),i=f.getTime();return c.filter(a=>{if(a.category!==d)return!1;let b=new Date(a.completed_at).getTime();return b>=h&&b<=i}).length}a.s(["BILLING_CONFIG",0,b,"computeEntitlements",()=>d,"countTestsInCurrentCycle",()=>e,"isPlanCurrentlyActive",()=>c])},98507,a=>{"use strict";var b=a.i(681),c=a.i(10172),d=a.i(46444);let e=(0,c.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-[11px] font-semibold tracking-tight transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-ring/70 focus:ring-offset-2 focus:ring-offset-background",{variants:{variant:{default:"border-transparent bg-primary/90 text-primary-foreground hover:bg-primary",secondary:"border-transparent bg-secondary/80 text-secondary-foreground hover:bg-secondary",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"border-border/70 text-foreground/80 bg-background/40",success:"border-transparent bg-green-500 text-white hover:bg-green-500/80",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-500/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-500/80"}},defaultVariants:{variant:"default"}});function f({className:a,variant:c,...f}){return(0,b.jsx)("div",{className:(0,d.cn)(e({variant:c}),a),...f})}a.s(["Badge",()=>f])},96784,a=>{"use strict";var b=a.i(681),c=a.i(84813),d=a.i(53365),e=a.i(60854),f=a.i(20416),g=a.i(37979),h=a.i(25761),i=a.i(78330),j=a.i(93639),k=a.i(663),l=a.i(98507),m=a.i(22309),n=a.i(57737),o=a.i(61334);let p=["A","B","C","D"];function q(){let a=(0,d.useRouter)(),{user:q,loading:r,isAdmin:s}=(0,m.useAuth)(),t=(0,g.useQueryClient)(),u=(0,h.createClient)(),[v,w]=(0,c.useState)(n.BILLING_CONFIG.bestValuePlan),{data:x,isLoading:y,error:z}=(0,e.useQuery)({queryKey:["admin-subscriptions"],queryFn:async()=>{let[a,b]=await Promise.all([u.from("user_profiles").select("id, email, full_name, created_at").order("created_at"),u.from("user_plans").select("*")]);if(a.error)throw a.error;if(b.error)throw b.error;return{profiles:a.data||[],plans:b.data||[]}},enabled:!!q&&s,staleTime:6e4}),A=(0,f.useMutation)({mutationFn:async a=>{let b=await fetch("/api/admin/plans/grant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a="Failed to grant plan";try{let c=await b.json();c?.error&&(a=c.error)}catch{}throw Error(a)}},onSuccess:(a,b)=>{t.invalidateQueries({queryKey:["admin-subscriptions"]});let c=x?.profiles?.find(a=>a.id===b.userId),d=n.BILLING_CONFIG.plans[b.planTier],e=c?.full_name||c?.email||"user";o.toast.success(`Granted ${d.label} plan (${b.planTier}) for category ${b.category} to ${e}.`)},onError:a=>{o.toast.error("Failed to grant plan. Please try again.")}}),B=(0,c.useMemo)(()=>{let a=new Map;if(!x?.plans)return a;for(let b of x.plans){let c=a.get(b.user_id)||[];c.push(b),a.set(b.user_id,c)}return a},[x]),C=x?.profiles||[],D=(0,c.useMemo)(()=>{if(!x?.plans)return 0;let a=new Set;for(let b of x.plans)a.add(b.user_id);return a.size},[x]);return r||!q?(0,b.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Authenticating..."})]})}):s?y?(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)(i.Navbar,{}),(0,b.jsxs)("div",{className:"container mx-auto px-4 pt-28 pb-12 max-w-5xl flex flex-col items-center justify-center gap-3",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Loading subscription overview…"})]})]}):z?(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)(i.Navbar,{}),(0,b.jsx)("div",{className:"container mx-auto px-4 pt-28 pb-12 max-w-5xl",children:(0,b.jsxs)(j.GlassCard,{className:"p-6 border border-border/80 bg-black/85 space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-destructive",children:"Failed to load subscriptions"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground break-words",children:"Something went wrong while loading subscription data. Please try again later."})]})})]}):(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)(i.Navbar,{}),(0,b.jsxs)("div",{className:"container mx-auto px-4 pt-28 pb-12 max-w-6xl space-y-6",children:[(0,b.jsxs)(j.GlassCard,{className:"p-6 md:p-7 border border-border/80 bg-black/85 flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Admin"}),(0,b.jsx)(l.Badge,{variant:"outline",className:"border-primary/70 text-primary text-[10px]",children:"Using mock payments"})]}),(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Subscription overview"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground max-w-xl",children:"See all users, their plans by category, and quickly grant or extend access while payments are in testing."}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{children:["Total users: ",(0,b.jsx)("span",{className:"font-semibold text-foreground",children:C.length})]}),(0,b.jsxs)("span",{children:["Paying users (at least one plan):"," ",(0,b.jsx)("span",{className:"font-semibold text-foreground",children:D})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,b.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,b.jsx)("label",{className:"text-[11px] text-muted-foreground",children:"Plan used for grants"}),(0,b.jsx)("select",{className:"text-[11px] bg-black/70 border border-border/70 rounded-md px-2 py-1 text-foreground focus:outline-none focus:ring-1 focus:ring-primary/60",value:v,onChange:a=>w(a.target.value),children:Object.values(n.BILLING_CONFIG.plans).map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.label," (",a.months,"m)"]},a.id))})]}),(0,b.jsx)(k.Button,{variant:"outline",size:"sm",className:"text-xs",onClick:()=>a.push("/profile"),children:"Open account page"})]})]}),(0,b.jsxs)(j.GlassCard,{className:"p-4 md:p-5 border border-border/80 bg-black/85 overflow-x-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Users & license categories"}),(0,b.jsx)("p",{className:"text-[11px] text-muted-foreground",children:"Click “Grant free plan” to create or extend access."})]}),0===C.length?(0,b.jsx)("div",{className:"py-10 text-center",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No users found yet. New users will appear here automatically."})}):(0,b.jsxs)("table",{className:"w-full text-xs md:text-sm border-collapse",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-border/60 bg-black/70",children:[(0,b.jsx)("th",{className:"py-2 pr-3 text-left font-medium text-muted-foreground sticky top-0 bg-black/80 backdrop-blur z-10",children:"User"}),(0,b.jsx)("th",{className:"py-2 pr-3 text-left font-medium text-muted-foreground hidden md:table-cell sticky top-0 bg-black/80 backdrop-blur z-10",children:"Email"}),p.map(a=>(0,b.jsxs)("th",{className:"py-2 px-2 text-left font-medium text-muted-foreground whitespace-nowrap sticky top-0 bg-black/80 backdrop-blur z-10",children:["Cat ",a]},a))]})}),(0,b.jsx)("tbody",{children:C.map(a=>{let c=B.get(a.id)||[];return(0,b.jsxs)("tr",{className:"border-b border-border/30 last:border-0 hover:bg-white/5 transition-colors",children:[(0,b.jsx)("td",{className:"py-2 pr-3 align-top",children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:a.full_name||a.email||"Unknown user"}),(0,b.jsx)("span",{className:"md:hidden text-[11px] text-muted-foreground",children:a.email||""}),(0,b.jsxs)("span",{className:"text-[10px] text-muted-foreground mt-0.5",children:["Joined:"," ",new Date(a.created_at).toLocaleDateString()]})]})}),(0,b.jsx)("td",{className:"py-2 pr-3 align-top hidden md:table-cell text-muted-foreground",children:a.email||""}),p.map(d=>{let e=(a=>{let b=c.find(b=>b.category===a);if(!b)return{label:"Free",detail:"",isActive:!1,isExpired:!1};let d="active"===b.status&&(0,n.isPlanCurrentlyActive)({startDate:b.start_date,endDate:b.end_date}),e=new Date(b.end_date),f=new Date,g=Math.max(0,Math.ceil((e.getTime()-f.getTime())/864e5));return{label:d?b.plan_tier:`${b.plan_tier} (expired)`,detail:d?`${g}d left`:e.toLocaleDateString(),isActive:d,isExpired:!d}})(d),f=A.isPending;return(0,b.jsx)("td",{className:"py-2 px-2 align-top",children:(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("div",{className:"flex items-center gap-1",children:(0,b.jsx)("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] font-medium border ${e.isActive?"bg-emerald-500/10 text-emerald-400 border-emerald-500/40":e.isExpired?"bg-red-500/10 text-red-400 border-red-500/40":"bg-muted/60 text-muted-foreground border-border/50"}`,children:e.label})}),e.detail&&(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground",children:e.detail}),(0,b.jsx)(k.Button,{size:"sm",variant:"outline",className:"mt-1 text-[10px] px-2 py-1 h-7",disabled:f,onClick:()=>A.mutate({userId:a.id,category:d,planTier:v}),children:e.isActive?"Extend (free)":"Grant free plan"})]})},d)})]},a.id)})})]})]})]})]}):(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)(i.Navbar,{}),(0,b.jsx)("div",{className:"container mx-auto px-4 pt-28 pb-12 max-w-4xl",children:(0,b.jsxs)(j.GlassCard,{className:"p-8 border border-border/80 bg-black/85 text-center space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold mb-1",children:"Admin access required"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"This page is only available to admins. If you believe this is a mistake, please contact the owner."})]}),(0,b.jsx)(k.Button,{onClick:()=>a.push("/dashboard"),children:"Back to dashboard"})]})})]})}a.s(["default",()=>q])}];

//# sourceMappingURL=Desktop_drivewise_web_91dd38e0._.js.map