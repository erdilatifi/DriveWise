(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3604,e=>{"use strict";var t=e.i(95329),s=e.i(33133),r=e.i(50863),a=e.i(8181),i=e.i(921),n=class extends a.Subscribable{#e;#t=void 0;#s;#r;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,i.shallowEqualObjects)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,i.hashKey)(t.mutationKey)!==(0,i.hashKey)(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#a(),this.#i(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#a(),this.#i()}mutate(e,t){return this.#r=t,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#a(){let e=this.#s?.state??(0,s.getDefaultState)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#i(e){r.notifyManager.batch(()=>{if(this.#r&&this.hasListeners()){let t=this.#t.variables,s=this.#t.context,r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#r.onSuccess?.(e.data,t,s,r),this.#r.onSettled?.(e.data,null,t,s,r)):e?.type==="error"&&(this.#r.onError?.(e.error,t,s,r),this.#r.onSettled?.(void 0,e.error,t,s,r))}this.listeners.forEach(e=>{e(this.#t)})})}},l=e.i(94494);function o(e,s){let a=(0,l.useQueryClient)(s),[o]=t.useState(()=>new n(a,e));t.useEffect(()=>{o.setOptions(e)},[o,e]);let c=t.useSyncExternalStore(t.useCallback(e=>o.subscribe(r.notifyManager.batchCalls(e)),[o]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),d=t.useCallback((e,t)=>{o.mutate(e,t).catch(i.noop)},[o]);if(c.error&&(0,i.shouldThrowError)(o.options.throwOnError,[c.error]))throw c.error;return{...c,mutate:d,mutateAsync:c.mutate}}e.s(["useMutation",()=>o],3604)},89679,e=>{"use strict";var t=e.i(50351);let s={freeTestLimitPerCategory:Number(t.default.env.NEXT_PUBLIC_FREE_TEST_LIMIT_PER_CATEGORY??"3"),paidTestLimitPerCategory:Number(t.default.env.NEXT_PUBLIC_PAID_TEST_LIMIT_PER_CATEGORY??"9999"),billingCycleDays:Number(t.default.env.NEXT_PUBLIC_BILLING_CYCLE_DAYS??"30"),bestValuePlan:t.default.env.NEXT_PUBLIC_PAYMENT_BEST_VALUE_PLAN??"PLAN_C",plans:[{id:"PLAN_A",label:"1 month",months:1,priceEur:3},{id:"PLAN_B",label:"2 months",months:2,priceEur:6},{id:"PLAN_C",label:"3 months",months:3,priceEur:8,badge:"BEST_VALUE",emphasize:!0}].reduce((e,t)=>{let s=t.priceEur/t.months;return e[t.id]={...t,pricePerMonthEur:s},e},{})};function r(e,t=new Date){if(!e)return!1;let s=new Date(e.startDate).getTime(),a=new Date(e.endDate).getTime(),i=t.getTime();return i>=s&&i<=a}function a(e){let{isAdmin:t,testsTakenThisCycle:a,activePlan:i,now:n}=e;if(t)return{canAccessTests:!0,canStartNewTest:!0,remainingFreeTests:void 0,canAccessDecisionTrainer:!0,canAccessStudyMaterial:!0,canReviewTestsInDetail:!0};if(i&&r({startDate:i.startDate,endDate:i.endDate},n))return{canAccessTests:!0,canStartNewTest:a<s.paidTestLimitPerCategory,remainingFreeTests:Math.max(0,s.paidTestLimitPerCategory-a),canAccessDecisionTrainer:!0,canAccessStudyMaterial:!0,canReviewTestsInDetail:!0};let l=Math.max(0,s.freeTestLimitPerCategory-a);return{canAccessTests:!0,canStartNewTest:l>0,remainingFreeTests:l,canAccessDecisionTrainer:!1,canAccessStudyMaterial:!1,canReviewTestsInDetail:!1}}function i(e){let{attempts:t,category:r,now:a}=e,i=a??new Date,n=new Date(i);n.setDate(n.getDate()-s.billingCycleDays+1);let l=n.getTime(),o=i.getTime();return t.filter(e=>{if(e.category!==r)return!1;let t=new Date(e.completed_at).getTime();return t>=l&&t<=o}).length}e.s(["BILLING_CONFIG",0,s,"computeEntitlements",()=>a,"countTestsInCurrentCycle",()=>i,"isPlanCurrentlyActive",()=>r])},86480,e=>{"use strict";var t=e.i(13105),s=e.i(63795),r=e.i(20696);let a=(0,s.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-[11px] font-semibold tracking-tight transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-ring/70 focus:ring-offset-2 focus:ring-offset-background",{variants:{variant:{default:"border-transparent bg-primary/90 text-primary-foreground hover:bg-primary",secondary:"border-transparent bg-secondary/80 text-secondary-foreground hover:bg-secondary",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"border-border/70 text-foreground/80 bg-background/40",success:"border-transparent bg-green-500 text-white hover:bg-green-500/80",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-500/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-500/80"}},defaultVariants:{variant:"default"}});function i({className:e,variant:s,...i}){return(0,t.jsx)("div",{className:(0,r.cn)(a({variant:s}),e),...i})}e.s(["Badge",()=>i])},23765,e=>{"use strict";var t=e.i(13105),s=e.i(95329),r=e.i(55744),a=e.i(55650),i=e.i(3604),n=e.i(94494),l=e.i(90582),o=e.i(20401),c=e.i(42830),d=e.i(89473),u=e.i(86480),m=e.i(96755),p=e.i(89679),h=e.i(77886);let x=["A","B","C","D"];function b(){let e=(0,r.useRouter)(),{user:b,loading:g,isAdmin:f}=(0,m.useAuth)(),y=(0,n.useQueryClient)(),v=(0,l.createClient)(),[N,j]=(0,s.useState)(p.BILLING_CONFIG.bestValuePlan),{data:w,isLoading:T,error:C}=(0,a.useQuery)({queryKey:["admin-subscriptions"],queryFn:async()=>{let[e,t]=await Promise.all([v.from("user_profiles").select("id, email, full_name, created_at").order("created_at"),v.from("user_plans").select("*")]);if(e.error)throw e.error;if(t.error)throw t.error;return{profiles:e.data||[],plans:t.data||[]}},enabled:!!b&&f,staleTime:6e4}),_=(0,i.useMutation)({mutationFn:async e=>{let t=await fetch("/api/admin/plans/grant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e="Failed to grant plan";try{let s=await t.json();s?.error&&(e=s.error)}catch{}throw Error(e)}},onSuccess:(e,t)=>{y.invalidateQueries({queryKey:["admin-subscriptions"]});let s=w?.profiles?.find(e=>e.id===t.userId),r=p.BILLING_CONFIG.plans[t.planTier],a=s?.full_name||s?.email||"user";h.toast.success(`Granted ${r.label} plan (${t.planTier}) for category ${t.category} to ${a}.`)},onError:e=>{h.toast.error("Failed to grant plan. Please try again.")}}),k=(0,s.useMemo)(()=>{let e=new Map;if(!w?.plans)return e;for(let t of w.plans){let s=e.get(t.user_id)||[];s.push(t),e.set(t.user_id,s)}return e},[w]),E=w?.profiles||[],A=(0,s.useMemo)(()=>{if(!w?.plans)return 0;let e=new Set;for(let t of w.plans)e.add(t.user_id);return e.size},[w]);return g||!b?(0,t.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Authenticating..."})]})}):f?T?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(o.Navbar,{}),(0,t.jsxs)("div",{className:"container mx-auto px-4 pt-28 pb-12 max-w-5xl flex flex-col items-center justify-center gap-3",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Loading subscription overview…"})]})]}):C?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(o.Navbar,{}),(0,t.jsx)("div",{className:"container mx-auto px-4 pt-28 pb-12 max-w-5xl",children:(0,t.jsxs)(c.GlassCard,{className:"p-6 border border-border/80 bg-black/85 space-y-2",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-destructive",children:"Failed to load subscriptions"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground break-words",children:"Something went wrong while loading subscription data. Please try again later."})]})})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(o.Navbar,{}),(0,t.jsxs)("div",{className:"container mx-auto px-4 pt-28 pb-12 max-w-6xl space-y-6",children:[(0,t.jsxs)(c.GlassCard,{className:"p-6 md:p-7 border border-border/80 bg-black/85 flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Admin"}),(0,t.jsx)(u.Badge,{variant:"outline",className:"border-primary/70 text-primary text-[10px]",children:"Using mock payments"})]}),(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Subscription overview"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground max-w-xl",children:"See all users, their plans by category, and quickly grant or extend access while payments are in testing."}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[(0,t.jsxs)("span",{children:["Total users: ",(0,t.jsx)("span",{className:"font-semibold text-foreground",children:E.length})]}),(0,t.jsxs)("span",{children:["Paying users (at least one plan):"," ",(0,t.jsx)("span",{className:"font-semibold text-foreground",children:A})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,t.jsx)("label",{className:"text-[11px] text-muted-foreground",children:"Plan used for grants"}),(0,t.jsx)("select",{className:"text-[11px] bg-black/70 border border-border/70 rounded-md px-2 py-1 text-foreground focus:outline-none focus:ring-1 focus:ring-primary/60",value:N,onChange:e=>j(e.target.value),children:Object.values(p.BILLING_CONFIG.plans).map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.label," (",e.months,"m)"]},e.id))})]}),(0,t.jsx)(d.Button,{variant:"outline",size:"sm",className:"text-xs",onClick:()=>e.push("/profile"),children:"Open account page"})]})]}),(0,t.jsxs)(c.GlassCard,{className:"p-4 md:p-5 border border-border/80 bg-black/85 overflow-x-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Users & license categories"}),(0,t.jsx)("p",{className:"text-[11px] text-muted-foreground",children:"Click “Grant free plan” to create or extend access."})]}),0===E.length?(0,t.jsx)("div",{className:"py-10 text-center",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No users found yet. New users will appear here automatically."})}):(0,t.jsxs)("table",{className:"w-full text-xs md:text-sm border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-border/60 bg-black/70",children:[(0,t.jsx)("th",{className:"py-2 pr-3 text-left font-medium text-muted-foreground sticky top-0 bg-black/80 backdrop-blur z-10",children:"User"}),(0,t.jsx)("th",{className:"py-2 pr-3 text-left font-medium text-muted-foreground hidden md:table-cell sticky top-0 bg-black/80 backdrop-blur z-10",children:"Email"}),x.map(e=>(0,t.jsxs)("th",{className:"py-2 px-2 text-left font-medium text-muted-foreground whitespace-nowrap sticky top-0 bg-black/80 backdrop-blur z-10",children:["Cat ",e]},e))]})}),(0,t.jsx)("tbody",{children:E.map(e=>{let s=k.get(e.id)||[];return(0,t.jsxs)("tr",{className:"border-b border-border/30 last:border-0 hover:bg-white/5 transition-colors",children:[(0,t.jsx)("td",{className:"py-2 pr-3 align-top",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:e.full_name||e.email||"Unknown user"}),(0,t.jsx)("span",{className:"md:hidden text-[11px] text-muted-foreground",children:e.email||""}),(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground mt-0.5",children:["Joined:"," ",new Date(e.created_at).toLocaleDateString()]})]})}),(0,t.jsx)("td",{className:"py-2 pr-3 align-top hidden md:table-cell text-muted-foreground",children:e.email||""}),x.map(r=>{let a=(e=>{let t=s.find(t=>t.category===e);if(!t)return{label:"Free",detail:"",isActive:!1,isExpired:!1};let r="active"===t.status&&(0,p.isPlanCurrentlyActive)({startDate:t.start_date,endDate:t.end_date}),a=new Date(t.end_date),i=new Date,n=Math.max(0,Math.ceil((a.getTime()-i.getTime())/864e5));return{label:r?t.plan_tier:`${t.plan_tier} (expired)`,detail:r?`${n}d left`:a.toLocaleDateString(),isActive:r,isExpired:!r}})(r),i=_.isPending;return(0,t.jsx)("td",{className:"py-2 px-2 align-top",children:(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"flex items-center gap-1",children:(0,t.jsx)("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] font-medium border ${a.isActive?"bg-emerald-500/10 text-emerald-400 border-emerald-500/40":a.isExpired?"bg-red-500/10 text-red-400 border-red-500/40":"bg-muted/60 text-muted-foreground border-border/50"}`,children:a.label})}),a.detail&&(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground",children:a.detail}),(0,t.jsx)(d.Button,{size:"sm",variant:"outline",className:"mt-1 text-[10px] px-2 py-1 h-7",disabled:i,onClick:()=>_.mutate({userId:e.id,category:r,planTier:N}),children:a.isActive?"Extend (free)":"Grant free plan"})]})},r)})]},e.id)})})]})]})]})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(o.Navbar,{}),(0,t.jsx)("div",{className:"container mx-auto px-4 pt-28 pb-12 max-w-4xl",children:(0,t.jsxs)(c.GlassCard,{className:"p-8 border border-border/80 bg-black/85 text-center space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-semibold mb-1",children:"Admin access required"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"This page is only available to admins. If you believe this is a mistake, please contact the owner."})]}),(0,t.jsx)(d.Button,{onClick:()=>e.push("/dashboard"),children:"Back to dashboard"})]})})]})}e.s(["default",()=>b])}]);