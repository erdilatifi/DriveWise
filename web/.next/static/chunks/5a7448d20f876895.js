(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54538,e=>{"use strict";let t=(0,e.i(39898).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],54538)},87370,e=>{"use strict";let t=(0,e.i(39898).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["default",()=>t])},45951,e=>{"use strict";let t=(0,e.i(39898).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],45951)},3604,e=>{"use strict";var t=e.i(95329),a=e.i(33133),i=e.i(50863),r=e.i(8181),s=e.i(921),n=class extends r.Subscribable{#e;#t=void 0;#a;#i;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,s.shallowEqualObjects)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#a,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,s.hashKey)(t.mutationKey)!==(0,s.hashKey)(this.options.mutationKey)?this.reset():this.#a?.state.status==="pending"&&this.#a.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#a?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#s(e)}getCurrentResult(){return this.#t}reset(){this.#a?.removeObserver(this),this.#a=void 0,this.#r(),this.#s()}mutate(e,t){return this.#i=t,this.#a?.removeObserver(this),this.#a=this.#e.getMutationCache().build(this.#e,this.options),this.#a.addObserver(this),this.#a.execute(e)}#r(){let e=this.#a?.state??(0,a.getDefaultState)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#s(e){i.notifyManager.batch(()=>{if(this.#i&&this.hasListeners()){let t=this.#t.variables,a=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#i.onSuccess?.(e.data,t,a,i),this.#i.onSettled?.(e.data,null,t,a,i)):e?.type==="error"&&(this.#i.onError?.(e.error,t,a,i),this.#i.onSettled?.(void 0,e.error,t,a,i))}this.listeners.forEach(e=>{e(this.#t)})})}},l=e.i(94494);function d(e,a){let r=(0,l.useQueryClient)(a),[d]=t.useState(()=>new n(r,e));t.useEffect(()=>{d.setOptions(e)},[d,e]);let o=t.useSyncExternalStore(t.useCallback(e=>d.subscribe(i.notifyManager.batchCalls(e)),[d]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),u=t.useCallback((e,t)=>{d.mutate(e,t).catch(s.noop)},[d]);if(o.error&&(0,s.shouldThrowError)(d.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:u,mutateAsync:o.mutate}}e.s(["useMutation",()=>d],3604)},67358,e=>{"use strict";var t=e.i(13105),a=e.i(95329),i=e.i(20696);let r=a.forwardRef(({className:e,type:a,...r},s)=>(0,t.jsx)("input",{type:a,className:(0,i.cn)("flex h-10 w-full rounded-xl border border-input/70 bg-background/60 px-3.5 py-2 text-sm text-foreground shadow-[0_8px_24px_rgba(0,0,0,0.7)] backdrop-blur-xl","transition-all duration-200 file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground/80","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/80 focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...r}));r.displayName="Input",e.s(["Input",()=>r])},34893,e=>{"use strict";var t=e.i(13105),a=e.i(95329),i=e.i(20696);let r=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("label",{ref:r,className:(0,i.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...a}));r.displayName="Label",e.s(["Label",()=>r])},23563,e=>{"use strict";var t=e.i(13105),a=e.i(95329),i=e.i(20696);let r=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-xl border border-input/70 bg-background/60 px-3.5 py-2.5 text-sm text-foreground shadow-[0_8px_24px_rgba(0,0,0,0.7)] backdrop-blur-xl","transition-all duration-200 placeholder:text-muted-foreground/80","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/80 focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...a}));r.displayName="Textarea",e.s(["Textarea",()=>r])},75308,e=>{"use strict";let t=(0,e.i(39898).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],75308)},68745,e=>{"use strict";var t=e.i(55650),a=e.i(3604),i=e.i(94494),r=e.i(90582);function s(e={}){let{search:a,chapterId:i,category:n,page:l=1,pageSize:d=50,includeUnpublished:o=!1,fields:u="*"}=e,c=(0,r.createClient)();return(0,t.useQuery)({queryKey:["materials",a,i,n,l,d,o,u],queryFn:async()=>{let e=(l-1)*d,t=c.from("study_materials").select(u,{count:"planned"}).order("order_index",{ascending:!0});if(i&&(t=t.eq("chapter_id",i)),n&&(t=t.eq("category",n)),o||(t=t.eq("is_published",!0)),a&&a.trim()){let e=a.trim();t=t.ilike("title",`%${e}%`)}let{data:r,error:s,count:m}=await t.range(e,e+d-1);if(s)throw s;let h=r||[];if("*"!==u)return{materials:h,total:m||0};let p=h.map(e=>e.id),x=[];if(p.length>0){let{data:e,error:t}=await c.from("material_images").select("*").in("material_id",p).order("order_index",{ascending:!0}).order("created_at",{ascending:!0});if(t)throw t;x=e||[]}return{materials:h.map(e=>({...e,images:x.filter(t=>t.material_id===e.id)})),total:m||0}}})}function n(e){let a=(0,r.createClient)();return(0,t.useQuery)({queryKey:["material-by-chapter",e],queryFn:async()=>{if(void 0===e)return null;let{data:t,error:i}=await a.from("study_materials").select("*").eq("chapter_id",e).single();if(i)throw i;let{data:r,error:s}=await a.from("material_images").select("*").eq("material_id",t.id).order("order_index",{ascending:!0}).order("created_at",{ascending:!0});if(s)throw s;return{...t,images:r||[]}},enabled:!!e,staleTime:3e5})}function l(e){let a=(0,r.createClient)();return(0,t.useQuery)({queryKey:["material",e],queryFn:async()=>{if(!e)return null;let{data:t,error:i}=await a.from("study_materials").select("*").eq("id",e).single();if(i)throw i;let{data:r,error:s}=await a.from("material_images").select("*").eq("material_id",e).order("order_index",{ascending:!0}).order("created_at",{ascending:!0});if(s)throw s;return{...t,images:r||[]}},enabled:!!e})}function d(){let e=(0,i.useQueryClient)(),t=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:i}=await t.from("study_materials").insert([e]).select().single();if(i)throw Error(i.message||i.details||"Failed to create material");return a},onSuccess:()=>{e.invalidateQueries({queryKey:["materials"]})}})}function o(){let e=(0,i.useQueryClient)(),t=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async({id:e,...a})=>{let{data:i,error:r}=await t.from("study_materials").update(a).eq("id",e).select().single();if(r)throw Error(r.message||r.details||"Failed to update material");return i},onSuccess:t=>{e.invalidateQueries({queryKey:["materials"]}),e.invalidateQueries({queryKey:["material",t.id]})}})}function u(){let e=(0,i.useQueryClient)(),t=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async e=>{let{error:a}=await t.from("study_materials").delete().eq("id",e);if(a)throw Error(a.message||"Failed to delete material");return e},onSuccess:()=>{e.invalidateQueries({queryKey:["materials"]})}})}function c(){let e=(0,i.useQueryClient)(),t=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:i}=await t.from("material_images").insert([e]).select().single();if(i)throw Error(i.message||i.details||"Failed to create material image");return a},onSuccess:t=>{e.invalidateQueries({queryKey:["material",t.material_id]}),e.invalidateQueries({queryKey:["materials"]})}})}function m(){let e=(0,i.useQueryClient)(),t=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:i}=await t.from("material_images").delete().eq("id",e).select().single();if(i)throw Error(i.message||"Failed to delete material image");return a},onSuccess:t=>{t?.material_id&&e.invalidateQueries({queryKey:["material",t.material_id]}),e.invalidateQueries({queryKey:["materials"]})}})}function h(){let e=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async t=>{let a=t.name.split(".").pop()||"jpg",i=`${Date.now()}-${Math.random().toString(36).slice(2)}`,r=`materials/${i}.${a}`,{error:s}=await e.storage.from("material-images").upload(r,t,{cacheControl:"3600",upsert:!1});if(s)throw Error(s.message||"Failed to upload material image");let{data:{publicUrl:n}}=e.storage.from("material-images").getPublicUrl(r);return n}})}e.s(["useCreateMaterial",()=>d,"useCreateMaterialImage",()=>c,"useDeleteMaterial",()=>u,"useDeleteMaterialImage",()=>m,"useMaterial",()=>l,"useMaterialByChapterId",()=>n,"useMaterials",()=>s,"useUpdateMaterial",()=>o,"useUploadMaterialImage",()=>h])},3352,e=>{"use strict";let t=(0,e.i(39898).default)("image-plus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);e.s(["ImagePlus",()=>t],3352)},84465,e=>{"use strict";var t=e.i(13105),a=e.i(95329),i=e.i(55744),r=e.i(96755),s=e.i(20401),n=e.i(42830),l=e.i(89473),d=e.i(67358),o=e.i(34893),u=e.i(23563),c=e.i(4063),m=e.i(41561),h=e.i(68745),p=e.i(77886),x=e.i(45951),g=e.i(75308),f=e.i(3352),y=e.i(54538),b=e.i(33212);function v(){let{user:e,isAdmin:v,loading:j}=(0,r.useAuth)(),_=(0,i.useRouter)(),w=(0,h.useCreateMaterial)(),C=(0,h.useUploadMaterialImage)(),N=(0,h.useCreateMaterialImage)(),{data:M}=(0,h.useMaterials)({includeUnpublished:!0,pageSize:200}),[S,k]=(0,a.useState)({chapter_id:1,category:"B",order_index:1,title:"",content_text:"{\n  \n}",is_published:!0}),[q,I]=(0,a.useState)([]),[O,F]=(0,a.useState)(null),[K,R]=(0,a.useState)(""),[P,A]=(0,a.useState)(""),L=new Set((M?.materials||[]).map(e=>e.chapter_id));(0,a.useEffect)(()=>{j||e&&v||_.push("/")},[e,v,j,_]);let Q=async e=>{e.preventDefault();let t=[];S.title.trim()||t.push("Title is required"),(!S.chapter_id||S.chapter_id<1||S.chapter_id>20)&&t.push("Chapter must be between 1 and 20"),S.order_index||t.push("Order index is required"),L.has(S.chapter_id)&&t.push("A material for this chapter already exists. Please edit it instead.");let a={};try{a=JSON.parse(S.content_text||"{}")}catch{t.push("Content must be valid JSON")}if(t.length>0)return void p.toast.error(t[0]);try{let e=await w.mutateAsync({chapter_id:S.chapter_id,category:S.category,order_index:S.order_index,title:S.title.trim(),content:a,is_published:S.is_published});if(q.length>0)for(let t=0;t<q.length;t++){let a=q[t],i=await C.mutateAsync(a.file);await N.mutateAsync({material_id:e.id,image_url:i,caption:a.caption||void 0,order_index:a.order_index})}p.toast.success("Material created successfully!"),setTimeout(()=>{_.push(`/admin/materials/${e.id}/edit`)},500)}catch(t){let e=t instanceof Error?t.message:"Failed to create material";e.includes("23505")?p.toast.error("A material for this chapter already exists. Please edit it instead."):p.toast.error(e)}};return j?(0,t.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]})}):e&&v?(0,t.jsxs)("div",{className:"min-h-screen bg-background text-foreground",children:[(0,t.jsx)(s.Navbar,{}),(0,t.jsxs)(m.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto px-6 py-8 max-w-4xl pt-28",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("div",{className:"flex gap-2 mb-4",children:(0,t.jsx)(l.Button,{variant:"ghost",asChild:!0,children:(0,t.jsxs)(b.default,{href:"/admin",children:[(0,t.jsx)(x.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Admin Dashboard"]})})}),(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Add Study Material"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Create a new study material entry for a specific chapter"})]}),(0,t.jsx)("form",{onSubmit:Q,children:(0,t.jsxs)(n.GlassCard,{className:"p-6 space-y-6 border border-border/80 bg-black/80",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"chapter_id",children:"Chapter *"}),(0,t.jsxs)(c.Select,{value:String(S.chapter_id),onValueChange:e=>{let t=parseInt(e,10)||1;k({...S,chapter_id:t,order_index:t})},children:[(0,t.jsx)(c.SelectTrigger,{id:"chapter_id",children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsx)(c.SelectContent,{children:Array.from({length:20}).map((e,a)=>{let i=a+1;return L.has(i)?null:(0,t.jsxs)(c.SelectItem,{value:String(i),children:["Chapter ",i]},i)})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"category",children:"Category *"}),(0,t.jsxs)(c.Select,{value:S.category,onValueChange:e=>k({...S,category:e}),children:[(0,t.jsx)(c.SelectTrigger,{id:"category",children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsxs)(c.SelectContent,{children:[(0,t.jsx)(c.SelectItem,{value:"A",children:"Category A"}),(0,t.jsx)(c.SelectItem,{value:"B",children:"Category B"}),(0,t.jsx)(c.SelectItem,{value:"C",children:"Category C"}),(0,t.jsx)(c.SelectItem,{value:"D",children:"Category D"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"order_index",children:"Order Index *"}),(0,t.jsx)(d.Input,{id:"order_index",type:"number",min:"1",value:S.order_index,onChange:e=>k({...S,order_index:parseInt(e.target.value,10)||1}),required:!0})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"title",children:"Title *"}),(0,t.jsx)(d.Input,{id:"title",value:S.title,onChange:e=>k({...S,title:e.target.value}),placeholder:"e.g. 1. Basic Traffic Rules",required:!0})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"content_text",children:"Content (JSON) *"}),(0,t.jsx)(u.Textarea,{id:"content_text",rows:10,value:S.content_text,onChange:e=>k({...S,content_text:e.target.value}),placeholder:"Paste or write the content as a JSON object (keys and arrays).",className:"font-mono text-xs",required:!0}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Example: ",'{"section_key": ["Point 1", "Point 2"]}']})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-3 pt-2",children:[(0,t.jsx)("input",{id:"is_published",type:"checkbox",checked:S.is_published,onChange:e=>k({...S,is_published:e.target.checked})}),(0,t.jsx)(o.Label,{htmlFor:"is_published",className:"text-sm",children:"Published (visible to users)"})]}),(0,t.jsxs)("div",{className:"space-y-4 pt-4 border-t border-border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.ImagePlus,{className:"w-4 h-4"}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Material Images"})]}),(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-[minmax(0,2fr),minmax(0,3fr)]",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"image_file",children:"Add Image"}),(0,t.jsx)("input",{id:"image_file",type:"file",accept:"image/*",onChange:e=>F(e.target.files?.[0]||null),className:"block w-full text-sm text-muted-foreground"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"image_caption",children:"Caption"}),(0,t.jsx)(d.Input,{id:"image_caption",value:K,onChange:e=>R(e.target.value),placeholder:"Optional caption"})]}),(0,t.jsxs)("div",{className:"space-y-2 max-w-xs",children:[(0,t.jsx)(o.Label,{htmlFor:"image_order_index",children:"Order Index"}),(0,t.jsx)(d.Input,{id:"image_order_index",type:"number",min:"1",value:""===P?"":P,onChange:e=>{let t=e.target.value;A(""===t?"":parseInt(t,10)||"")},placeholder:"Leave empty to append automatically"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Images are uploaded after the material is created and shown above the chapter content."})]}),(0,t.jsxs)(l.Button,{type:"button",onClick:()=>{if(!O)return void p.toast.error("Please select an image file");let e={file:O,caption:K,order_index:""===P?q.length+1:Number(P)||void 0};I(t=>[...t,e]),F(null),R(""),A("")},className:"shadow-sm",disabled:!O,children:[(0,t.jsx)(f.ImagePlus,{className:"w-4 h-4 mr-2"}),"Add Image to Queue"]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Images queued for upload"}),0===q.length?(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No images queued yet. You can add images now or later on the edit page."}):(0,t.jsx)("div",{className:"space-y-2 text-xs",children:q.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 border border-border rounded-md px-3 py-2 bg-muted/40",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium truncate",children:e.file.name}),e.order_index&&(0,t.jsxs)("p",{className:"text-[10px] text-muted-foreground",children:["Order: ",e.order_index]})]}),(0,t.jsx)(l.Button,{type:"button",size:"icon",variant:"destructive",className:"h-7 w-7",onClick:()=>{I(e=>e.filter((e,t)=>t!==a))},children:(0,t.jsx)(y.Trash2,{className:"w-3 h-3"})})]},a))})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,t.jsx)(l.Button,{type:"submit",disabled:w.isPending||C.isPending||N.isPending,className:"flex-1 shadow-lg shadow-primary/20",children:w.isPending?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Creating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Save,{className:"w-4 h-4 mr-2"}),"Create Material"]})}),(0,t.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>_.push("/admin/materials"),disabled:w.isPending,children:"Cancel"})]})]})})]})]}):null}e.s(["default",()=>v])}]);