(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,94312,e=>{"use strict";var t=e.i(13105),r=e.i(20696);function s({className:e,...s}){return(0,t.jsx)("div",{className:(0,r.cn)("relative overflow-hidden rounded-xl bg-gradient-to-r from-muted/60 via-muted/35 to-muted/60","before:absolute before:inset-0 before:-translate-x-full before:bg-gradient-to-r before:from-transparent before:via-primary/18 before:to-transparent before:animate-[shimmer_1.4s_infinite]",e),...s})}e.s(["Skeleton",()=>s])},87370,e=>{"use strict";let t=(0,e.i(39898).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["default",()=>t])},45951,e=>{"use strict";let t=(0,e.i(39898).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],45951)},3604,e=>{"use strict";var t=e.i(95329),r=e.i(33133),s=e.i(50863),i=e.i(8181),a=e.i(921),n=class extends i.Subscribable{#e;#t=void 0;#r;#s;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,a.shallowEqualObjects)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,a.hashKey)(t.mutationKey)!==(0,a.hashKey)(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#i(),this.#a()}mutate(e,t){return this.#s=t,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(e)}#i(){let e=this.#r?.state??(0,r.getDefaultState)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#a(e){s.notifyManager.batch(()=>{if(this.#s&&this.hasListeners()){let t=this.#t.variables,r=this.#t.context,s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,t,r,s),this.#s.onSettled?.(e.data,null,t,r,s)):e?.type==="error"&&(this.#s.onError?.(e.error,t,r,s),this.#s.onSettled?.(void 0,e.error,t,r,s))}this.listeners.forEach(e=>{e(this.#t)})})}},o=e.i(94494);function c(e,r){let i=(0,o.useQueryClient)(r),[c]=t.useState(()=>new n(i,e));t.useEffect(()=>{c.setOptions(e)},[c,e]);let u=t.useSyncExternalStore(t.useCallback(e=>c.subscribe(s.notifyManager.batchCalls(e)),[c]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),l=t.useCallback((e,t)=>{c.mutate(e,t).catch(a.noop)},[c]);if(u.error&&(0,a.shouldThrowError)(c.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:l,mutateAsync:u.mutate}}e.s(["useMutation",()=>c],3604)},89679,e=>{"use strict";var t=e.i(50351);let r={freeTestLimitPerCategory:Number(t.default.env.NEXT_PUBLIC_FREE_TEST_LIMIT_PER_CATEGORY??"3"),paidTestLimitPerCategory:Number(t.default.env.NEXT_PUBLIC_PAID_TEST_LIMIT_PER_CATEGORY??"9999"),billingCycleDays:Number(t.default.env.NEXT_PUBLIC_BILLING_CYCLE_DAYS??"30"),bestValuePlan:t.default.env.NEXT_PUBLIC_PAYMENT_BEST_VALUE_PLAN??"PLAN_C",plans:[{id:"PLAN_A",label:"1 month",months:1,priceEur:3},{id:"PLAN_B",label:"2 months",months:2,priceEur:6},{id:"PLAN_C",label:"3 months",months:3,priceEur:8,badge:"BEST_VALUE",emphasize:!0}].reduce((e,t)=>{let r=t.priceEur/t.months;return e[t.id]={...t,pricePerMonthEur:r},e},{})};function s(e,t=new Date){if(!e)return!1;let r=new Date(e.startDate).getTime(),i=new Date(e.endDate).getTime(),a=t.getTime();return a>=r&&a<=i}function i(e){let{isAdmin:t,testsTakenThisCycle:i,activePlan:a,now:n}=e;if(t)return{canAccessTests:!0,canStartNewTest:!0,remainingFreeTests:void 0,canAccessDecisionTrainer:!0,canAccessStudyMaterial:!0,canReviewTestsInDetail:!0};if(a&&s({startDate:a.startDate,endDate:a.endDate},n))return{canAccessTests:!0,canStartNewTest:i<r.paidTestLimitPerCategory,remainingFreeTests:Math.max(0,r.paidTestLimitPerCategory-i),canAccessDecisionTrainer:!0,canAccessStudyMaterial:!0,canReviewTestsInDetail:!0};let o=Math.max(0,r.freeTestLimitPerCategory-i);return{canAccessTests:!0,canStartNewTest:o>0,remainingFreeTests:o,canAccessDecisionTrainer:!1,canAccessStudyMaterial:!1,canReviewTestsInDetail:!1}}function a(e){let{attempts:t,category:s,now:i}=e,a=i??new Date,n=new Date(a);n.setDate(n.getDate()-r.billingCycleDays+1);let o=n.getTime(),c=a.getTime();return t.filter(e=>{if(e.category!==s)return!1;let t=new Date(e.completed_at).getTime();return t>=o&&t<=c}).length}e.s(["BILLING_CONFIG",0,r,"computeEntitlements",()=>i,"countTestsInCurrentCycle",()=>a,"isPlanCurrentlyActive",()=>s])},5642,e=>{"use strict";var t=e.i(55650),r=e.i(90582),s=e.i(89679);function i(e){return(0,t.useQuery)({queryKey:["user-plans",e],queryFn:async()=>{let t=(0,r.createClient)(),{data:s,error:i}=await t.from("user_plans").select("*").eq("user_id",e);if(i)throw i;return s||[]},enabled:!!e,staleTime:0,refetchOnMount:"always"})}function a(e,t){let r=i(e),a=new Date,n=!!t||(r.data||[]).some(e=>"active"===e.status&&(0,s.isPlanCurrentlyActive)({startDate:e.start_date,endDate:e.end_date},a));return{...r,hasAnyActivePlan:n}}function n(e,i,a){return(0,t.useQuery)({queryKey:["category-entitlements",e,i,a],queryFn:async()=>{let t=(0,r.createClient)(),[n,o]=await Promise.all([t.from("user_plans").select("*").eq("user_id",e).eq("category",i).order("end_date",{ascending:!1}).limit(1),t.from("test_attempts").select("category, completed_at").eq("user_id",e)]);if(n.error)throw n.error;if(o.error)throw o.error;let c=(n.data||[])[0],u=new Date,l=(0,s.countTestsInCurrentCycle)({attempts:(o.data||[]).map(e=>({category:e.category,completed_at:e.completed_at})),category:i,now:u}),d=c?{id:c.id,userId:c.user_id,category:c.category,planTier:c.plan_tier,startDate:c.start_date,endDate:c.end_date,isActive:"active"===c.status,createdAt:c.created_at}:null;return{entitlements:(0,s.computeEntitlements)({isAdmin:a,testsTakenThisCycle:l,activePlan:d?{planTier:d.planTier,startDate:d.startDate,endDate:d.endDate,isActive:d.isActive}:null,now:u}),plan:d,testsTakenThisCycle:l}},enabled:!!e&&!!i,staleTime:3e5})}e.s(["useCategoryEntitlements",()=>n,"useGlobalPremium",()=>a,"useUserPlans",()=>i])},4108,e=>{"use strict";let t=(0,e.i(39898).default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>t],4108)},10956,e=>{"use strict";var t=e.i(87370);e.s(["Check",()=>t.default])},35253,e=>{"use strict";let t=(0,e.i(39898).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],35253)},65544,e=>{"use strict";let t=(0,e.i(39898).default)("car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);e.s(["Car",()=>t],65544)},86046,e=>{"use strict";e.s(["CATEGORY_INFO",0,{"traffic-lights":{name:"SemaforÃ«t",icon:"ðŸš¦",description:"MÃ«soni kur tÃ« ndaloni dhe tÃ« vazhdoni",color:"#ef4444"},signs:{name:"Shenjat e RrugÃ«s",icon:"ðŸ›‘",description:"MÃ«soni shenjat e ndalimit dhe paralajmÃ«rimit",color:"#f59e0b"},pedestrians:{name:"Siguria e KÃ«mbÃ«sorÃ«ve",icon:"ðŸš¶",description:"Mbroni pÃ«rdoruesit e pambrojtur tÃ« rrugÃ«s",color:"#3b82f6"},"right-of-way":{name:"PÃ«rparÃ«sia e Kalimit",icon:"ðŸ”„",description:"MÃ«soni kush ka pÃ«rparÃ«si nÃ« kryqÃ«zime",color:"#8b5cf6"},hazards:{name:"Rreziqet nÃ« RrugÃ«",icon:"âš ï¸",description:"PÃ«rballuni me motin dhe pengesat",color:"#eab308"},parking:{name:"Rregullat e Parkimit",icon:"ðŸ…¿ï¸",description:"MÃ«soni parkimin e sigurt dhe tÃ« ligjshÃ«m",color:"#06b6d4"}}])},97947,e=>{"use strict";let t=(0,e.i(39898).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>t],97947)},88717,e=>{"use strict";let t=(0,e.i(39898).default)("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]);e.s(["Trophy",()=>t],88717)},75039,e=>{"use strict";var t=e.i(55650),r=e.i(90582);function s(e){return(0,t.useQuery)({queryKey:["leaderboard",e],queryFn:async()=>{let t=(0,r.createClient)(),{data:s,error:i}=await t.from("decision_trainer_leaderboard").select("*").order("total_xp",{ascending:!1}).order("best_time_seconds",{ascending:!0});if(i)return{topTen:[],currentUserRank:null,totalUsers:0};let a=s||[],n=a.length,o=a.slice(0,10),c=null;if(e){let t=a.findIndex(t=>t.user_id===e);-1!==t&&(c={...a[t],rank:t+1,isInTopTen:t<10})}return{topTen:o,currentUserRank:c,totalUsers:n}},staleTime:3e4,refetchInterval:6e4})}e.s(["useLeaderboard",()=>s])},87781,e=>{"use strict";var t=e.i(55650),r=e.i(3604),s=e.i(94494),i=e.i(90582);function a(e,r){return(0,t.useQuery)({queryKey:["decision-trainer-progress",e,r],queryFn:async()=>{let t=(0,i.createClient)().from("decision_trainer_progress").select("*").eq("user_id",e);r&&(t=t.eq("category",r));let{data:s,error:a}=await t;if(a)throw a;return s||[]},enabled:!!e,staleTime:0,refetchOnMount:"always"})}function n(e){return(0,t.useQuery)({queryKey:["decision-trainer-stats",e],queryFn:async()=>{let t=(0,i.createClient)(),{data:r,error:s}=await t.from("decision_trainer_progress").select("*").eq("user_id",e);if(s)throw s;let a=r||[],n=a.reduce((e,t)=>e+t.total_xp,0),o=a.reduce((e,t)=>e+t.scenarios_completed,0),c=a.reduce((e,t)=>e+t.correct_answers,0),u=a.reduce((e,t)=>e+t.total_attempts,0),l=Math.max(...a.map(e=>e.best_streak),0),d=Math.min(...a.map(e=>e.best_time_seconds).filter(e=>null!==e),1/0),h=u>0?Math.round(c/u*100):0;return{totalXp:n,totalScenarios:o,totalCorrect:c,totalAttempts:u,bestStreak:l,bestTime:d===1/0?null:d,accuracy:h,categoriesCompleted:a.length,categoryProgress:a}},enabled:!!e,staleTime:6e4})}function o(e){return(0,t.useQuery)({queryKey:["weak-scenario-ids",e],queryFn:async()=>{let t=(0,i.createClient)(),{data:r,error:s}=await t.from("decision_trainer_attempts").select("scenario_id, is_correct, created_at").eq("user_id",e).order("created_at",{ascending:!0});if(s)throw s;let a=new Map;(r||[]).forEach(e=>{a.set(e.scenario_id,e.is_correct)});let n=[];return a.forEach((e,t)=>{e||n.push(t)}),n},enabled:!!e,staleTime:0})}function c(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:async({userId:e,category:t,attempts:r,totalTimeMs:s})=>{let a=(0,i.createClient)(),n=r.map(r=>({user_id:e,scenario_id:r.scenarioId,category:t,is_correct:r.isCorrect,selected_options:r.selectedOptions,time_taken_ms:r.timeTakenMs,xp_earned:r.xpEarned})),{error:o}=await a.from("decision_trainer_attempts").insert(n);if(o)throw o;let c=r.reduce((e,t)=>e+t.xpEarned,0),u=r.filter(e=>e.isCorrect).length,l=r.length,d=0,h=0;for(let e of r)e.isCorrect?d=Math.max(d,++h):h=0;let{data:m}=await a.from("decision_trainer_progress").select("*").eq("user_id",e).eq("category",t).maybeSingle(),p=(m?.total_xp||0)+c,y=(m?.scenarios_completed||0)+l,_=(m?.correct_answers||0)+u,f=(m?.total_attempts||0)+l,g=Math.max(m?.best_streak||0,d),b=Math.round(s/l/1e3),T=m?.best_time_seconds?Math.min(m.best_time_seconds,b):b,{data:M,error:v}=await a.from("decision_trainer_progress").upsert({user_id:e,category:t,total_xp:p,scenarios_completed:y,correct_answers:_,total_attempts:f,current_streak:d,best_streak:g,best_time_seconds:T,average_time_seconds:b,updated_at:new Date().toISOString()},{onConflict:"user_id,category"}).select().single();if(v)throw v;return{progress:M,sessionStats:{totalXpEarned:c,correctCount:u,totalCount:l,accuracy:Math.round(u/l*100),maxStreak:d,avgTimeSeconds:b}}},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["decision-trainer-progress",r.userId]}),e.invalidateQueries({queryKey:["decision-trainer-stats",r.userId]}),e.invalidateQueries({queryKey:["leaderboard"]})}})}e.s(["useCompleteCategory",()=>c,"useDecisionTrainerProgress",()=>a,"useDecisionTrainerStats",()=>n,"useWeakScenarioIds",()=>o])}]);