(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,45951,e=>{"use strict";let t=(0,e.i(39898).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],45951)},3604,e=>{"use strict";var t=e.i(95329),a=e.i(33133),s=e.i(50863),r=e.i(8181),i=e.i(921),l=class extends r.Subscribable{#e;#t=void 0;#a;#s;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,i.shallowEqualObjects)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#a,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,i.hashKey)(t.mutationKey)!==(0,i.hashKey)(this.options.mutationKey)?this.reset():this.#a?.state.status==="pending"&&this.#a.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#a?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#i(e)}getCurrentResult(){return this.#t}reset(){this.#a?.removeObserver(this),this.#a=void 0,this.#r(),this.#i()}mutate(e,t){return this.#s=t,this.#a?.removeObserver(this),this.#a=this.#e.getMutationCache().build(this.#e,this.options),this.#a.addObserver(this),this.#a.execute(e)}#r(){let e=this.#a?.state??(0,a.getDefaultState)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#i(e){s.notifyManager.batch(()=>{if(this.#s&&this.hasListeners()){let t=this.#t.variables,a=this.#t.context,s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,t,a,s),this.#s.onSettled?.(e.data,null,t,a,s)):e?.type==="error"&&(this.#s.onError?.(e.error,t,a,s),this.#s.onSettled?.(void 0,e.error,t,a,s))}this.listeners.forEach(e=>{e(this.#t)})})}},n=e.i(94494);function o(e,a){let r=(0,n.useQueryClient)(a),[o]=t.useState(()=>new l(r,e));t.useEffect(()=>{o.setOptions(e)},[o,e]);let d=t.useSyncExternalStore(t.useCallback(e=>o.subscribe(s.notifyManager.batchCalls(e)),[o]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),u=t.useCallback((e,t)=>{o.mutate(e,t).catch(i.noop)},[o]);if(d.error&&(0,i.shouldThrowError)(o.options.throwOnError,[d.error]))throw d.error;return{...d,mutate:u,mutateAsync:d.mutate}}e.s(["useMutation",()=>o],3604)},54538,e=>{"use strict";let t=(0,e.i(39898).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],54538)},67358,e=>{"use strict";var t=e.i(13105),a=e.i(95329),s=e.i(20696);let r=a.forwardRef(({className:e,type:a,...r},i)=>(0,t.jsx)("input",{type:a,className:(0,s.cn)("flex h-10 w-full rounded-xl border border-input/70 bg-background/60 px-3.5 py-2 text-sm text-foreground shadow-[0_8px_24px_rgba(0,0,0,0.7)] backdrop-blur-xl","transition-all duration-200 file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground/80","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/80 focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...r}));r.displayName="Input",e.s(["Input",()=>r])},87370,e=>{"use strict";let t=(0,e.i(39898).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["default",()=>t])},68745,e=>{"use strict";var t=e.i(55650),a=e.i(3604),s=e.i(94494),r=e.i(90582);function i(e={}){let{search:a,chapterId:s,category:l,page:n=1,pageSize:o=50,includeUnpublished:d=!1,fields:u="*"}=e,c=(0,r.createClient)();return(0,t.useQuery)({queryKey:["materials",a,s,l,n,o,d,u],queryFn:async()=>{let e=(n-1)*o,t=c.from("study_materials").select(u,{count:"planned"}).order("order_index",{ascending:!0});if(s&&(t=t.eq("chapter_id",s)),l&&(t=t.eq("category",l)),d||(t=t.eq("is_published",!0)),a&&a.trim()){let e=a.trim();t=t.ilike("title",`%${e}%`)}let{data:r,error:i,count:m}=await t.range(e,e+o-1);if(i)throw i;let h=r||[];if("*"!==u)return{materials:h,total:m||0};let x=h.map(e=>e.id),f=[];if(x.length>0){let{data:e,error:t}=await c.from("material_images").select("*").in("material_id",x).order("order_index",{ascending:!0}).order("created_at",{ascending:!0});if(t)throw t;f=e||[]}return{materials:h.map(e=>({...e,images:f.filter(t=>t.material_id===e.id)})),total:m||0}}})}function l(e){let a=(0,r.createClient)();return(0,t.useQuery)({queryKey:["material-by-chapter",e],queryFn:async()=>{if(void 0===e)return null;let{data:t,error:s}=await a.from("study_materials").select("*").eq("chapter_id",e).single();if(s)throw s;let{data:r,error:i}=await a.from("material_images").select("*").eq("material_id",t.id).order("order_index",{ascending:!0}).order("created_at",{ascending:!0});if(i)throw i;return{...t,images:r||[]}},enabled:!!e,staleTime:3e5})}function n(e){let a=(0,r.createClient)();return(0,t.useQuery)({queryKey:["material",e],queryFn:async()=>{if(!e)return null;let{data:t,error:s}=await a.from("study_materials").select("*").eq("id",e).single();if(s)throw s;let{data:r,error:i}=await a.from("material_images").select("*").eq("material_id",e).order("order_index",{ascending:!0}).order("created_at",{ascending:!0});if(i)throw i;return{...t,images:r||[]}},enabled:!!e})}function o(){let e=(0,s.useQueryClient)(),t=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:s}=await t.from("study_materials").insert([e]).select().single();if(s)throw Error(s.message||s.details||"Failed to create material");return a},onSuccess:()=>{e.invalidateQueries({queryKey:["materials"]})}})}function d(){let e=(0,s.useQueryClient)(),t=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async({id:e,...a})=>{let{data:s,error:r}=await t.from("study_materials").update(a).eq("id",e).select().single();if(r)throw Error(r.message||r.details||"Failed to update material");return s},onSuccess:t=>{e.invalidateQueries({queryKey:["materials"]}),e.invalidateQueries({queryKey:["material",t.id]})}})}function u(){let e=(0,s.useQueryClient)(),t=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async e=>{let{error:a}=await t.from("study_materials").delete().eq("id",e);if(a)throw Error(a.message||"Failed to delete material");return e},onSuccess:()=>{e.invalidateQueries({queryKey:["materials"]})}})}function c(){let e=(0,s.useQueryClient)(),t=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:s}=await t.from("material_images").insert([e]).select().single();if(s)throw Error(s.message||s.details||"Failed to create material image");return a},onSuccess:t=>{e.invalidateQueries({queryKey:["material",t.material_id]}),e.invalidateQueries({queryKey:["materials"]})}})}function m(){let e=(0,s.useQueryClient)(),t=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:s}=await t.from("material_images").delete().eq("id",e).select().single();if(s)throw Error(s.message||"Failed to delete material image");return a},onSuccess:t=>{t?.material_id&&e.invalidateQueries({queryKey:["material",t.material_id]}),e.invalidateQueries({queryKey:["materials"]})}})}function h(){let e=(0,r.createClient)();return(0,a.useMutation)({mutationFn:async t=>{let a=t.name.split(".").pop()||"jpg",s=`${Date.now()}-${Math.random().toString(36).slice(2)}`,r=`materials/${s}.${a}`,{error:i}=await e.storage.from("material-images").upload(r,t,{cacheControl:"3600",upsert:!1});if(i)throw Error(i.message||"Failed to upload material image");let{data:{publicUrl:l}}=e.storage.from("material-images").getPublicUrl(r);return l}})}e.s(["useCreateMaterial",()=>o,"useCreateMaterialImage",()=>c,"useDeleteMaterial",()=>u,"useDeleteMaterialImage",()=>m,"useMaterial",()=>n,"useMaterialByChapterId",()=>l,"useMaterials",()=>i,"useUpdateMaterial",()=>d,"useUploadMaterialImage",()=>h])},82066,e=>{"use strict";let t=(0,e.i(39898).default)("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);e.s(["BookOpen",()=>t],82066)},52803,e=>{"use strict";let t=(0,e.i(39898).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],52803)},13490,e=>{"use strict";let t=(0,e.i(39898).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>t],13490)},72181,e=>{"use strict";let t=(0,e.i(39898).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],72181)},58598,e=>{"use strict";var t=e.i(13105),a=e.i(95329),s=e.i(20696),r=e.i(89473);let i=({open:e,onOpenChange:a,children:s})=>(0,t.jsx)(t.Fragment,{children:e&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-xl",onClick:()=>a?.(!1)}),(0,t.jsx)("div",{className:"relative z-50",children:s})]})}),l=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{ref:r,className:(0,s.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 rounded-2xl border border-border/70 bg-card/90 p-6 shadow-[0_24px_80px_rgba(0,0,0,0.9)] backdrop-blur-2xl duration-200",e),...a}));l.displayName="AlertDialogContent";let n=({className:e,...a})=>(0,t.jsx)("div",{className:(0,s.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...a});n.displayName="AlertDialogHeader";let o=({className:e,...a})=>(0,t.jsx)("div",{className:(0,s.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});o.displayName="AlertDialogFooter";let d=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("h2",{ref:r,className:(0,s.cn)("text-lg font-semibold",e),...a}));d.displayName="AlertDialogTitle";let u=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("p",{ref:r,className:(0,s.cn)("text-sm text-muted-foreground",e),...a}));u.displayName="AlertDialogDescription";let c=a.forwardRef(({className:e,...a},i)=>(0,t.jsx)(r.Button,{ref:i,className:(0,s.cn)("",e),...a}));c.displayName="AlertDialogAction";let m=a.forwardRef(({className:e,...a},i)=>(0,t.jsx)(r.Button,{ref:i,variant:"outline",className:(0,s.cn)("mt-2 sm:mt-0",e),...a}));m.displayName="AlertDialogCancel",e.s(["AlertDialog",()=>i,"AlertDialogAction",()=>c,"AlertDialogCancel",()=>m,"AlertDialogContent",()=>l,"AlertDialogDescription",()=>u,"AlertDialogFooter",()=>o,"AlertDialogHeader",()=>n,"AlertDialogTitle",()=>d])},99068,e=>{"use strict";var t=e.i(13105),a=e.i(95329),s=e.i(55744),r=e.i(96755),i=e.i(20401),l=e.i(42830),n=e.i(89473),o=e.i(67358),d=e.i(33212),u=e.i(82066),c=e.i(72181),m=e.i(52803),h=e.i(13490),x=e.i(54538),f=e.i(45951),p=e.i(41561),g=e.i(68745),y=e.i(77886),b=e.i(4063),j=e.i(58598);function v(){let{user:e,isAdmin:v,loading:w}=(0,r.useAuth)(),N=(0,s.useRouter)(),[M,C]=(0,a.useState)(""),[k,A]=(0,a.useState)("all"),[_,D]=(0,a.useState)(1),[S,q]=(0,a.useState)(!1),[O,R]=(0,a.useState)(null),E="all"===k?void 0:parseInt(k,10)||void 0,{data:F,isLoading:K,error:Q}=(0,g.useMaterials)({search:M,chapterId:E,page:_,pageSize:10,includeUnpublished:!0}),B=(0,g.useDeleteMaterial)();(0,a.useEffect)(()=>{w||e&&v||N.push("/")},[e,v,w,N]);let P=F?.total||0,T=F?.materials||[],z=Math.ceil(P/10)||1;(0,a.useEffect)(()=>{D(1)},[M,k]);let I=async()=>{if(O)try{await B.mutateAsync(O.id),y.toast.success("Material deleted successfully"),q(!1),R(null)}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";y.toast.error(`Failed to delete material: ${e}`)}};return w||K?(0,t.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading materials..."})]})}):e&&v?Q?(0,t.jsxs)("div",{className:"min-h-screen bg-background text-foreground",children:[(0,t.jsx)(i.Navbar,{}),(0,t.jsx)("div",{className:"container mx-auto px-6 py-8 max-w-7xl",children:(0,t.jsx)(l.GlassCard,{className:"p-6 border border-border/80 bg-black/80",children:(0,t.jsxs)("p",{className:"text-destructive",children:["Error loading materials: ",Q.message]})})})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-background text-foreground",children:[(0,t.jsx)(i.Navbar,{}),(0,t.jsxs)(p.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto px-6 py-8 max-w-7xl pt-28",children:[(0,t.jsx)(n.Button,{variant:"ghost",asChild:!0,className:"mb-4",children:(0,t.jsxs)(d.default,{href:"/admin",children:[(0,t.jsx)(f.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Admin Dashboard"]})}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,t.jsx)(u.BookOpen,{className:"w-7 h-7 text-primary"}),"Study Materials"]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Manage study materials for each chapter (",P," total)"]})]}),(0,t.jsx)(n.Button,{asChild:!0,className:"shadow-lg shadow-primary/20",children:(0,t.jsxs)(d.default,{href:"/admin/materials/new",children:[(0,t.jsx)(c.Plus,{className:"w-4 h-4 mr-2"}),"Add Material"]})})]}),(0,t.jsx)(l.GlassCard,{className:"p-6 mb-6 border border-border/80 bg-black/80",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)(m.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,t.jsx)(o.Input,{placeholder:"Search by title...",value:M,onChange:e=>C(e.target.value),className:"pl-10"})]}),(0,t.jsx)("div",{className:"w-full md:w-48",children:(0,t.jsxs)(b.Select,{value:k,onValueChange:e=>A(e),children:[(0,t.jsx)(b.SelectTrigger,{children:(0,t.jsx)(b.SelectValue,{placeholder:"All Chapters"})}),(0,t.jsxs)(b.SelectContent,{children:[(0,t.jsx)(b.SelectItem,{value:"all",children:"All Chapters"}),Array.from({length:13}).map((e,a)=>{let s=a+1;return(0,t.jsxs)(b.SelectItem,{value:String(s),children:["Chapter ",s]},s)})]})]})})]})}),(0,t.jsxs)("div",{className:"space-y-4",children:[0===T.length&&(0,t.jsxs)(l.GlassCard,{className:"p-12 text-center border border-border/80 bg-black/80",children:[(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"No materials found. Add your first study material."}),(0,t.jsx)(n.Button,{asChild:!0,children:(0,t.jsxs)(d.default,{href:"/admin/materials/new",children:[(0,t.jsx)(c.Plus,{className:"w-4 h-4 mr-2"}),"Add First Material"]})})]}),T.map(e=>(0,t.jsxs)(l.GlassCard,{className:"p-5 flex flex-col md:flex-row justify-between gap-4 border border-border/80 bg-black/80",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[(0,t.jsxs)("span",{className:"px-2 py-1 rounded-lg bg-primary/10 text-primary text-xs font-semibold",children:["Chapter ",e.chapter_id]}),(0,t.jsx)("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${e.is_published?"bg-emerald-50 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-300":"bg-amber-50 text-amber-600 dark:bg-amber-900/30 dark:text-amber-300"}`,children:e.is_published?"Published":"Draft"})]}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-1",children:e.title}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2"}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Last updated: ",new Date(e.updated_at).toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex md:flex-col gap-2 md:min-w-[160px]",children:[(0,t.jsx)(n.Button,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 md:flex-none",children:(0,t.jsxs)(d.default,{href:`/admin/materials/${e.id}/edit`,children:[(0,t.jsx)(h.Edit,{className:"w-4 h-4 md:mr-2"}),(0,t.jsx)("span",{className:"hidden md:inline",children:"Edit"})]})}),(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>{R(e),q(!0)},disabled:B.isPending,className:"flex-1 md:flex-none text-destructive hover:text-destructive",children:[(0,t.jsx)(x.Trash2,{className:"w-4 h-4 md:mr-2"}),(0,t.jsx)("span",{className:"hidden md:inline",children:"Delete"})]})]})]},e.id))]}),z>1&&(0,t.jsxs)("div",{className:"mt-8 flex flex-col items-center gap-3",children:[(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Showing ",(_-1)*10+1," ","- ",Math.min(10*_,P)," of ",P," materials"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Button,{variant:"outline",size:"sm",disabled:1===_,onClick:()=>D(e=>Math.max(1,e-1)),children:"Previous"}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Page ",_," of ",z]}),(0,t.jsx)(n.Button,{variant:"outline",size:"sm",disabled:_===z,onClick:()=>D(e=>Math.min(z,e+1)),children:"Next"})]})]})]}),(0,t.jsx)(j.AlertDialog,{open:S,onOpenChange:q,children:(0,t.jsxs)(j.AlertDialogContent,{children:[(0,t.jsxs)(j.AlertDialogHeader,{children:[(0,t.jsx)(j.AlertDialogTitle,{children:"Delete Material"}),(0,t.jsxs)(j.AlertDialogDescription,{children:["Are you sure you want to delete this material?",(0,t.jsx)("div",{className:"mt-3 p-3 rounded-lg bg-muted/50 border border-border",children:(0,t.jsxs)("p",{className:"text-sm font-medium text-foreground line-clamp-2",children:["Chapter ",O?.chapter_id,": ",O?.title]})}),(0,t.jsx)("p",{className:"mt-3 text-destructive font-medium",children:"This action cannot be undone."})]})]}),(0,t.jsxs)(j.AlertDialogFooter,{children:[(0,t.jsx)(j.AlertDialogCancel,{onClick:()=>q(!1),children:"Cancel"}),(0,t.jsx)(j.AlertDialogAction,{onClick:I,disabled:B.isPending,className:"bg-destructive hover:bg-destructive/90",children:B.isPending?"Deleting...":"Delete"})]})]})})]}):null}e.s(["default",()=>v])}]);