(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,89679,e=>{"use strict";var t=e.i(50351);let a={freeTestLimitPerCategory:Number(t.default.env.NEXT_PUBLIC_FREE_TEST_LIMIT_PER_CATEGORY??"3"),paidTestLimitPerCategory:Number(t.default.env.NEXT_PUBLIC_PAID_TEST_LIMIT_PER_CATEGORY??"9999"),billingCycleDays:Number(t.default.env.NEXT_PUBLIC_BILLING_CYCLE_DAYS??"30"),bestValuePlan:t.default.env.NEXT_PUBLIC_PAYMENT_BEST_VALUE_PLAN??"PLAN_C",plans:[{id:"PLAN_A",label:"1 month",months:1,priceEur:3},{id:"PLAN_B",label:"2 months",months:2,priceEur:6},{id:"PLAN_C",label:"3 months",months:3,priceEur:8,badge:"BEST_VALUE",emphasize:!0}].reduce((e,t)=>{let a=t.priceEur/t.months;return e[t.id]={...t,pricePerMonthEur:a},e},{})};function r(e,t=new Date){if(!e)return!1;let a=new Date(e.startDate).getTime(),i=new Date(e.endDate).getTime(),s=t.getTime();return s>=a&&s<=i}function i(e){let{isAdmin:t,testsTakenThisCycle:i,activePlan:s,now:n}=e;if(t)return{canAccessTests:!0,canStartNewTest:!0,remainingFreeTests:void 0,canAccessDecisionTrainer:!0,canAccessStudyMaterial:!0,canReviewTestsInDetail:!0};if(s&&r({startDate:s.startDate,endDate:s.endDate},n))return{canAccessTests:!0,canStartNewTest:i<a.paidTestLimitPerCategory,remainingFreeTests:Math.max(0,a.paidTestLimitPerCategory-i),canAccessDecisionTrainer:!0,canAccessStudyMaterial:!0,canReviewTestsInDetail:!0};let l=Math.max(0,a.freeTestLimitPerCategory-i);return{canAccessTests:!0,canStartNewTest:l>0,remainingFreeTests:l,canAccessDecisionTrainer:!1,canAccessStudyMaterial:!1,canReviewTestsInDetail:!1}}function s(e){let{attempts:t,category:r,now:i}=e,s=i??new Date,n=new Date(s);n.setDate(n.getDate()-a.billingCycleDays+1);let l=n.getTime(),c=s.getTime();return t.filter(e=>{if(e.category!==r)return!1;let t=new Date(e.completed_at).getTime();return t>=l&&t<=c}).length}e.s(["BILLING_CONFIG",0,a,"computeEntitlements",()=>i,"countTestsInCurrentCycle",()=>s,"isPlanCurrentlyActive",()=>r])},5642,e=>{"use strict";var t=e.i(55650),a=e.i(90582),r=e.i(89679);function i(e){return(0,t.useQuery)({queryKey:["user-plans",e],queryFn:async()=>{let t=(0,a.createClient)(),{data:r,error:i}=await t.from("user_plans").select("*").eq("user_id",e);if(i)throw i;return r||[]},enabled:!!e,staleTime:0,refetchOnMount:"always"})}function s(e,t){let a=i(e),s=new Date,n=!!t||(a.data||[]).some(e=>"active"===e.status&&(0,r.isPlanCurrentlyActive)({startDate:e.start_date,endDate:e.end_date},s));return{...a,hasAnyActivePlan:n}}function n(e,i,s){return(0,t.useQuery)({queryKey:["category-entitlements",e,i,s],queryFn:async()=>{let t=(0,a.createClient)(),[n,l]=await Promise.all([t.from("user_plans").select("*").eq("user_id",e).eq("category",i).order("end_date",{ascending:!1}).limit(1),t.from("test_attempts").select("category, completed_at").eq("user_id",e)]);if(n.error)throw n.error;if(l.error)throw l.error;let c=(n.data||[])[0],u=new Date,d=(0,r.countTestsInCurrentCycle)({attempts:(l.data||[]).map(e=>({category:e.category,completed_at:e.completed_at})),category:i,now:u}),m=c?{id:c.id,userId:c.user_id,category:c.category,planTier:c.plan_tier,startDate:c.start_date,endDate:c.end_date,isActive:"active"===c.status,createdAt:c.created_at}:null;return{entitlements:(0,r.computeEntitlements)({isAdmin:s,testsTakenThisCycle:d,activePlan:m?{planTier:m.planTier,startDate:m.startDate,endDate:m.endDate,isActive:m.isActive}:null,now:u}),plan:m,testsTakenThisCycle:d}},enabled:!!e&&!!i,staleTime:3e5})}e.s(["useCategoryEntitlements",()=>n,"useGlobalPremium",()=>s,"useUserPlans",()=>i])},77248,e=>{"use strict";let t=(0,e.i(39898).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],77248)},3389,e=>{"use strict";let t=(0,e.i(39898).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],3389)},11636,e=>{"use strict";let t=(0,e.i(39898).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],11636)},67987,e=>{"use strict";var t=e.i(13105),a=e.i(95329),r=e.i(55744),i=e.i(33212),s=e.i(20401),n=e.i(42830),l=e.i(89473),c=e.i(18797),u=e.i(96755),d=e.i(5642),m=e.i(89679),o=e.i(11636),f=e.i(3389),y=e.i(77248),p=e.i(94494);function g(){(0,r.useRouter)();let{t:e,language:g}=(0,c.useLanguage)(),{user:T,loading:h}=(0,u.useAuth)(),x="sq"===g,_=(0,p.useQueryClient)(),{data:b,refetch:C,isError:v}=(0,d.useUserPlans)(T?.id),[D,P]=(0,a.useState)(!0),[w,A]=(0,a.useState)(!1),[k,N]=(0,a.useState)(0),E=b?.some(e=>"active"===e.status&&(0,m.isPlanCurrentlyActive)({startDate:e.start_date,endDate:e.end_date}));(0,a.useEffect)(()=>{T?.id&&(_.invalidateQueries({queryKey:["user-plans",T.id]}),C())},[T?.id,_,C]),(0,a.useEffect)(()=>{if(!h&&T){if(E){A(!0),P(!1),_.invalidateQueries({queryKey:["premium-status",T.id]});return}if(k<20){let e=setTimeout(()=>{C(),N(e=>e+1)},2e3);return()=>clearTimeout(e)}P(!1)}},[h,T,E,k,C,_]);let L=(0,t.jsx)(f.Loader2,{className:"w-12 h-12 text-primary animate-spin"}),j=x?"Duke verifikuar pagesën...":"Verifying payment...",I=x?"Jemi duke pritur konfirmimin nga banka. Kjo mund të zgjasë pak sekonda.":"We are waiting for confirmation from the payment provider. This may take a few seconds.",S="border-primary/50 bg-primary/5";return w?(L=(0,t.jsx)(o.CheckCircle2,{className:"w-12 h-12 text-emerald-500"}),j=x?"Pagesa u krye me sukses!":"Payment successful!",I=x?"Plani juaj tani është aktiv. Mund të filloni të përdorni të gjitha veçoritë premium.":"Your plan is now active. You can start using all premium features.",S="border-emerald-500/50 bg-emerald-500/5"):D||w||(L=(0,t.jsx)(y.AlertCircle,{className:"w-12 h-12 text-amber-500"}),j=x?"Pagesa është në proces":"Payment processing",I=x?"Ende nuk kemi marrë konfirmimin përfundimtar. Ju lutemi prisni pak minuta dhe rifreskoni faqen, ose kontrolloni email-in tuaj.":"We haven't received final confirmation yet. Please wait a few minutes and refresh the page, or check your email.",S="border-amber-500/50 bg-amber-500/5"),(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(s.Navbar,{}),(0,t.jsx)("div",{className:"pt-32 pb-12",children:(0,t.jsx)("div",{className:"container mx-auto px-4 max-w-xl",children:(0,t.jsxs)(n.GlassCard,{className:`p-8 border ${S} text-center flex flex-col items-center`,children:[(0,t.jsx)("div",{className:"mb-6 p-4 rounded-full bg-black/20 backdrop-blur-md",children:L}),(0,t.jsx)("h1",{className:"text-2xl font-bold mb-3",children:j}),(0,t.jsx)("p",{className:"text-muted-foreground mb-8 leading-relaxed max-w-md mx-auto",children:I}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full max-w-xs mx-auto",children:[(0,t.jsx)(l.Button,{asChild:!0,className:"flex-1 w-full",size:"lg",children:(0,t.jsx)(i.default,{href:"/dashboard",children:e("auth.backToHome")||"Go to Dashboard"})}),!w&&!D&&(0,t.jsx)(l.Button,{variant:"outline",onClick:()=>{N(0),P(!0),C()},className:"flex-1 w-full",children:x?"Provo përsëri":"Try again"})]})]})})})]})}e.s(["default",()=>g])}]);